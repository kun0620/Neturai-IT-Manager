import{j as r,r as x}from"./vendor-react-CqgMBxNQ.js";import{u as q,b as De,c as Me}from"./vendor-tanstack-DVpCzg3k.js";import{d as oe,s as S,b as U,B as E,i as Bn,n as R,a as re,j as Pt,e as Un}from"./index-DFoI8Gyt.js";import{D as qt,f as zt,g as Kt,i as $t,j as Qt,k as Yn,u as Hn}from"./useCurrentProfile-CRnoZ3gy.js";import{I as Vt}from"./input-CmXEoJvQ.js";import{L as ge}from"./label-B9UwnXR4.js";import{S as xe,a as be,b as _e,c as we,d as Q}from"./select-BucmKwq7.js";import{u as qn,m as zn}from"./mapLogToText-Csspg7Oj.js";import{C as Kn,b as $n,R as Qn,T as Vn,P as Zn,c as Zt,d as Xt,V as Xn,e as Gn,f as Gt,g as Jn,h as Jt}from"./vendor-radix-DW-K601O.js";import{t as T,c as Ne,s as We,a as je,g as Ee,m as ea,b as en,e as tn,d as Ot,h as At,i as It,j as Lt,k as G,f as A,l as ta,n as tt,o as na,p as aa,q as nn}from"./format-DBRio2gI.js";import{f as ra,g as sa,h as oa,i as nt,j as ke,U as ia,k as la,P as ca,D as da,b as ua,c as fa,d as ma,e as ha,l as va,m as ya,R as pa}from"./drawer-CFMVGU0m.js";import{a as I,s as $e}from"./subDays-Dx0asAth.js";import{B as Ie}from"./badge-BYTPeF6c.js";import{u as ga}from"./useAuth-Zyc7qEp4.js";import{T as xa}from"./trash-2-Dprl6oFf.js";/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=oe("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _a=oe("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=oe("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=oe("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=oe("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ka=oe("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Da=oe("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Le="ticket-attachments",Ft=10,Ma=["image/*"],Ca=e=>{const t=e.toLowerCase().match(/(\.[a-z0-9]+)$/i);return(t==null?void 0:t[1])??""},Sa=(e,t,n)=>{const a=e.trim().toLowerCase();if(!a)return!1;if(a.startsWith("."))return n===a;if(a.endsWith("/*")){const s=a.slice(0,-1);return t.startsWith(s)}return t===a},Ta=e=>{const t=Array.from(new Set(e==null?void 0:e.map(n=>n.user_id).filter(Boolean)));return q({queryKey:["logAuthors",t.join(",")],enabled:t.length>0,queryFn:async()=>{const n={};return await Promise.all(t.map(async a=>{const{data:s}=await S.from("profiles").select("id, name, email").eq("id",a).maybeSingle();s&&(n[a]=s)})),n}})},Pa=(e={})=>q({queryKey:["dashboardMetrics",e.userId??null,!!e.onlyMy],queryFn:async()=>{const{data:t,error:n}=await S.rpc("get_dashboard_metrics",{p_user_id:e.userId??null,p_only_my:!!e.onlyMy});if(n)throw n;const a=t==null?void 0:t[0];if(!a)return{totalTickets:0,totalAssets:0,openTicketsCount:0,inProgressTicketsCount:0,closedTicketsCount:0,todayTicketsCount:0,overdueTicketsCount:0,avgResolutionHours:null,openTrendDelta:0,inProgressTrendDelta:0,closedTrendDelta:0,todayTrendDelta:0,overdueTrendDelta:0,recentTickets:[]};const o=(Array.isArray(a.recent_tickets)?a.recent_tickets:[]).map(i=>{if(!i||typeof i!="object")return null;const l=i,d=l.id,u=l.title;return typeof d!="string"||typeof u!="string"?null:{id:d,title:u,category_id:typeof l.category_id=="string"?l.category_id:null,priority:typeof l.priority=="string"?l.priority:"low",status:l.status==="open"||l.status==="in_progress"||l.status==="closed"?l.status:"open",created_at:typeof l.created_at=="string"?l.created_at:null}}).filter(i=>i!==null);return{totalTickets:Number(a.total_tickets??0),totalAssets:Number(a.total_assets??0),openTicketsCount:Number(a.open_tickets_count??0),inProgressTicketsCount:Number(a.in_progress_tickets_count??0),closedTicketsCount:Number(a.closed_tickets_count??0),todayTicketsCount:Number(a.today_tickets_count??0),overdueTicketsCount:Number(a.overdue_tickets_count??0),avgResolutionHours:a.avg_resolution_hours===null?null:Number(a.avg_resolution_hours),openTrendDelta:Number(a.open_trend_delta??0),inProgressTrendDelta:Number(a.in_progress_trend_delta??0),closedTrendDelta:Number(a.closed_trend_delta??0),todayTrendDelta:Number(a.today_trend_delta??0),overdueTrendDelta:Number(a.overdue_trend_delta??0),recentTickets:o}}}),Oa=()=>q({queryKey:["allTickets"],queryFn:async()=>{const{data:e,error:t}=await S.from("tickets").select("*").order("created_at",{ascending:!1});if(t)throw t;return e??[]}}),Aa=e=>q({queryKey:["ticket",e],queryFn:async()=>{const{data:t,error:n}=await S.from("tickets").select("*").eq("id",e).single();if(n)throw n;return t},enabled:!!e}),Ia=()=>q({queryKey:["ticketCategories"],queryFn:async()=>{const{data:e,error:t}=await S.from("ticket_categories").select("*").order("name");if(t)throw t;return e??[]}}),La=()=>{const e=De();return Me({mutationFn:async t=>{const{data:n,error:a}=await S.from("tickets").insert({created_by:t.user_id,assigned_to:t.assigned_to??null,title:t.subject,description:t.description,category_id:t.category_id,priority:t.priority,status:t.status}).select().single();if(a)throw a;return await S.from("logs").insert({action:"ticket.created",user_id:t.user_id,details:{ticket_id:n.id,title:n.title,priority:n.priority}}),n},onSuccess:()=>{e.invalidateQueries({queryKey:["allTickets"]}),e.invalidateQueries({queryKey:["recentTickets"]}),e.invalidateQueries({queryKey:["dashboardMetrics"]})}})},Fa=()=>{const e=De();return Me({mutationFn:async({id:t,updates:n,userId:a})=>{const{data:s,error:o}=await S.rpc("update_ticket_with_logs",{p_id:t,p_updates:n,p_user_id:a});if(o)throw o;return s},onSuccess:(t,n)=>{e.invalidateQueries({queryKey:["ticket",n.id]}),e.invalidateQueries({queryKey:["allTickets"]}),e.invalidateQueries({queryKey:["recentTickets"]}),e.invalidateQueries({queryKey:["dashboardMetrics"]})}})},Wa=e=>q({queryKey:["ticketComments",e],queryFn:async()=>{if(!e)return[];const{data:t,error:n}=await S.from("ticket_comments").select("*").eq("ticket_id",e).order("created_at",{ascending:!0});if(n)throw n;return t??[]},enabled:!!e}),Ea=()=>{const e=De();return Me({mutationFn:async t=>{const{data:n,error:a}=await S.from("ticket_comments").insert(t).select().single();if(a)throw a;return n},onSuccess:(t,n)=>{e.invalidateQueries({queryKey:["ticketComments",n.ticket_id]})}})},Ra=e=>q({queryKey:["ticketAttachments",e],enabled:!!e,queryFn:async()=>{if(!e)return[];const{data:t,error:n}=await S.from("ticket_attachments").select("*").eq("ticket_id",e).order("created_at",{ascending:!1});if(n)throw n;return t??[]}}),Ba=()=>{const e=De();return Me({mutationFn:async({ticketId:t,file:n})=>{var k,b;const{data:a}=await S.from("settings").select("key, value").in("key",["attachment_max_size_mb","attachment_allowed_types"]),s=new Map((a??[]).map(P=>[P.key,P.value])),o=Number(s.get("attachment_max_size_mb")??Ft),i=Number.isFinite(o)&&o>0?o*1024*1024:Ft*1024*1024;if(n.size>i)throw new Error(`File is too large. Maximum allowed is ${Math.floor(i/(1024*1024))} MB.`);const d=(s.get("attachment_allowed_types")??Ma.join(",")).split(",").map(P=>P.trim()).filter(Boolean),u=(n.type||"").toLowerCase(),f=Ca(n.name);if(!d.some(P=>Sa(P,u,f)))throw new Error("File type is not allowed by attachment policy.");const p=n.name.replace(/[^a-zA-Z0-9._-]/g,"_"),y=((b=(k=globalThis.crypto)==null?void 0:k.randomUUID)==null?void 0:b.call(k))??`${Date.now()}-${Math.random().toString(36).slice(2,10)}`,g=`${t}/${Date.now()}-${y}-${p}`,{error:w}=await S.storage.from(Le).upload(g,n,{cacheControl:"3600",upsert:!1,contentType:n.type||void 0});if(w)throw w;const{data:v,error:M}=await S.rpc("create_ticket_attachment",{p_ticket_id:t,p_file_name:n.name,p_storage_path:g,p_content_type:n.type||null,p_size_bytes:n.size});if(M)throw await S.storage.from(Le).remove([g]),M;if(!v)throw await S.storage.from(Le).remove([g]),new Error("Attachment rejected by policy or permission.");return v},onSuccess:(t,n)=>{e.invalidateQueries({queryKey:["ticketAttachments",n.ticketId]})}})},Ua=()=>{const e=De();return Me({mutationFn:async({attachmentId:t,storagePath:n})=>{const{error:a}=await S.storage.from(Le).remove([n]);if(a)throw a;const{error:s}=await S.from("ticket_attachments").delete().eq("id",t);if(s)throw s},onSuccess:(t,n)=>{e.invalidateQueries({queryKey:["ticketAttachments",n.ticketId]})}})},Ya=e=>q({queryKey:["ticketTimeline",e],enabled:!!e,queryFn:async()=>{if(!e)return[];const{data:t,error:n}=await S.from("logs").select("*").eq("details->>ticket_id",e).order("created_at",{ascending:!0});if(n)throw n;return t??[]}}),an={useDashboardMetrics:Pa,useAllTickets:Oa,useTicketById:Aa,useTicketCategories:Ia,useCreateTicket:La,useUpdateTicket:Fa,useTicketComments:Wa,useAddTicketComment:Ea,useTicketAttachments:Ra,useUploadTicketAttachment:Ba,useDeleteTicketAttachment:Ua,useTicketTimeline:Ya,useLogAuthors:Ta};function Y(e,t){const n=T(e);if(isNaN(t))return Ne(e,NaN);if(!t)return n;const a=n.getDate(),s=Ne(e,n.getTime());s.setMonth(n.getMonth()+t+1,0);const o=s.getDate();return a>=o?s:(n.setFullYear(s.getFullYear(),s.getMonth(),a),n)}function Je(e,t){const n=t*7;return I(e,n)}function Ha(e,t){return Y(e,t*12)}function qa(e){let t;return e.forEach(function(n){const a=T(n);(t===void 0||t<a||isNaN(Number(a)))&&(t=a)}),t||new Date(NaN)}function za(e){let t;return e.forEach(n=>{const a=T(n);(!t||t>a||isNaN(+a))&&(t=a)}),t||new Date(NaN)}function L(e,t){const n=We(e),a=We(t);return+n==+a}function Ka(e,t,n){const a=je(e,n),s=je(t,n),o=+a-Ee(a),i=+s-Ee(s);return Math.round((o-i)/ea)}function F(e){const t=T(e);return t.setDate(1),t.setHours(0,0,0,0),t}function at(e,t){var l,d,u,f;const n=en(),a=(t==null?void 0:t.weekStartsOn)??((d=(l=t==null?void 0:t.locale)==null?void 0:l.options)==null?void 0:d.weekStartsOn)??n.weekStartsOn??((f=(u=n.locale)==null?void 0:u.options)==null?void 0:f.weekStartsOn)??0,s=T(e),o=s.getDay(),i=(o<a?-7:0)+6-(o-a);return s.setDate(s.getDate()+i),s.setHours(23,59,59,999),s}function rn(e){return at(e,{weekStartsOn:1})}function $a(e,t,n){const a=en(),s=(n==null?void 0:n.locale)??a.locale??tn,o=ra(e,t);if(isNaN(o))throw new RangeError("Invalid time value");const i=Object.assign({},n,{addSuffix:n==null?void 0:n.addSuffix,comparison:o});let l,d;o>0?(l=T(t),d=T(e)):(l=T(e),d=T(t));const u=sa("round"),f=d.getTime()-l.getTime(),m=f/Lt,p=Ee(d)-Ee(l),y=(f-p)/Lt,g=n==null?void 0:n.unit;let w;if(m<1?w="second":m<60?w="minute":m<Ot?w="hour":y<At?w="day":y<It?w="month":w="year",w==="second"){const v=u(f/1e3);return s.formatDistance("xSeconds",v,i)}else if(w==="minute"){const v=u(m);return s.formatDistance("xMinutes",v,i)}else if(w==="hour"){const v=u(m/60);return s.formatDistance("xHours",v,i)}else if(w==="day"){const v=u(y/Ot);return s.formatDistance("xDays",v,i)}else if(w==="month"){const v=u(y/At);return v===12&&g!=="month"?s.formatDistance("xYears",1,i):s.formatDistance("xMonths",v,i)}else{const v=u(y/It);return s.formatDistance("xYears",v,i)}}function Wt(e,t){return $a(e,oa(e),t)}function Qa(e){const t=T(e),n=t.getFullYear(),a=t.getMonth(),s=Ne(e,0);return s.setFullYear(n,a+1,0),s.setHours(0,0,0,0),s.getDate()}function Va(e){return Math.trunc(+T(e)/1e3)}function Za(e){const t=T(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(0,0,0,0),t}function Xa(e,t){return Ka(Za(e),F(e),t)+1}function et(e,t){const n=T(e),a=T(t);return n.getTime()>a.getTime()}function sn(e,t){const n=T(e),a=T(t);return+n<+a}function rt(e,t){const n=T(e),a=T(t);return n.getFullYear()===a.getFullYear()&&n.getMonth()===a.getMonth()}function Ga(e,t){const n=T(e),a=T(t);return n.getFullYear()===a.getFullYear()}function Qe(e,t){const n=T(e),a=n.getFullYear(),s=n.getDate(),o=Ne(e,0);o.setFullYear(a,t,15),o.setHours(0,0,0,0);const i=Qa(o);return n.setMonth(t,Math.min(s,i)),n}function Et(e,t){const n=T(e);return isNaN(+n)?Ne(e,NaN):(n.setFullYear(t),n)}function Rt({className:e,...t}){return r.jsx("div",{className:U("animate-pulse rounded-md bg-primary/10",e),...t})}const Ja={open:{label:"Open",variant:"info",textClass:"text-info"},in_progress:{label:"In Progress",variant:"warning",textClass:"text-warning"},closed:{label:"Closed",variant:"success",textClass:"text-success"}},er={low:{label:"Low",variant:"outline"},medium:{label:"Medium",variant:"info"},high:{label:"High",variant:"warning"},critical:{label:"Critical",variant:"destructive"}};function tr(e){const t=e==null?void 0:e.toLowerCase().replace(/\s+/g,"_");return t==="in_progress"?"in_progress":t==="closed"?"closed":"open"}function nr(e){const t=e==null?void 0:e.toLowerCase().trim();return t==="critical"?"critical":t==="high"?"high":t==="medium"?"medium":"low"}function eo(e){return Ja[tr(e)]}function to(e){return er[nr(e)]}const st=x.forwardRef(({className:e,...t},n)=>r.jsx("textarea",{className:U("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...t}));st.displayName="Textarea";function no({isOpen:e,onClose:t,categories:n}){var ce;const{useCreateTicket:a}=an,s=a(),{data:o=[]}=qn(),[i,l]=x.useState(1),[d,u]=x.useState(""),[f,m]=x.useState(""),[p,y]=x.useState(((ce=n[0])==null?void 0:ce.id)??""),[g,w]=x.useState("Low"),[v,M]=x.useState("open"),{data:k=[]}=q({queryKey:["ticket_priorities"],queryFn:async()=>{const{data:D,error:z}=await S.from("ticket_priorities").select("id, name");if(z)throw z;const ee=["Low","Medium","High","Critical"];return(D??[]).sort((de,_)=>ee.indexOf(de.name)-ee.indexOf(_.name))}}),b=x.useMemo(()=>new Map(o.map(D=>[D.key,D.value??""])),[o]),P=b.get("default_ticket_category_id")??"",V=b.get("default_ticket_priority")??"Low",B=b.get("default_ticket_status")??"open",J=B==="in_progress"||B==="closed"?B:"open",ie=b.get("default_assignee_id")??"",le=()=>{var D;l(1),u(""),m(""),y(n.some(z=>z.id===P)?P:((D=n[0])==null?void 0:D.id)??""),w(V),M(J)};x.useEffect(()=>{e&&le()},[e,n,P,V,J]);const me=()=>{if(!d.trim()){R("Subject is required");return}l(2)},he=async()=>{try{const{data:{user:D}}=await S.auth.getUser();if(!D){R("You must be logged in");return}if(!p){R("Please select a category");return}if(!g){R("Please select a priority");return}await s.mutateAsync({user_id:D.id,subject:d,description:f,category_id:p,priority:g,status:v,assigned_to:ie||null}),re("Ticket created successfully"),le(),t()}catch(D){const z=D instanceof Error?D.message:"Failed to create ticket";R(z)}};return r.jsx(qt,{open:e,onOpenChange:D=>!D&&t(),children:r.jsxs(zt,{className:"sm:max-w-[450px]",children:[r.jsxs(Kt,{children:[r.jsx($t,{children:"Create New Ticket"}),r.jsx(Qt,{children:"Fill in the details to create a support ticket."})]}),i===1&&r.jsxs("div",{className:"grid gap-4 py-4",children:[r.jsxs("div",{className:"grid gap-2",children:[r.jsx(ge,{htmlFor:"subject",children:"Subject"}),r.jsx(Vt,{id:"subject",value:d,onChange:D=>u(D.target.value),placeholder:"Brief summary of the issue"})]}),r.jsxs("div",{className:"grid gap-2",children:[r.jsx(ge,{htmlFor:"description",children:"Description"}),r.jsx(st,{id:"description",value:f,onChange:D=>m(D.target.value),placeholder:"Detailed explanation of the problem",rows:5})]})]}),i===2&&r.jsxs("div",{className:"grid gap-4 py-4",children:[r.jsxs("div",{className:"grid gap-2",children:[r.jsx(ge,{children:"Category"}),r.jsxs(xe,{value:p,onValueChange:y,children:[r.jsx(be,{children:r.jsx(_e,{placeholder:"Select category"})}),r.jsx(we,{children:n.map(D=>r.jsx(Q,{value:D.id,children:D.name},D.id))})]})]}),r.jsxs("div",{className:"grid gap-2",children:[r.jsx(ge,{children:"Priority"}),r.jsxs(xe,{value:g,onValueChange:w,children:[r.jsx(be,{children:r.jsx(_e,{placeholder:"Select priority"})}),r.jsx(we,{children:k.map(D=>r.jsx(Q,{value:D.name,children:D.name},D.id))})]})]}),r.jsxs("div",{className:"grid gap-2",children:[r.jsx(ge,{children:"Status"}),r.jsxs(xe,{value:v,onValueChange:D=>M(D),children:[r.jsx(be,{children:r.jsx(_e,{placeholder:"Select status"})}),r.jsxs(we,{children:[r.jsx(Q,{value:"open",children:"Open"}),r.jsx(Q,{value:"in_progress",children:"In progress"}),r.jsx(Q,{value:"closed",children:"Closed"})]})]})]})]}),r.jsxs(Yn,{className:"flex justify-between",children:[i===2&&r.jsx(E,{variant:"outline",onClick:()=>l(1),children:"Back"}),i===1?r.jsx(E,{onClick:me,className:"btn-motion-primary",children:"Next"}):r.jsxs(E,{onClick:he,className:"btn-motion-primary",disabled:s.isPending,children:[s.isPending&&r.jsx(Bn,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Ticket"]})]})]})})}var N=function(){return N=Object.assign||function(t){for(var n,a=1,s=arguments.length;a<s;a++){n=arguments[a];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},N.apply(this,arguments)};function ar(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(n[a[s]]=e[a[s]]);return n}function on(e,t,n){for(var a=0,s=t.length,o;a<s;a++)(o||!(a in t))&&(o||(o=Array.prototype.slice.call(t,0,a)),o[a]=t[a]);return e.concat(o||Array.prototype.slice.call(t))}function Ce(e){return e.mode==="multiple"}function Se(e){return e.mode==="range"}function Be(e){return e.mode==="single"}var rr={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function sr(e,t){return A(e,"LLLL y",t)}function or(e,t){return A(e,"d",t)}function ir(e,t){return A(e,"LLLL",t)}function lr(e){return"".concat(e)}function cr(e,t){return A(e,"cccccc",t)}function dr(e,t){return A(e,"yyyy",t)}var ur=Object.freeze({__proto__:null,formatCaption:sr,formatDay:or,formatMonthCaption:ir,formatWeekNumber:lr,formatWeekdayName:cr,formatYearCaption:dr}),fr=function(e,t,n){return A(e,"do MMMM (EEEE)",n)},mr=function(){return"Month: "},hr=function(){return"Go to next month"},vr=function(){return"Go to previous month"},yr=function(e,t){return A(e,"cccc",t)},pr=function(e){return"Week n. ".concat(e)},gr=function(){return"Year: "},xr=Object.freeze({__proto__:null,labelDay:fr,labelMonthDropdown:mr,labelNext:hr,labelPrevious:vr,labelWeekNumber:pr,labelWeekday:yr,labelYearDropdown:gr});function br(){var e="buttons",t=rr,n=tn,a={},s={},o=1,i={},l=new Date;return{captionLayout:e,classNames:t,formatters:ur,labels:xr,locale:n,modifiersClassNames:a,modifiers:s,numberOfMonths:o,styles:i,today:l,mode:"default"}}function _r(e){var t=e.fromYear,n=e.toYear,a=e.fromMonth,s=e.toMonth,o=e.fromDate,i=e.toDate;return a?o=F(a):t&&(o=new Date(t,0,1)),s?i=nt(s):n&&(i=new Date(n,11,31)),{fromDate:o?We(o):void 0,toDate:i?We(i):void 0}}var ln=x.createContext(void 0);function wr(e){var t,n=e.initialProps,a=br(),s=_r(n),o=s.fromDate,i=s.toDate,l=(t=n.captionLayout)!==null&&t!==void 0?t:a.captionLayout;l!=="buttons"&&(!o||!i)&&(l="buttons");var d;(Be(n)||Ce(n)||Se(n))&&(d=n.onSelect);var u=N(N(N({},a),n),{captionLayout:l,classNames:N(N({},a.classNames),n.classNames),components:N({},n.components),formatters:N(N({},a.formatters),n.formatters),fromDate:o,labels:N(N({},a.labels),n.labels),mode:n.mode||a.mode,modifiers:N(N({},a.modifiers),n.modifiers),modifiersClassNames:N(N({},a.modifiersClassNames),n.modifiersClassNames),onSelect:d,styles:N(N({},a.styles),n.styles),toDate:i});return r.jsx(ln.Provider,{value:u,children:e.children})}function C(){var e=x.useContext(ln);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function cn(e){var t=C(),n=t.locale,a=t.classNames,s=t.styles,o=t.formatters.formatCaption;return r.jsx("div",{className:a.caption_label,style:s.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:o(e.displayMonth,{locale:n})})}function Nr(e){return r.jsx("svg",N({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:r.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function dn(e){var t,n,a=e.onChange,s=e.value,o=e.children,i=e.caption,l=e.className,d=e.style,u=C(),f=(n=(t=u.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&n!==void 0?n:Nr;return r.jsxs("div",{className:l,style:d,children:[r.jsx("span",{className:u.classNames.vhidden,children:e["aria-label"]}),r.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:u.classNames.dropdown,style:u.styles.dropdown,value:s,onChange:a,children:o}),r.jsxs("div",{className:u.classNames.caption_label,style:u.styles.caption_label,"aria-hidden":"true",children:[i,r.jsx(f,{className:u.classNames.dropdown_icon,style:u.styles.dropdown_icon})]})]})}function jr(e){var t,n=C(),a=n.fromDate,s=n.toDate,o=n.styles,i=n.locale,l=n.formatters.formatMonthCaption,d=n.classNames,u=n.components,f=n.labels.labelMonthDropdown;if(!a)return r.jsx(r.Fragment,{});if(!s)return r.jsx(r.Fragment,{});var m=[];if(Ga(a,s))for(var p=F(a),y=a.getMonth();y<=s.getMonth();y++)m.push(Qe(p,y));else for(var p=F(new Date),y=0;y<=11;y++)m.push(Qe(p,y));var g=function(v){var M=Number(v.target.value),k=Qe(F(e.displayMonth),M);e.onChange(k)},w=(t=u==null?void 0:u.Dropdown)!==null&&t!==void 0?t:dn;return r.jsx(w,{name:"months","aria-label":f(),className:d.dropdown_month,style:o.dropdown_month,onChange:g,value:e.displayMonth.getMonth(),caption:l(e.displayMonth,{locale:i}),children:m.map(function(v){return r.jsx("option",{value:v.getMonth(),children:l(v,{locale:i})},v.getMonth())})})}function kr(e){var t,n=e.displayMonth,a=C(),s=a.fromDate,o=a.toDate,i=a.locale,l=a.styles,d=a.classNames,u=a.components,f=a.formatters.formatYearCaption,m=a.labels.labelYearDropdown,p=[];if(!s)return r.jsx(r.Fragment,{});if(!o)return r.jsx(r.Fragment,{});for(var y=s.getFullYear(),g=o.getFullYear(),w=y;w<=g;w++)p.push(Et(ta(new Date),w));var v=function(k){var b=Et(F(n),Number(k.target.value));e.onChange(b)},M=(t=u==null?void 0:u.Dropdown)!==null&&t!==void 0?t:dn;return r.jsx(M,{name:"years","aria-label":m(),className:d.dropdown_year,style:l.dropdown_year,onChange:v,value:n.getFullYear(),caption:f(n,{locale:i}),children:p.map(function(k){return r.jsx("option",{value:k.getFullYear(),children:f(k,{locale:i})},k.getFullYear())})})}function Dr(e,t){var n=x.useState(e),a=n[0],s=n[1],o=t===void 0?a:t;return[o,s]}function Mr(e){var t=e.month,n=e.defaultMonth,a=e.today,s=t||n||a||new Date,o=e.toDate,i=e.fromDate,l=e.numberOfMonths,d=l===void 0?1:l;if(o&&ke(o,s)<0){var u=-1*(d-1);s=Y(o,u)}return i&&ke(s,i)<0&&(s=i),F(s)}function Cr(){var e=C(),t=Mr(e),n=Dr(t,e.month),a=n[0],s=n[1],o=function(i){var l;if(!e.disableNavigation){var d=F(i);s(d),(l=e.onMonthChange)===null||l===void 0||l.call(e,d)}};return[a,o]}function Sr(e,t){for(var n=t.reverseMonths,a=t.numberOfMonths,s=F(e),o=F(Y(s,a)),i=ke(o,s),l=[],d=0;d<i;d++){var u=Y(s,d);l.push(u)}return n&&(l=l.reverse()),l}function Tr(e,t){if(!t.disableNavigation){var n=t.toDate,a=t.pagedNavigation,s=t.numberOfMonths,o=s===void 0?1:s,i=a?o:1,l=F(e);if(!n)return Y(l,i);var d=ke(n,e);if(!(d<o))return Y(l,i)}}function Pr(e,t){if(!t.disableNavigation){var n=t.fromDate,a=t.pagedNavigation,s=t.numberOfMonths,o=s===void 0?1:s,i=a?o:1,l=F(e);if(!n)return Y(l,-i);var d=ke(l,n);if(!(d<=0))return Y(l,-i)}}var un=x.createContext(void 0);function Or(e){var t=C(),n=Cr(),a=n[0],s=n[1],o=Sr(a,t),i=Tr(a,t),l=Pr(a,t),d=function(m){return o.some(function(p){return rt(m,p)})},u=function(m,p){d(m)||(p&&sn(m,p)?s(Y(m,1+t.numberOfMonths*-1)):s(m))},f={currentMonth:a,displayMonths:o,goToMonth:s,goToDate:u,previousMonth:l,nextMonth:i,isDateDisplayed:d};return r.jsx(un.Provider,{value:f,children:e.children})}function Te(){var e=x.useContext(un);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function Bt(e){var t,n=C(),a=n.classNames,s=n.styles,o=n.components,i=Te().goToMonth,l=function(f){i(Y(f,e.displayIndex?-e.displayIndex:0))},d=(t=o==null?void 0:o.CaptionLabel)!==null&&t!==void 0?t:cn,u=r.jsx(d,{id:e.id,displayMonth:e.displayMonth});return r.jsxs("div",{className:a.caption_dropdowns,style:s.caption_dropdowns,children:[r.jsx("div",{className:a.vhidden,children:u}),r.jsx(jr,{onChange:l,displayMonth:e.displayMonth}),r.jsx(kr,{onChange:l,displayMonth:e.displayMonth})]})}function Ar(e){return r.jsx("svg",N({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:r.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Ir(e){return r.jsx("svg",N({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:r.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var Re=x.forwardRef(function(e,t){var n=C(),a=n.classNames,s=n.styles,o=[a.button_reset,a.button];e.className&&o.push(e.className);var i=o.join(" "),l=N(N({},s.button_reset),s.button);return e.style&&Object.assign(l,e.style),r.jsx("button",N({},e,{ref:t,type:"button",className:i,style:l}))});function Lr(e){var t,n,a=C(),s=a.dir,o=a.locale,i=a.classNames,l=a.styles,d=a.labels,u=d.labelPrevious,f=d.labelNext,m=a.components;if(!e.nextMonth&&!e.previousMonth)return r.jsx(r.Fragment,{});var p=u(e.previousMonth,{locale:o}),y=[i.nav_button,i.nav_button_previous].join(" "),g=f(e.nextMonth,{locale:o}),w=[i.nav_button,i.nav_button_next].join(" "),v=(t=m==null?void 0:m.IconRight)!==null&&t!==void 0?t:Ir,M=(n=m==null?void 0:m.IconLeft)!==null&&n!==void 0?n:Ar;return r.jsxs("div",{className:i.nav,style:l.nav,children:[!e.hidePrevious&&r.jsx(Re,{name:"previous-month","aria-label":p,className:y,style:l.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:s==="rtl"?r.jsx(v,{className:i.nav_icon,style:l.nav_icon}):r.jsx(M,{className:i.nav_icon,style:l.nav_icon})}),!e.hideNext&&r.jsx(Re,{name:"next-month","aria-label":g,className:w,style:l.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:s==="rtl"?r.jsx(M,{className:i.nav_icon,style:l.nav_icon}):r.jsx(v,{className:i.nav_icon,style:l.nav_icon})})]})}function Ut(e){var t=C().numberOfMonths,n=Te(),a=n.previousMonth,s=n.nextMonth,o=n.goToMonth,i=n.displayMonths,l=i.findIndex(function(g){return rt(e.displayMonth,g)}),d=l===0,u=l===i.length-1,f=t>1&&(d||!u),m=t>1&&(u||!d),p=function(){a&&o(a)},y=function(){s&&o(s)};return r.jsx(Lr,{displayMonth:e.displayMonth,hideNext:f,hidePrevious:m,nextMonth:s,previousMonth:a,onPreviousClick:p,onNextClick:y})}function Fr(e){var t,n=C(),a=n.classNames,s=n.disableNavigation,o=n.styles,i=n.captionLayout,l=n.components,d=(t=l==null?void 0:l.CaptionLabel)!==null&&t!==void 0?t:cn,u;return s?u=r.jsx(d,{id:e.id,displayMonth:e.displayMonth}):i==="dropdown"?u=r.jsx(Bt,{displayMonth:e.displayMonth,id:e.id}):i==="dropdown-buttons"?u=r.jsxs(r.Fragment,{children:[r.jsx(Bt,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),r.jsx(Ut,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):u=r.jsxs(r.Fragment,{children:[r.jsx(d,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),r.jsx(Ut,{displayMonth:e.displayMonth,id:e.id})]}),r.jsx("div",{className:a.caption,style:o.caption,children:u})}function Wr(e){var t=C(),n=t.footer,a=t.styles,s=t.classNames.tfoot;return n?r.jsx("tfoot",{className:s,style:a.tfoot,children:r.jsx("tr",{children:r.jsx("td",{colSpan:8,children:n})})}):r.jsx(r.Fragment,{})}function Er(e,t,n){for(var a=n?tt(new Date):je(new Date,{locale:e,weekStartsOn:t}),s=[],o=0;o<7;o++){var i=I(a,o);s.push(i)}return s}function Rr(){var e=C(),t=e.classNames,n=e.styles,a=e.showWeekNumber,s=e.locale,o=e.weekStartsOn,i=e.ISOWeek,l=e.formatters.formatWeekdayName,d=e.labels.labelWeekday,u=Er(s,o,i);return r.jsxs("tr",{style:n.head_row,className:t.head_row,children:[a&&r.jsx("td",{style:n.head_cell,className:t.head_cell}),u.map(function(f,m){return r.jsx("th",{scope:"col",className:t.head_cell,style:n.head_cell,"aria-label":d(f,{locale:s}),children:l(f,{locale:s})},m)})]})}function Br(){var e,t=C(),n=t.classNames,a=t.styles,s=t.components,o=(e=s==null?void 0:s.HeadRow)!==null&&e!==void 0?e:Rr;return r.jsx("thead",{style:a.head,className:n.head,children:r.jsx(o,{})})}function Ur(e){var t=C(),n=t.locale,a=t.formatters.formatDay;return r.jsx(r.Fragment,{children:a(e.date,{locale:n})})}var ot=x.createContext(void 0);function Yr(e){if(!Ce(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return r.jsx(ot.Provider,{value:t,children:e.children})}return r.jsx(Hr,{initialProps:e.initialProps,children:e.children})}function Hr(e){var t=e.initialProps,n=e.children,a=t.selected,s=t.min,o=t.max,i=function(u,f,m){var p,y;(p=t.onDayClick)===null||p===void 0||p.call(t,u,f,m);var g=!!(f.selected&&s&&(a==null?void 0:a.length)===s);if(!g){var w=!!(!f.selected&&o&&(a==null?void 0:a.length)===o);if(!w){var v=a?on([],a):[];if(f.selected){var M=v.findIndex(function(k){return L(u,k)});v.splice(M,1)}else v.push(u);(y=t.onSelect)===null||y===void 0||y.call(t,v,u,f,m)}}},l={disabled:[]};a&&l.disabled.push(function(u){var f=o&&a.length>o-1,m=a.some(function(p){return L(p,u)});return!!(f&&!m)});var d={selected:a,onDayClick:i,modifiers:l};return r.jsx(ot.Provider,{value:d,children:n})}function it(){var e=x.useContext(ot);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function qr(e,t){var n=t||{},a=n.from,s=n.to;return a&&s?L(s,e)&&L(a,e)?void 0:L(s,e)?{from:s,to:void 0}:L(a,e)?void 0:et(a,e)?{from:e,to:s}:{from:a,to:e}:s?et(e,s)?{from:s,to:e}:{from:e,to:s}:a?sn(e,a)?{from:e,to:a}:{from:a,to:e}:{from:e,to:void 0}}var lt=x.createContext(void 0);function zr(e){if(!Se(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return r.jsx(lt.Provider,{value:t,children:e.children})}return r.jsx(Kr,{initialProps:e.initialProps,children:e.children})}function Kr(e){var t=e.initialProps,n=e.children,a=t.selected,s=a||{},o=s.from,i=s.to,l=t.min,d=t.max,u=function(y,g,w){var v,M;(v=t.onDayClick)===null||v===void 0||v.call(t,y,g,w);var k=qr(y,a);(M=t.onSelect)===null||M===void 0||M.call(t,k,y,g,w)},f={range_start:[],range_end:[],range_middle:[],disabled:[]};if(o?(f.range_start=[o],i?(f.range_end=[i],L(o,i)||(f.range_middle=[{after:o,before:i}])):f.range_end=[o]):i&&(f.range_start=[i],f.range_end=[i]),l&&(o&&!i&&f.disabled.push({after:$e(o,l-1),before:I(o,l-1)}),o&&i&&f.disabled.push({after:o,before:I(o,l-1)}),!o&&i&&f.disabled.push({after:$e(i,l-1),before:I(i,l-1)})),d){if(o&&!i&&(f.disabled.push({before:I(o,-d+1)}),f.disabled.push({after:I(o,d-1)})),o&&i){var m=G(i,o)+1,p=d-m;f.disabled.push({before:$e(o,p)}),f.disabled.push({after:I(i,p)})}!o&&i&&(f.disabled.push({before:I(i,-d+1)}),f.disabled.push({after:I(i,d-1)}))}return r.jsx(lt.Provider,{value:{selected:a,onDayClick:u,modifiers:f},children:n})}function ct(){var e=x.useContext(lt);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function Fe(e){return Array.isArray(e)?on([],e):e!==void 0?[e]:[]}function $r(e){var t={};return Object.entries(e).forEach(function(n){var a=n[0],s=n[1];t[a]=Fe(s)}),t}var H;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(H||(H={}));var Qr=H.Selected,X=H.Disabled,Vr=H.Hidden,Zr=H.Today,Ve=H.RangeEnd,Ze=H.RangeMiddle,Xe=H.RangeStart,Xr=H.Outside;function Gr(e,t,n){var a,s=(a={},a[Qr]=Fe(e.selected),a[X]=Fe(e.disabled),a[Vr]=Fe(e.hidden),a[Zr]=[e.today],a[Ve]=[],a[Ze]=[],a[Xe]=[],a[Xr]=[],a);return e.fromDate&&s[X].push({before:e.fromDate}),e.toDate&&s[X].push({after:e.toDate}),Ce(e)?s[X]=s[X].concat(t.modifiers[X]):Se(e)&&(s[X]=s[X].concat(n.modifiers[X]),s[Xe]=n.modifiers[Xe],s[Ze]=n.modifiers[Ze],s[Ve]=n.modifiers[Ve]),s}var fn=x.createContext(void 0);function Jr(e){var t=C(),n=it(),a=ct(),s=Gr(t,n,a),o=$r(t.modifiers),i=N(N({},s),o);return r.jsx(fn.Provider,{value:i,children:e.children})}function mn(){var e=x.useContext(fn);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function es(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function ts(e){return!!(e&&typeof e=="object"&&"from"in e)}function ns(e){return!!(e&&typeof e=="object"&&"after"in e)}function as(e){return!!(e&&typeof e=="object"&&"before"in e)}function rs(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function ss(e,t){var n,a=t.from,s=t.to;if(a&&s){var o=G(s,a)<0;o&&(n=[s,a],a=n[0],s=n[1]);var i=G(e,a)>=0&&G(s,e)>=0;return i}return s?L(s,e):a?L(a,e):!1}function os(e){return nn(e)}function is(e){return Array.isArray(e)&&e.every(nn)}function ls(e,t){return t.some(function(n){if(typeof n=="boolean")return n;if(os(n))return L(e,n);if(is(n))return n.includes(e);if(ts(n))return ss(e,n);if(rs(n))return n.dayOfWeek.includes(e.getDay());if(es(n)){var a=G(n.before,e),s=G(n.after,e),o=a>0,i=s<0,l=et(n.before,n.after);return l?i&&o:o||i}return ns(n)?G(e,n.after)>0:as(n)?G(n.before,e)>0:typeof n=="function"?n(e):!1})}function dt(e,t,n){var a=Object.keys(t).reduce(function(o,i){var l=t[i];return ls(e,l)&&o.push(i),o},[]),s={};return a.forEach(function(o){return s[o]=!0}),n&&!rt(e,n)&&(s.outside=!0),s}function cs(e,t){for(var n=F(e[0]),a=nt(e[e.length-1]),s,o,i=n;i<=a;){var l=dt(i,t),d=!l.disabled&&!l.hidden;if(!d){i=I(i,1);continue}if(l.selected)return i;l.today&&!o&&(o=i),s||(s=i),i=I(i,1)}return o||s}var ds=365;function hn(e,t){var n=t.moveBy,a=t.direction,s=t.context,o=t.modifiers,i=t.retry,l=i===void 0?{count:0,lastFocused:e}:i,d=s.weekStartsOn,u=s.fromDate,f=s.toDate,m=s.locale,p={day:I,week:Je,month:Y,year:Ha,startOfWeek:function(v){return s.ISOWeek?tt(v):je(v,{locale:m,weekStartsOn:d})},endOfWeek:function(v){return s.ISOWeek?rn(v):at(v,{locale:m,weekStartsOn:d})}},y=p[n](e,a==="after"?1:-1);a==="before"&&u?y=qa([u,y]):a==="after"&&f&&(y=za([f,y]));var g=!0;if(o){var w=dt(y,o);g=!w.disabled&&!w.hidden}return g?y:l.count>ds?l.lastFocused:hn(y,{moveBy:n,direction:a,context:s,modifiers:o,retry:N(N({},l),{count:l.count+1})})}var vn=x.createContext(void 0);function us(e){var t=Te(),n=mn(),a=x.useState(),s=a[0],o=a[1],i=x.useState(),l=i[0],d=i[1],u=cs(t.displayMonths,n),f=s??(l&&t.isDateDisplayed(l))?l:u,m=function(){d(s),o(void 0)},p=function(v){o(v)},y=C(),g=function(v,M){if(s){var k=hn(s,{moveBy:v,direction:M,context:y,modifiers:n});L(s,k)||(t.goToDate(k,s),p(k))}},w={focusedDay:s,focusTarget:f,blur:m,focus:p,focusDayAfter:function(){return g("day","after")},focusDayBefore:function(){return g("day","before")},focusWeekAfter:function(){return g("week","after")},focusWeekBefore:function(){return g("week","before")},focusMonthBefore:function(){return g("month","before")},focusMonthAfter:function(){return g("month","after")},focusYearBefore:function(){return g("year","before")},focusYearAfter:function(){return g("year","after")},focusStartOfWeek:function(){return g("startOfWeek","before")},focusEndOfWeek:function(){return g("endOfWeek","after")}};return r.jsx(vn.Provider,{value:w,children:e.children})}function ut(){var e=x.useContext(vn);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function fs(e,t){var n=mn(),a=dt(e,n,t);return a}var ft=x.createContext(void 0);function ms(e){if(!Be(e.initialProps)){var t={selected:void 0};return r.jsx(ft.Provider,{value:t,children:e.children})}return r.jsx(hs,{initialProps:e.initialProps,children:e.children})}function hs(e){var t=e.initialProps,n=e.children,a=function(o,i,l){var d,u,f;if((d=t.onDayClick)===null||d===void 0||d.call(t,o,i,l),i.selected&&!t.required){(u=t.onSelect)===null||u===void 0||u.call(t,void 0,o,i,l);return}(f=t.onSelect)===null||f===void 0||f.call(t,o,o,i,l)},s={selected:t.selected,onDayClick:a};return r.jsx(ft.Provider,{value:s,children:n})}function yn(){var e=x.useContext(ft);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function vs(e,t){var n=C(),a=yn(),s=it(),o=ct(),i=ut(),l=i.focusDayAfter,d=i.focusDayBefore,u=i.focusWeekAfter,f=i.focusWeekBefore,m=i.blur,p=i.focus,y=i.focusMonthBefore,g=i.focusMonthAfter,w=i.focusYearBefore,v=i.focusYearAfter,M=i.focusStartOfWeek,k=i.focusEndOfWeek,b=function(_){var h,te,Pe,K;Be(n)?(h=a.onDayClick)===null||h===void 0||h.call(a,e,t,_):Ce(n)?(te=s.onDayClick)===null||te===void 0||te.call(s,e,t,_):Se(n)?(Pe=o.onDayClick)===null||Pe===void 0||Pe.call(o,e,t,_):(K=n.onDayClick)===null||K===void 0||K.call(n,e,t,_)},P=function(_){var h;p(e),(h=n.onDayFocus)===null||h===void 0||h.call(n,e,t,_)},V=function(_){var h;m(),(h=n.onDayBlur)===null||h===void 0||h.call(n,e,t,_)},B=function(_){var h;(h=n.onDayMouseEnter)===null||h===void 0||h.call(n,e,t,_)},J=function(_){var h;(h=n.onDayMouseLeave)===null||h===void 0||h.call(n,e,t,_)},ie=function(_){var h;(h=n.onDayPointerEnter)===null||h===void 0||h.call(n,e,t,_)},le=function(_){var h;(h=n.onDayPointerLeave)===null||h===void 0||h.call(n,e,t,_)},me=function(_){var h;(h=n.onDayTouchCancel)===null||h===void 0||h.call(n,e,t,_)},he=function(_){var h;(h=n.onDayTouchEnd)===null||h===void 0||h.call(n,e,t,_)},ce=function(_){var h;(h=n.onDayTouchMove)===null||h===void 0||h.call(n,e,t,_)},D=function(_){var h;(h=n.onDayTouchStart)===null||h===void 0||h.call(n,e,t,_)},z=function(_){var h;(h=n.onDayKeyUp)===null||h===void 0||h.call(n,e,t,_)},ee=function(_){var h;switch(_.key){case"ArrowLeft":_.preventDefault(),_.stopPropagation(),n.dir==="rtl"?l():d();break;case"ArrowRight":_.preventDefault(),_.stopPropagation(),n.dir==="rtl"?d():l();break;case"ArrowDown":_.preventDefault(),_.stopPropagation(),u();break;case"ArrowUp":_.preventDefault(),_.stopPropagation(),f();break;case"PageUp":_.preventDefault(),_.stopPropagation(),_.shiftKey?w():y();break;case"PageDown":_.preventDefault(),_.stopPropagation(),_.shiftKey?v():g();break;case"Home":_.preventDefault(),_.stopPropagation(),M();break;case"End":_.preventDefault(),_.stopPropagation(),k();break}(h=n.onDayKeyDown)===null||h===void 0||h.call(n,e,t,_)},de={onClick:b,onFocus:P,onBlur:V,onKeyDown:ee,onKeyUp:z,onMouseEnter:B,onMouseLeave:J,onPointerEnter:ie,onPointerLeave:le,onTouchCancel:me,onTouchEnd:he,onTouchMove:ce,onTouchStart:D};return de}function ys(){var e=C(),t=yn(),n=it(),a=ct(),s=Be(e)?t.selected:Ce(e)?n.selected:Se(e)?a.selected:void 0;return s}function ps(e){return Object.values(H).includes(e)}function gs(e,t){var n=[e.classNames.day];return Object.keys(t).forEach(function(a){var s=e.modifiersClassNames[a];if(s)n.push(s);else if(ps(a)){var o=e.classNames["day_".concat(a)];o&&n.push(o)}}),n}function xs(e,t){var n=N({},e.styles.day);return Object.keys(t).forEach(function(a){var s;n=N(N({},n),(s=e.modifiersStyles)===null||s===void 0?void 0:s[a])}),n}function bs(e,t,n){var a,s,o,i=C(),l=ut(),d=fs(e,t),u=vs(e,d),f=ys(),m=!!(i.onDayClick||i.mode!=="default");x.useEffect(function(){var B;d.outside||l.focusedDay&&m&&L(l.focusedDay,e)&&((B=n.current)===null||B===void 0||B.focus())},[l.focusedDay,e,n,m,d.outside]);var p=gs(i,d).join(" "),y=xs(i,d),g=!!(d.outside&&!i.showOutsideDays||d.hidden),w=(o=(s=i.components)===null||s===void 0?void 0:s.DayContent)!==null&&o!==void 0?o:Ur,v=r.jsx(w,{date:e,displayMonth:t,activeModifiers:d}),M={style:y,className:p,children:v,role:"gridcell"},k=l.focusTarget&&L(l.focusTarget,e)&&!d.outside,b=l.focusedDay&&L(l.focusedDay,e),P=N(N(N({},M),(a={disabled:d.disabled,role:"gridcell"},a["aria-selected"]=d.selected,a.tabIndex=b||k?0:-1,a)),u),V={isButton:m,isHidden:g,activeModifiers:d,selectedDays:f,buttonProps:P,divProps:M};return V}function _s(e){var t=x.useRef(null),n=bs(e.date,e.displayMonth,t);return n.isHidden?r.jsx("div",{role:"gridcell"}):n.isButton?r.jsx(Re,N({name:"day",ref:t},n.buttonProps)):r.jsx("div",N({},n.divProps))}function ws(e){var t=e.number,n=e.dates,a=C(),s=a.onWeekNumberClick,o=a.styles,i=a.classNames,l=a.locale,d=a.labels.labelWeekNumber,u=a.formatters.formatWeekNumber,f=u(Number(t),{locale:l});if(!s)return r.jsx("span",{className:i.weeknumber,style:o.weeknumber,children:f});var m=d(Number(t),{locale:l}),p=function(y){s(t,n,y)};return r.jsx(Re,{name:"week-number","aria-label":m,className:i.weeknumber,style:o.weeknumber,onClick:p,children:f})}function Ns(e){var t,n,a=C(),s=a.styles,o=a.classNames,i=a.showWeekNumber,l=a.components,d=(t=l==null?void 0:l.Day)!==null&&t!==void 0?t:_s,u=(n=l==null?void 0:l.WeekNumber)!==null&&n!==void 0?n:ws,f;return i&&(f=r.jsx("td",{className:o.cell,style:s.cell,children:r.jsx(u,{number:e.weekNumber,dates:e.dates})})),r.jsxs("tr",{className:o.row,style:s.row,children:[f,e.dates.map(function(m){return r.jsx("td",{className:o.cell,style:s.cell,role:"presentation",children:r.jsx(d,{displayMonth:e.displayMonth,date:m})},Va(m))})]})}function Yt(e,t,n){for(var a=n!=null&&n.ISOWeek?rn(t):at(t,n),s=n!=null&&n.ISOWeek?tt(e):je(e,n),o=G(a,s),i=[],l=0;l<=o;l++)i.push(I(s,l));var d=i.reduce(function(u,f){var m=n!=null&&n.ISOWeek?na(f):aa(f,n),p=u.find(function(y){return y.weekNumber===m});return p?(p.dates.push(f),u):(u.push({weekNumber:m,dates:[f]}),u)},[]);return d}function js(e,t){var n=Yt(F(e),nt(e),t);if(t!=null&&t.useFixedWeeks){var a=Xa(e,t);if(a<6){var s=n[n.length-1],o=s.dates[s.dates.length-1],i=Je(o,6-a),l=Yt(Je(o,1),i,t);n.push.apply(n,l)}}return n}function ks(e){var t,n,a,s=C(),o=s.locale,i=s.classNames,l=s.styles,d=s.hideHead,u=s.fixedWeeks,f=s.components,m=s.weekStartsOn,p=s.firstWeekContainsDate,y=s.ISOWeek,g=js(e.displayMonth,{useFixedWeeks:!!u,ISOWeek:y,locale:o,weekStartsOn:m,firstWeekContainsDate:p}),w=(t=f==null?void 0:f.Head)!==null&&t!==void 0?t:Br,v=(n=f==null?void 0:f.Row)!==null&&n!==void 0?n:Ns,M=(a=f==null?void 0:f.Footer)!==null&&a!==void 0?a:Wr;return r.jsxs("table",{id:e.id,className:i.table,style:l.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!d&&r.jsx(w,{}),r.jsx("tbody",{className:i.tbody,style:l.tbody,children:g.map(function(k){return r.jsx(v,{displayMonth:e.displayMonth,dates:k.dates,weekNumber:k.weekNumber},k.weekNumber)})}),r.jsx(M,{displayMonth:e.displayMonth})]})}function Ds(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var Ms=Ds()?x.useLayoutEffect:x.useEffect,Ge=!1,Cs=0;function Ht(){return"react-day-picker-".concat(++Cs)}function Ss(e){var t,n=e??(Ge?Ht():null),a=x.useState(n),s=a[0],o=a[1];return Ms(function(){s===null&&o(Ht())},[]),x.useEffect(function(){Ge===!1&&(Ge=!0)},[]),(t=e??s)!==null&&t!==void 0?t:void 0}function Ts(e){var t,n,a=C(),s=a.dir,o=a.classNames,i=a.styles,l=a.components,d=Te().displayMonths,u=Ss(a.id?"".concat(a.id,"-").concat(e.displayIndex):void 0),f=a.id?"".concat(a.id,"-grid-").concat(e.displayIndex):void 0,m=[o.month],p=i.month,y=e.displayIndex===0,g=e.displayIndex===d.length-1,w=!y&&!g;s==="rtl"&&(t=[y,g],g=t[0],y=t[1]),y&&(m.push(o.caption_start),p=N(N({},p),i.caption_start)),g&&(m.push(o.caption_end),p=N(N({},p),i.caption_end)),w&&(m.push(o.caption_between),p=N(N({},p),i.caption_between));var v=(n=l==null?void 0:l.Caption)!==null&&n!==void 0?n:Fr;return r.jsxs("div",{className:m.join(" "),style:p,children:[r.jsx(v,{id:u,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),r.jsx(ks,{id:f,"aria-labelledby":u,displayMonth:e.displayMonth})]},e.displayIndex)}function Ps(e){var t=C(),n=t.classNames,a=t.styles;return r.jsx("div",{className:n.months,style:a.months,children:e.children})}function Os(e){var t,n,a=e.initialProps,s=C(),o=ut(),i=Te(),l=x.useState(!1),d=l[0],u=l[1];x.useEffect(function(){s.initialFocus&&o.focusTarget&&(d||(o.focus(o.focusTarget),u(!0)))},[s.initialFocus,d,o.focus,o.focusTarget,o]);var f=[s.classNames.root,s.className];s.numberOfMonths>1&&f.push(s.classNames.multiple_months),s.showWeekNumber&&f.push(s.classNames.with_weeknumber);var m=N(N({},s.styles.root),s.style),p=Object.keys(a).filter(function(g){return g.startsWith("data-")}).reduce(function(g,w){var v;return N(N({},g),(v={},v[w]=a[w],v))},{}),y=(n=(t=a.components)===null||t===void 0?void 0:t.Months)!==null&&n!==void 0?n:Ps;return r.jsx("div",N({className:f.join(" "),style:m,dir:s.dir,id:s.id,nonce:a.nonce,title:a.title,lang:a.lang},p,{children:r.jsx(y,{children:i.displayMonths.map(function(g,w){return r.jsx(Ts,{displayIndex:w,displayMonth:g},w)})})}))}function As(e){var t=e.children,n=ar(e,["children"]);return r.jsx(wr,{initialProps:n,children:r.jsx(Or,{children:r.jsx(ms,{initialProps:n,children:r.jsx(Yr,{initialProps:n,children:r.jsx(zr,{initialProps:n,children:r.jsx(Jr,{children:r.jsx(us,{children:t})})})})})})})}function Is(e){return r.jsx(As,N({},e,{children:r.jsx(Os,{initialProps:e})}))}function pn({className:e,classNames:t,showOutsideDays:n=!0,...a}){return r.jsx(Is,{showOutsideDays:n,className:U("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:U(Pt({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:U("relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected].day-range-end)]:rounded-r-md",a.mode==="range"?"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md":"[&:has([aria-selected])]:rounded-md"),day:U(Pt({variant:"ghost"}),"h-8 w-8 p-0 font-normal aria-selected:opacity-100"),day_range_start:"day-range-start",day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50  aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:()=>r.jsx($n,{className:"h-4 w-4"}),IconRight:()=>r.jsx(Kn,{className:"h-4 w-4"})},...a})}pn.displayName="Calendar";const Ls=Qn,Fs=Vn,gn=x.forwardRef(({className:e,align:t="center",sideOffset:n=4,...a},s)=>r.jsx(Zn,{children:r.jsx(Zt,{ref:s,align:t,sideOffset:n,className:U("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a})}));gn.displayName=Zt.displayName;function Ws(){return q({queryKey:["it-users"],queryFn:async()=>{const{data:e,error:t}=await S.from("profiles").select("id, name, role").in("role",["it","admin"]);if(t)throw t;return e??[]}})}const xn=x.forwardRef(({className:e,children:t,...n},a)=>r.jsxs(Xt,{ref:a,className:U("relative overflow-hidden",e),...n,children:[r.jsx(Xn,{className:"h-full w-full rounded-[inherit]",children:t}),r.jsx(bn,{}),r.jsx(Gn,{})]}));xn.displayName=Xt.displayName;const bn=x.forwardRef(({className:e,orientation:t="vertical",...n},a)=>r.jsx(Gt,{ref:a,orientation:t,className:U("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...n,children:r.jsx(Jn,{className:U("relative flex-1 rounded-full bg-border",t==="vertical"&&"w-full",t==="horizontal"&&"h-full")})}));bn.displayName=Gt.displayName;const se=x.forwardRef(({className:e,orientation:t="horizontal",decorative:n=!0,...a},s)=>r.jsx(Jt,{ref:s,decorative:n,orientation:t,className:U("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...a}));se.displayName=Jt.displayName;const Es=e=>{switch(e){case"ticket.created":return{icon:ca,color:"text-emerald-500"};case"ticket.status_changed":return{icon:_a,color:"text-indigo-500"};case"ticket.due_date_changed":return{icon:wa,color:"text-orange-500"};case"ticket.assigned":return{icon:la,color:"text-blue-500"};case"ticket.unassigned":return{icon:ia,color:"text-gray-500"};case"ticket.comment_added":return{icon:Na,color:"text-purple-500"};default:return{icon:ba,color:"text-muted-foreground"}}};function ao({categories:e}){var Dt,Mt,Ct,St;const{ticketId:t,isOpen:n,closeDrawer:a}=Un(),s=t??void 0,{useTicketById:o,useUpdateTicket:i,useTicketComments:l,useAddTicketComment:d,useTicketAttachments:u,useUploadTicketAttachment:f,useDeleteTicketAttachment:m,useTicketTimeline:p,useLogAuthors:y}=an,g=o(s),w=l(s),v=u(s),M=p(s),k=q({queryKey:["ticket-sla-deadlines",s],enabled:!!s,queryFn:async()=>{if(!s)return null;const{data:c,error:j}=await S.rpc("calculate_ticket_sla_deadlines",{p_ticket_id:s});return j||!Array.isArray(c)||!c[0]?null:c[0]}}),b=g.data,P=w.data??[],V=M.data??[],B=[...V.filter(c=>c.action!=="ticket.comment_added").map(c=>({type:"log",id:c.id,created_at:c.created_at,user_id:c.user_id,action:c.action,details:c.details})),...P.map(c=>({type:"comment",id:c.id,created_at:c.created_at,user_id:c.user_id,comment_text:c.comment_text}))].sort((c,j)=>{const O=new Date(c.created_at??0);return new Date(j.created_at??0).getTime()-O.getTime()}),{mutate:J,isPending:ie}=i(),{mutate:le,isPending:me}=d(),{mutate:he,isPending:ce}=f(),{mutate:D,isPending:z}=m(),{session:ee}=ga(),{role:de}=Hn(),{data:_}=Ws(),h=ee==null?void 0:ee.user,te=de==="admin"||de==="it",K=y(V).data??{},[Ue,mt]=x.useState(""),[_n,wn]=x.useState(""),[Nn,ht]=x.useState(""),[ue,Ye]=x.useState(),[vt,He]=x.useState("09:00"),[qe,yt]=x.useState(null),[ze,pt]=x.useState({}),[Z,gt]=x.useState(null),[jn,fe]=x.useState(1),[Oe,Ae]=x.useState({x:0,y:0}),[xt,bt]=x.useState(!1),ve=x.useRef(null);x.useEffect(()=>{b!=null&&b.status&&wn(b.status)},[b==null?void 0:b.status]),x.useEffect(()=>{ht((b==null?void 0:b.assigned_to)??"")},[b==null?void 0:b.assigned_to]),x.useEffect(()=>{if(b!=null&&b.due_at){const c=new Date(b.due_at);Ye(c),He(c.toISOString().slice(11,16))}else Ye(void 0),He("09:00")},[b==null?void 0:b.due_at]);const kn=c=>{!h||!t||J({id:t,updates:{status:c},userId:h.id},{onSuccess:()=>re("Status updated"),onError:j=>R(j.message)})},Dn=c=>{if(!h||!t)return;const j=c||"";ht(j),J({id:t,updates:{assigned_to:j||null},userId:h.id},{onSuccess:()=>re("Ticket assigned"),onError:O=>R(O.message)})},Mn=()=>{!h||!t||!Ue.trim()||le({ticket_id:t,user_id:h.id,comment_text:Ue.trim()},{onSuccess:()=>{mt(""),re("Comment added")},onError:c=>R(c.message)})},Cn=()=>{if(!b||!h||!ue)return;const[c,j]=vt.split(":").map(Number),O=new Date(ue);O.setHours(c,j,0),J({id:b.id,updates:{due_at:O.toISOString()},userId:h.id},{onSuccess:()=>re("Due date updated"),onError:$=>R($.message)})},Sn=()=>{!t||!h||!qe||he({ticketId:t,file:qe},{onSuccess:()=>{yt(null),re("Attachment uploaded")},onError:c=>R(c.message)})},Tn=async c=>{const{data:j,error:O}=await S.storage.from("ticket-attachments").download(c.storage_path);if(O){R(O.message);return}const $=URL.createObjectURL(j),ne=document.createElement("a");ne.href=$,ne.download=c.file_name,ne.click(),URL.revokeObjectURL($)},Pn=c=>{t&&D({attachmentId:c.id,ticketId:t,storagePath:c.storage_path},{onSuccess:()=>re("Attachment deleted"),onError:j=>R(j.message)})},On=(c,j)=>{fe(1),Ae({x:0,y:0}),gt({name:c,url:j})},An=c=>{c.preventDefault(),fe(j=>{const O=j+(c.deltaY<0?.1:-.1);return Math.min(3,Math.max(.5,Number(O.toFixed(2))))})},In=c=>{bt(!0),ve.current={x:c.clientX-Oe.x,y:c.clientY-Oe.y}},Ln=c=>{!xt||!ve.current||Ae({x:c.clientX-ve.current.x,y:c.clientY-ve.current.y})},_t=()=>{bt(!1),ve.current=null},Fn=new Map(e.map(c=>[c.id,c.name])),Wn=c=>c?Fn.get(c)??"N/A":"N/A",En=!!(b!=null&&b.due_at)&&new Date(b.due_at).getTime()<Date.now()&&b.status!=="closed",wt=c=>{if(!c)return{text:"N/A",badge:"outline"};const j=new Date(c);return Number.isNaN(j.getTime())?{text:"N/A",badge:"outline"}:(b==null?void 0:b.status)==="closed"?{text:"Closed",badge:"secondary"}:j.getTime()<Date.now()?{text:`Breached ${Wt(j)} ago`,badge:"destructive"}:{text:`Due in ${Wt(j)}`,badge:"secondary"}},Nt=wt(((Dt=k.data)==null?void 0:Dt.response_due_at)??null),jt=wt(((Mt=k.data)==null?void 0:Mt.resolution_due_at)??null),Ke=new Map((_??[]).map(c=>[c.id,c.name??c.id])),ye=x.useMemo(()=>v.data??[],[v.data]),Rn=c=>c<1024?`${c} B`:c<1024*1024?`${(c/1024).toFixed(1)} KB`:`${(c/(1024*1024)).toFixed(1)} MB`,kt=c=>{var j;return(j=c.content_type)!=null&&j.startsWith("image/")?!0:/\.(png|jpe?g|gif|webp|bmp|svg)$/i.test(c.file_name)};return x.useEffect(()=>{(async()=>{const j=ye.filter(kt);if(j.length===0){pt({});return}const O=Array.from(new Set(j.map(ae=>ae.storage_path))),{data:$,error:ne}=await S.storage.from("ticket-attachments").createSignedUrls(O,3600);if(ne||!$)return;const pe={};$.forEach((ae,W)=>{ae.signedUrl&&(pe[O[W]]=ae.signedUrl)}),pt(pe)})()},[ye]),r.jsx(da,{open:n,onOpenChange:c=>!c&&a(),children:r.jsx(ua,{className:"h-[90%] mt-24",children:r.jsx(xn,{className:"h-full",children:r.jsxs("div",{className:"mx-auto w-full max-w-3xl p-4",children:[r.jsxs(fa,{children:[r.jsx(ma,{children:"Ticket Details"}),r.jsx(ha,{children:"View the selected ticket information, comments and history"})]}),t?g.isLoading?r.jsx(Rt,{className:"h-40 w-full"}):b?r.jsxs(r.Fragment,{children:[r.jsxs("h2",{className:"text-xl font-bold mb-2 flex items-center gap-2",children:[b.title,En&&r.jsx(Ie,{variant:"destructive",children:"Overdue"})]}),r.jsx(se,{}),r.jsxs("div",{className:"grid grid-cols-2 gap-4 my-4",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Description"}),r.jsx("p",{children:b.description||"N/A"})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Category"}),r.jsx("p",{children:Wn(b.category_id)})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Created At"}),r.jsx("p",{className:"text-muted-foreground",children:b.created_at?A(new Date(b.created_at),"MMM dd, yyyy HH:mm"):""})]})]}),r.jsx(se,{}),r.jsxs("div",{className:"grid grid-cols-2 gap-4 my-4",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),r.jsxs(xe,{value:_n,onValueChange:c=>kn(c),disabled:!te||ie,children:[r.jsx(be,{className:`\r
                          w-[180px]\r
                          bg-white\r
                          border border-gray-300\r
                          text-gray-900\r
                          shadow-sm\r
                          hover:bg-gray-50\r
                          focus:ring-2 focus:ring-blue-500\r
                        `,children:r.jsx(_e,{placeholder:"Select status"})}),r.jsxs(we,{className:`\r
                            bg-white\r
                            text-gray-900\r
                            border\r
                            shadow-lg\r
                            z-50\r
                          `,children:[r.jsx(Q,{value:"open",className:"focus:bg-muted",children:"Open"}),r.jsx(Q,{value:"in_progress",className:"focus:bg-muted",children:"In Progress"}),r.jsx(Q,{value:"closed",className:"focus:bg-muted",children:"Closed"})]})]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-muted-foreground",children:"Assigned To"}),te?r.jsxs(xe,{value:Nn??"",onValueChange:Dn,children:[r.jsx(be,{className:`\r
                              w-[180px]\r
                              bg-card\r
                              border border-border\r
                              text-foreground\r
                              shadow-sm\r
                              hover:bg-muted\r
                              focus:ring-2 focus:ring-ring\r
                            `,children:r.jsx(_e,{placeholder:"Unassigned"})}),r.jsxs(we,{className:`\r
                              z-[9999]\r
                              bg-card\r
                              border border-border\r
                              shadow-xl\r
                            `,children:[r.jsx(Q,{value:"",children:r.jsx("span",{className:"text-muted-foreground",children:"Unassigned"})}),(_??[]).map(c=>r.jsx(Q,{value:c.id,children:c.name||c.id},c.id))]})]}):r.jsx("p",{children:b.assigned_to?Ke.get(b.assigned_to):"Unassigned"})]})]}),r.jsx(se,{}),r.jsxs("div",{className:"my-4",children:[r.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Due Date"}),te?r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs(Ls,{children:[r.jsx(Fs,{asChild:!0,children:r.jsx(E,{variant:"outline",size:"sm",className:`\r
                                bg-card\r
                                border border-border\r
                                shadow-sm\r
                                hover:bg-muted\r
                              `,children:ue?A(ue,"MMM dd, yyyy"):"Pick date"})}),r.jsx(gn,{className:`\r
                              w-auto\r
                              p-0\r
                              bg-card\r
                              border border-border\r
                              shadow-xl\r
                              z-[9999]\r
                            `,children:r.jsx(pn,{mode:"single",selected:ue,onSelect:Ye,initialFocus:!0})})]}),r.jsx("input",{type:"time",value:vt,onChange:c=>He(c.target.value),className:`\r
                            h-9\r
                            rounded-md\r
                            bg-card\r
                            border border-border\r
                            px-2\r
                            text-sm\r
                            shadow-sm\r
                          `}),r.jsx(E,{size:"sm",onClick:Cn,disabled:ie||!ue,children:"Save"})]}):r.jsx("p",{children:b.due_at?A(new Date(b.due_at),"MMM dd, yyyy"):"N/A"})]}),r.jsxs("div",{className:"my-4 grid grid-cols-1 gap-3 sm:grid-cols-2",children:[r.jsxs("div",{className:"rounded-md border border-border/70 p-3",children:[r.jsx("p",{className:"text-xs text-muted-foreground",children:"SLA Response Due"}),r.jsx("p",{className:"mt-1 text-sm font-medium",children:(Ct=k.data)!=null&&Ct.response_due_at?A(new Date(k.data.response_due_at),"MMM dd, yyyy HH:mm"):"N/A"}),r.jsx(Ie,{variant:Nt.badge,className:"mt-2",children:Nt.text})]}),r.jsxs("div",{className:"rounded-md border border-border/70 p-3",children:[r.jsx("p",{className:"text-xs text-muted-foreground",children:"SLA Resolution Due"}),r.jsx("p",{className:"mt-1 text-sm font-medium",children:(St=k.data)!=null&&St.resolution_due_at?A(new Date(k.data.resolution_due_at),"MMM dd, yyyy HH:mm"):"N/A"}),r.jsx(Ie,{variant:jt.badge,className:"mt-2",children:jt.text})]})]}),r.jsx(se,{}),r.jsxs("div",{className:"my-4 space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:"font-semibold",children:"Attachments"}),r.jsx(Ie,{variant:"outline",children:ye.length})]}),r.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[r.jsx(Vt,{type:"file",onChange:c=>{var j;return yt(((j=c.target.files)==null?void 0:j[0])??null)},className:"sm:max-w-sm"}),r.jsxs(E,{size:"sm",onClick:Sn,disabled:!qe||!h||ce,children:[r.jsx(va,{className:"mr-2 h-4 w-4"}),"Upload"]})]}),v.isLoading?r.jsx(Rt,{className:"h-16 w-full"}):ye.length===0?r.jsx("p",{className:"text-sm text-muted-foreground",children:"No attachments"}):r.jsx("div",{className:"space-y-2",children:ye.map(c=>r.jsxs("div",{className:"flex items-center justify-between rounded-md border border-border/70 p-2",children:[r.jsxs("div",{className:"min-w-0 flex items-center gap-3",children:[kt(c)&&ze[c.storage_path]?r.jsx("button",{type:"button",onClick:()=>On(c.file_name,ze[c.storage_path]),className:"h-10 w-10 shrink-0 overflow-hidden rounded border border-border/70",title:"Preview image",children:r.jsx("img",{src:ze[c.storage_path],alt:c.file_name,className:"h-full w-full object-cover"})}):r.jsx("span",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded border border-border/70 text-muted-foreground",children:r.jsx(ja,{className:"h-4 w-4"})}),r.jsxs("div",{className:"min-w-0",children:[r.jsx("p",{className:"truncate text-sm font-medium",children:c.file_name}),r.jsxs("p",{className:"text-xs text-muted-foreground",children:[Rn(c.size_bytes)," "," ",A(new Date(c.created_at),"MMM dd, yyyy HH:mm")]})]})]}),r.jsxs("div",{className:"ml-3 flex items-center gap-1",children:[r.jsx(E,{variant:"ghost",size:"icon",onClick:()=>Tn(c),title:"Download attachment",children:r.jsx(ya,{className:"h-4 w-4"})}),(te||c.uploaded_by===(h==null?void 0:h.id))&&r.jsx(E,{variant:"ghost",size:"icon",onClick:()=>Pn(c),disabled:z,title:"Delete attachment",children:r.jsx(xa,{className:"h-4 w-4"})})]})]},c.id))})]}),r.jsx(qt,{open:!!Z,onOpenChange:c=>{c||(gt(null),fe(1),Ae({x:0,y:0}))},children:r.jsxs(zt,{className:"max-w-4xl",children:[r.jsxs(Kt,{children:[r.jsx($t,{children:(Z==null?void 0:Z.name)??"Image preview"}),r.jsx(Qt,{className:"sr-only",children:"Preview ticket attachment image."})]}),(Z==null?void 0:Z.url)&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex items-center justify-end gap-1",children:[r.jsx(E,{type:"button",variant:"outline",size:"icon",onClick:()=>fe(c=>Math.max(.5,Number((c-.25).toFixed(2)))),title:"Zoom out",children:r.jsx(Da,{className:"h-4 w-4"})}),r.jsx(E,{type:"button",variant:"outline",size:"icon",onClick:()=>{fe(1),Ae({x:0,y:0})},title:"Reset zoom",children:r.jsx(pa,{className:"h-4 w-4"})}),r.jsx(E,{type:"button",variant:"outline",size:"icon",onClick:()=>fe(c=>Math.min(3,Number((c+.25).toFixed(2)))),title:"Zoom in",children:r.jsx(ka,{className:"h-4 w-4"})})]}),r.jsx("div",{className:`max-h-[70vh] overflow-hidden rounded-md border border-border/70 p-2 ${xt?"cursor-grabbing":"cursor-grab"}`,onWheel:An,onMouseDown:In,onMouseMove:Ln,onMouseUp:_t,onMouseLeave:_t,children:r.jsx("img",{src:Z.url,alt:Z.name,className:"mx-auto h-auto max-h-[65vh] w-auto object-contain transition-transform",style:{transform:`translate(${Oe.x}px, ${Oe.y}px) scale(${jn})`,transformOrigin:"center center",userSelect:"none",pointerEvents:"none"}})})]})]})}),r.jsx(se,{}),r.jsx("h3",{className:"font-semibold my-4",children:"Activity"}),r.jsx("div",{className:"space-y-4",children:B.map(c=>{var pe,ae;if(c.type==="comment"){const W=c.user_id&&K[c.user_id]?K[c.user_id].name||K[c.user_id].email:"User";return r.jsxs("div",{className:"relative pl-8",children:[r.jsx("span",{className:"absolute left-0 top-1",children:""}),r.jsxs("p",{className:"text-sm font-medium",children:[W," commented"]}),r.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:c.comment_text}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:c.created_at?A(new Date(c.created_at),"MMM dd, yyyy HH:mm"):""})]},`c-${c.id}`)}let j=zn(c.action,c.details);if(c.action==="ticket.assigned"){const W=(pe=c.details)==null?void 0:pe.to;j={title:"Ticket assigned",description:`Assigned to ${W?Ke.get(W)??W:""}`}}if(c.action==="ticket.unassigned"){const W=(ae=c.details)==null?void 0:ae.from,Tt=W?Ke.get(W)??W:"";j={title:"Ticket unassigned",description:W?`Unassigned from ${Tt}`:void 0}}const{icon:O,color:$}=Es(c.action),ne=c.user_id&&K[c.user_id]?K[c.user_id].name||K[c.user_id].email:"System";return r.jsxs("div",{className:"relative pl-8",children:[r.jsx("span",{className:`absolute left-0 top-1 ${$}`,children:r.jsx(O,{size:16})}),r.jsxs("p",{className:"text-sm font-medium",children:[j.title,r.jsxs("span",{className:"text-muted-foreground font-normal",children:[" ","by ",ne]})]}),j.description&&r.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:j.description}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:c.created_at?A(new Date(c.created_at),"MMM dd, yyyy HH:mm"):""})]},`l-${c.id}`)})}),r.jsx(se,{className:"my-6"}),r.jsx(st,{placeholder:"Add a comment...",value:Ue,onChange:c=>mt(c.target.value)}),r.jsx(E,{className:"mt-2",onClick:Mn,disabled:!h||me,children:"Add Comment"})]}):r.jsx("p",{className:"text-center text-muted-foreground",children:"Ticket not found"}):r.jsx("p",{className:"text-center text-muted-foreground",children:"No ticket selected"})]})})})})}export{ba as A,no as C,Rt as S,ao as T,to as a,eo as g,an as u};
