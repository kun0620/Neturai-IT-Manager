import{j as e}from"./vendor-react-CqgMBxNQ.js";import{s as m,B as y}from"./index-DFoI8Gyt.js";import{B as _}from"./badge-BYTPeF6c.js";import{C as x,a as p,b as h,c as g,d as f}from"./card-CCsMzs-c.js";import{I as c}from"./input-CmXEoJvQ.js";import{L as o}from"./label-B9UwnXR4.js";import{b as N,u as j,c as v}from"./vendor-tanstack-DVpCzg3k.js";import{u}from"./useAuth-Zyc7qEp4.js";import{l as b}from"./logSystemAction-DncL9GLF.js";import{L as w}from"./LoadingSkeleton-B9rYdLy6.js";import"./vendor-radix-DW-K601O.js";import"./vendor-supabase-CegkeNa5.js";const D=["full_name","department","location","assigned_asset_id","device_type","device_details","preferred_contact"],L=(a,s)=>!!D.find(t=>t in s&&s[t]!==void 0&&s[t]!==(a==null?void 0:a[t]));function q(){const{user:a}=u(),s=(a==null?void 0:a.id)??null,t=N(),n=j({queryKey:["user-profile",s],enabled:!!s,queryFn:async()=>{const{data:d,error:r}=await m.from("profiles").select("*").eq("id",s).maybeSingle();if(r)throw r;return d??null}}),l=v({mutationFn:async d=>{const{data:r,error:i}=await m.from("profiles").update(d).eq("id",s).select().single();if(i)throw i;return r},onMutate:async d=>{await t.cancelQueries({queryKey:["user-profile",s]});const r=t.getQueryData(["user-profile",s]);return t.setQueryData(["user-profile",s],i=>({...i??{},...d})),{previous:r}},onError:(d,r,i)=>{i!=null&&i.previous&&t.setQueryData(["user-profile",s],i.previous)},onSuccess:(d,r)=>{t.invalidateQueries({queryKey:["user-profile",s]});const i=t.getQueryData(["user-profile",s]);L(i,r)&&b({action:"profile.updated",details:{updates:r},userId:s})}});return{...n,updateProfile:l}}const A=`
  id,
  name,
  asset_code,
  status,
  location,
  serial_number,
  assigned_to,
  created_at,
  updated_at,
  asset_type:asset_types(id, key, name, icon),
  category:asset_categories(id, name)
`;async function C(a){const{data:s,error:t}=await m.from("assets").select(A).eq("assigned_to",a);if(t)throw t;return(s??[]).map(n=>({id:n.id,name:n.name,asset_code:n.asset_code,category:n.category,status:n.status,serial_number:n.serial_number??null,location:n.location,assigned_to:n.assigned_to,last_service_date:null,created_at:n.created_at,updated_at:n.updated_at,asset_type:n.asset_type}))}function k(){const{user:a}=u();return j({queryKey:["user-assets",a==null?void 0:a.id],enabled:!!(a!=null&&a.id),queryFn:()=>C((a==null?void 0:a.id)??"")})}const S=a=>`${a.name}${a.asset_code?` (${a.asset_code})`:""}`,I=a=>{var t;const s=[];return(t=a.asset_type)!=null&&t.name&&s.push(a.asset_type.name),a.serial_number?s.push(`SN ${a.serial_number}`):a.asset_code&&s.push(a.asset_code),s.length?s.join(" - "):null};function U(){const{user:a}=u(),{data:s,isLoading:t}=q(),{data:n=[],isLoading:l}=k(),d={full_name:(s==null?void 0:s.full_name)??"",department:(s==null?void 0:s.department)??"",location:(s==null?void 0:s.location)??"",phone:(s==null?void 0:s.preferred_contact)??""};return t?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"mx-auto flex min-h-screen max-w-5xl items-center px-6 py-12",children:e.jsxs("div",{className:"w-full space-y-6",children:[e.jsx("div",{className:"h-8 w-1/3 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-5 w-1/2 rounded bg-muted animate-pulse"}),e.jsx(w,{count:4,className:"md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2"})]})})}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"mx-auto flex min-h-screen max-w-5xl items-center px-6 py-12",children:e.jsxs("div",{className:"grid w-full gap-8 md:grid-cols-[minmax(0,1fr)_320px]",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2 text-center md:text-left",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:"Neturai IT Manager"}),e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:"My Profile"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tell us where you work and what you work on."})]}),e.jsxs(x,{className:"border-muted/60 shadow-sm",children:[e.jsxs(p,{children:[e.jsx(h,{className:"text-lg",children:"Profile Details"}),e.jsx(g,{className:"text-sm",children:"Share display info, department, and hardware so IT can assist faster."})]}),e.jsx(f,{children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"Full Name"}),e.jsx(c,{placeholder:"Gun Pinit",value:d.full_name,disabled:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"Email"}),e.jsx(c,{value:(a==null?void 0:a.email)??"",disabled:!0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"We take your email from authentication - contact admin to update details."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"Department"}),e.jsx(c,{placeholder:"IT Support",value:d.department,disabled:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"Location"}),e.jsx(c,{placeholder:"Head Office / Bangkok",value:d.location,disabled:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{children:"Phone Number"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Contact admin to update this number."}),e.jsx(c,{type:"tel",placeholder:"081-234-5678",value:d.phone,disabled:!0})]}),e.jsx(y,{type:"button",className:"w-full",disabled:!0,children:"Read only"})]})})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(x,{className:"border-muted/60 shadow-sm",children:[e.jsxs(p,{children:[e.jsx(h,{className:"text-lg",children:"Assigned Devices"}),e.jsx(g,{className:"text-sm",children:"Devices currently assigned to your account."})]}),e.jsxs(f,{className:"space-y-4",children:[l&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-16 rounded-md bg-muted animate-pulse"}),e.jsx("div",{className:"h-16 rounded-md bg-muted animate-pulse"})]}),!l&&n.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No assets assigned yet."}),!l&&n.map(r=>{var i;return e.jsxs("div",{className:"rounded-md border bg-muted/40 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:S(r)}),r.id===(s==null?void 0:s.assigned_asset_id)&&e.jsx(_,{variant:"secondary",children:"Primary"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Type: ",((i=r.asset_type)==null?void 0:i.name)??" - "]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Details: ",I(r)??" - "]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Status: ",r.status]})]},r.id)})]})]})})]})})})}export{U as ProfilePage};
