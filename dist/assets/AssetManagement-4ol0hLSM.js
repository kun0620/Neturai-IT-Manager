const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Tickets-zmRuU3ZB.js","assets/index-W22mHG5Q.js","assets/vendor-react-BzKcyMZF.js","assets/vendor-radix-I-8VOjah.js","assets/vendor-supabase-Dc5vJ71z.js","assets/vendor-tanstack-CEPwOq2U.js","assets/index-u8q-sUSs.css","assets/useSLAPolicies-tuZDm1WS.js","assets/select-D46hviyT.js","assets/TicketDetailsDrawer-wcREKGDs.js","assets/useCurrentProfile-moe49XOh.js","assets/label-BkL0J5XE.js","assets/mapLogToText-D4Ol0ras.js","assets/drawer-Bnn7rOGB.js","assets/subDays-bnZFagG5.js","assets/badge-CibXaFky.js","assets/trash-2-61j_WWpg.js","assets/card-D2xMQo-S.js","assets/list-filter-D3sCofg4.js","assets/arrow-up-DhjRfCWU.js","assets/ErrorState-Bo0iD392.js","assets/export-B-OU7yKf.js","assets/sla-80_Y3eZ5.js"])))=>i.map(i=>d[i]);
import{d as Be,t as we,o as jt,q as _a,r as Na,v as bt,w as Ms,s as P,I as ls,J as Sa,a as U,f as _s,B as g,L as Ns,n as M,b as _e,K as Ca,M as ka,N as Aa,O as Da,P as Ta,Q as Ea,g as At,_ as Dt,S as Ra,X as ze,R as Ia}from"./index-W22mHG5Q.js";import{j as e,r as d,u as Ma,h as Oa,R as S}from"./vendor-react-BzKcyMZF.js";import{i as Tt,D as La,A as fs,a as ps,b as gs,c as ys,d as js,e as bs,f as vs,g as ws}from"./alert-dialog-dA3_PNYJ.js";import{c as Va,u as Fa,a as Ua,o as Pa,r as za,d as qa,s as Me,n as $a}from"./schemas-DWNBsnPi.js";import{u as $s,D as Ka,f as Ba,g as Qa,i as Ya,j as Ha,k as Wa}from"./useCurrentProfile-moe49XOh.js";import{L as Et}from"./label-BkL0J5XE.js";import{S as oe,a as de,b as ce,c as ue,d as v}from"./select-D46hviyT.js";import{u as Qe,b as Ks,c as Xa}from"./vendor-tanstack-CEPwOq2U.js";import{l as As}from"./logSystemAction-9QlETpCa.js";import{u as Ja,P as Ga}from"./useUsers-DJ4ZI8fQ.js";import{B as $}from"./badge-CibXaFky.js";import{w as Za,x as en,y as sn,z as Rt,A as tn,I as an,H as nn,B as It,E as rn,F as Mt,G as ln,J as on,K as Ot,L as dn,M as cn,N as Lt,O as Vt,Q as Ft,U as Ut,W as un,h as mn}from"./vendor-radix-I-8VOjah.js";import{A as Pt,L as hn}from"./list-filter-D3sCofg4.js";import{i as xn,f as Os,j as fn,g as pn,h as gn,U as yn,k as jn,P as bn,C as vn,a as wn,D as _n,b as Nn,c as Sn,d as Cn,e as kn,m as An,l as Dn,R as Tn}from"./drawer-Bnn7rOGB.js";import{L as En}from"./LoadingSkeleton-DDZlmnIo.js";import{F as Rn,a as In,e as Mn,b as On}from"./export-B-OU7yKf.js";import{T as Ln}from"./trash-2-61j_WWpg.js";import"./vendor-supabase-Dc5vJ71z.js";/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=Be("ArrowDownUp",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"m21 8-4-4-4 4",key:"1c9v7m"}],["path",{d:"M17 4v16",key:"7dpous"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=Be("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fn=Be("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Un=Be("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pn=Be("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zn=Be("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qn=Be("Sliders",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=Be("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);function Kn(s,n){return+we(s)-+we(n)}function Bn(s){const n=we(s);return n.setHours(23,59,59,999),n}function Qn(s){const n=we(s);return+Bn(n)==+xn(n)}function Yn(s,n){const a=we(s),l=we(n),o=Os(a,l),u=Math.abs(fn(a,l));let y;if(u<1)y=0;else{a.getMonth()===1&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-o*u);let x=Os(a,l)===-o;Qn(we(s))&&u===1&&Os(s,l)===1&&(x=!1),y=o*(u-Number(x))}return y===0?0:y}function Hn(s,n,a){const l=Kn(s,n)/1e3;return pn(a==null?void 0:a.roundingMethod)(l)}function Wn(s,n,a){const l=_a(),o=(a==null?void 0:a.locale)??l.locale??Na,u=2520,y=Os(s,n);if(isNaN(y))throw new RangeError("Invalid time value");const x=Object.assign({},a,{addSuffix:a==null?void 0:a.addSuffix,comparison:y});let W,te;y>0?(W=we(n),te=we(s)):(W=we(s),te=we(n));const h=Hn(te,W),R=(jt(te)-jt(W))/1e3,C=Math.round((h-R)/60);let K;if(C<2)return a!=null&&a.includeSeconds?h<5?o.formatDistance("lessThanXSeconds",5,x):h<10?o.formatDistance("lessThanXSeconds",10,x):h<20?o.formatDistance("lessThanXSeconds",20,x):h<40?o.formatDistance("halfAMinute",0,x):h<60?o.formatDistance("lessThanXMinutes",1,x):o.formatDistance("xMinutes",1,x):C===0?o.formatDistance("lessThanXMinutes",1,x):o.formatDistance("xMinutes",C,x);if(C<45)return o.formatDistance("xMinutes",C,x);if(C<90)return o.formatDistance("aboutXHours",1,x);if(C<bt){const _=Math.round(C/60);return o.formatDistance("aboutXHours",_,x)}else{if(C<u)return o.formatDistance("xDays",1,x);if(C<Ms){const _=Math.round(C/bt);return o.formatDistance("xDays",_,x)}else if(C<Ms*2)return K=Math.round(C/Ms),o.formatDistance("aboutXMonths",K,x)}if(K=Yn(te,W),K<12){const _=Math.round(C/Ms);return o.formatDistance("xMonths",_,x)}else{const _=K%12,O=Math.trunc(K/12);return _<3?o.formatDistance("aboutXYears",O,x):_<9?o.formatDistance("overXYears",O,x):o.formatDistance("almostXYears",O+1,x)}}function Xn(s,n){return Wn(s,gn(s),n)}async function Jn(){const{data:s,error:n}=await P.from("asset_types").select("id, key, name, icon").order("name");if(n)throw n;return s??[]}function Gn(){return Qe({queryKey:["asset-types"],queryFn:Jn})}async function Zn(s){const{data:n,error:a}=await P.from("asset_fields").select("*").eq("asset_type_id",s).order("created_at");if(a)throw a;return(n??[]).map(l=>({id:l.id,key:l.field_key,label:l.field_label,type:l.field_type,required:l.is_required??!1,options:l.options}))}function zt(s){return Qe({queryKey:["asset-fields",s],queryFn:()=>Zn(s),enabled:!!s})}async function er(s){const{data:n,error:a}=await P.from("asset_field_values").select(`
      value_text,
      asset_fields!inner (
        field_key
      )
    `).eq("asset_id",s);if(a)throw a;const l={};return(n??[]).forEach(o=>{l[o.asset_fields.field_key]=o.value_text??""}),l}function qt(s){return Qe({queryKey:["asset-field-values",s],queryFn:()=>er(s),enabled:!!s})}async function wt({assetId:s,values:n,fields:a}){const l=a.filter(u=>n[u.key]!==void 0).map(u=>({asset_id:s,field_id:u.id,value_text:n[u.key]}));if(l.length===0)return;const{error:o}=await P.from("asset_field_values").upsert(l,{onConflict:"asset_id,field_id"});if(o)throw o}function sr({field:s,control:n}){const{field:a}=Va({name:`custom.${s.key}`,control:n,defaultValue:""});return e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Et,{className:"text-right",children:s.label}),e.jsx("div",{className:"col-span-3",children:e.jsx(ls,{...a})})]})}function tr({fields:s,control:n}){return e.jsx(e.Fragment,{children:s.map(a=>e.jsx(sr,{field:a,control:n},a.id))})}const _t=s=>s==null?null:String(s);function ar(s,n,a){return a.map(l=>{const o=_t(s[l]),u=_t(n[l]);return o===u?null:{field:l,oldValue:o,newValue:u}}).filter(Boolean)}const nr=["name","asset_code","status","location","assigned_to","category_id","asset_type_id"];async function rr(s,n,a,l){const{error:o}=await P.from("assets").update(a).eq("id",s);if(o)throw o;const u={...n,...a},y=ar(n,u,nr);y.length!==0&&await Tt(y.map(x=>({assetId:s,action:x.field==="status"?"status_change":"update",field:x.field,oldValue:x.oldValue,newValue:x.newValue,performedBy:l})))}async function ir(){const{data:s,error:n}=await P.from("asset_categories").select("id, name").order("name",{ascending:!0});if(n)throw n;return s??[]}function lr(){return Qe({queryKey:["asset-categories"],queryFn:ir})}const or={};async function dr(s,n){const{data:a,error:l}=await P.from("assets").insert(s).select("id").single();if(l)throw l;return await Tt([{assetId:a.id,action:"create",field:"*",oldValue:null,newValue:"created",performedBy:n}]),a}const zs={Available:"Available",Assigned:"Assigned",InRepair:"In Repair",Retired:"Retired",Lost:"Lost"},cr=Pa({name:Me().min(1),asset_code:Me().min(1),asset_type_id:Me().uuid(),category_id:Me().uuid().nullable().optional(),status:$a(zs),assigned_to:Me().uuid().nullable().optional(),serial_number:Me().nullable().optional(),location:Me().nullable().optional(),last_service_date:qa().nullable().optional(),custom:za(Me(),Me()).optional()});function ur({isOpen:s,onClose:n,asset:a,users:l}){const o=Ks(),{user:u}=Sa(),{can:y}=$s(),{data:x=[]}=Gn(),{data:W=[]}=lr(),te=y("asset.edit"),h=Fa({resolver:Ua(cr),defaultValues:{name:"",asset_code:"",asset_type_id:"",category_id:null,status:zs.Available,assigned_to:null,serial_number:"",location:"",last_service_date:null,custom:{}}}),R=h.watch("asset_type_id"),C=h.watch("assigned_to"),K=h.watch("status"),_=h.watch("category_id"),{data:O=[]}=zt(R),{data:Ye}=qt(a==null?void 0:a.id);d.useEffect(()=>{C&&K!=="Assigned"&&h.setValue("status","Assigned"),!C&&K==="Assigned"&&h.setValue("status","Available")},[C,K,h]),d.useEffect(()=>{if(!_)return;const m=or[_];if(!m)return;h.getValues("asset_type_id")||h.setValue("asset_type_id",m)},[_,h]),d.useEffect(()=>{var m,w;s&&(a?h.reset({name:a.name,asset_code:a.asset_code,asset_type_id:((m=a.asset_type)==null?void 0:m.id)??"",category_id:((w=a.category)==null?void 0:w.id)??null,status:a.status,assigned_to:a.assigned_to??null,serial_number:a.serial_number??"",location:a.location??"",last_service_date:typeof a.last_service_date=="string"?new Date(a.last_service_date):null,custom:{}}):h.reset())},[a,s,h]),d.useEffect(()=>{Ye&&Object.entries(Ye).forEach(([m,w])=>{h.setValue(`custom.${m}`,w??"")})},[Ye,h]);const me=Xa({mutationFn:async m=>{const w={name:m.name,asset_code:m.asset_code,asset_type_id:m.asset_type_id,category_id:m.category_id??null,status:m.status,assigned_to:m.assigned_to??null,serial_number:m.serial_number??null,location:m.location??null,last_service_date:m.last_service_date?_s(m.last_service_date,"yyyy-MM-dd"):null},he=a?{status:a.status,assigned_to:a.assigned_to,location:a.location,serial_number:a.serial_number}:null;if(a&&he)return await rr(a.id,a,w,(u==null?void 0:u.id)??null),he.status!==w.status&&await As({action:"asset.status_changed",details:{asset_id:a.id,asset_code:a.asset_code,from:he.status,to:w.status},userId:(u==null?void 0:u.id)??null}),he.assigned_to!==w.assigned_to&&await As({action:"asset.assigned_changed",details:{asset_id:a.id,asset_code:a.asset_code,from:he.assigned_to,to:w.assigned_to},userId:(u==null?void 0:u.id)??null}),await wt({assetId:a.id,values:m.custom??{},fields:O}),a.id;const ae=(await dr(w,(u==null?void 0:u.id)??null)).id;return await As({action:"asset.created",details:{asset_id:ae,asset_code:w.asset_code,name:w.name},userId:(u==null?void 0:u.id)??null}),await wt({assetId:ae,values:m.custom??{},fields:O}),ae},onSuccess:()=>{o.invalidateQueries({queryKey:["assets"]}),o.invalidateQueries({queryKey:["asset-logs",a==null?void 0:a.id]}),o.invalidateQueries({queryKey:["logs"]}),U(a?"Asset updated successfully":"Asset created successfully"),h.reset(),n()}}),os=m=>{if(!te){M("You do not have permission to edit assets.");return}me.mutate(m)};return e.jsx(Ka,{open:s,onOpenChange:n,children:e.jsx(Ba,{className:"sm:max-w-[600px]",children:te?e.jsxs(e.Fragment,{children:[e.jsxs(Qa,{children:[e.jsx(Ya,{children:a?"Edit Asset":"Add New Asset"}),e.jsx(Ha,{children:"Manage asset information"})]}),e.jsxs("form",{onSubmit:h.handleSubmit(os),className:"grid gap-4 py-4",children:[e.jsx(qe,{label:"Name",children:e.jsx(ls,{...h.register("name")})}),e.jsx(qe,{label:"Asset Code",children:e.jsx(ls,{...h.register("asset_code")})}),e.jsx(qe,{label:"Category",children:e.jsxs(oe,{value:h.watch("category_id")??"",onValueChange:m=>h.setValue("category_id",m||null),children:[e.jsx(de,{children:e.jsx(ce,{placeholder:"Select category"})}),e.jsx(ue,{children:W.map(m=>e.jsx(v,{value:m.id,children:m.name},m.id))})]})}),e.jsx(qe,{label:"Asset Type",children:e.jsxs(oe,{value:R,onValueChange:m=>h.setValue("asset_type_id",m),children:[e.jsx(de,{children:e.jsx(ce,{placeholder:"Select asset type"})}),e.jsx(ue,{children:x.map(m=>e.jsx(v,{value:m.id,children:m.name},m.id))})]})}),e.jsx(qe,{label:"Status",children:e.jsxs(oe,{value:h.watch("status"),onValueChange:m=>h.setValue("status",m),children:[e.jsx(de,{children:e.jsx(ce,{})}),e.jsx(ue,{children:Object.values(zs).map(m=>e.jsx(v,{value:m,children:m},m))})]})}),e.jsx(qe,{label:"Assigned To",children:e.jsxs(oe,{value:h.watch("assigned_to")??"",onValueChange:m=>h.setValue("assigned_to",m||null),children:[e.jsx(de,{children:e.jsx(ce,{placeholder:"Unassigned"})}),e.jsxs(ue,{children:[e.jsx(v,{value:"",children:"Unassigned"}),l.filter(m=>m.name).map(m=>e.jsx(v,{value:m.id,children:m.name},m.id))]})]})}),e.jsx(qe,{label:"Location",children:e.jsx(ls,{...h.register("location")})}),e.jsx(qe,{label:"Serial Number",children:e.jsx(ls,{...h.register("serial_number")})}),R&&e.jsx(tr,{fields:O,control:h.control},R),e.jsxs(Wa,{className:"flex justify-between",children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>{h.reset(),n()},children:"Cancel"}),e.jsxs(g,{type:"submit",disabled:me.isPending,children:[me.isPending&&e.jsx(Ns,{className:"mr-2 h-4 w-4 animate-spin"}),a?"Save Changes":"Add Asset"]})]})]})]}):e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"You do not have permission to edit assets."})})})}function qe({label:s,children:n}){return e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Et,{className:"text-right",children:s}),e.jsx("div",{className:"col-span-3",children:n})]})}async function mr(){const{data:s,error:n}=await P.from("assets").select(`
      id,
      name,
      asset_code,
      status,
      location,
      assigned_to,
      created_at,
      updated_at,
      asset_type:asset_types(id, key, name, icon),
      category:asset_categories(id, name)
    `);if(n)throw n;return(s??[]).map(a=>({id:a.id,name:a.name,asset_code:a.asset_code,category:a.category,status:a.status,serial_number:null,location:a.location,assigned_to:a.assigned_to,last_service_date:null,created_at:a.created_at,updated_at:a.updated_at,asset_type:a.asset_type}))}function hr(){return Qe({queryKey:["assets"],queryFn:mr})}const Le=Za,Ve=en,Fe=sn,Se=d.forwardRef(({className:s,sideOffset:n=4,...a},l)=>e.jsx(Rt,{ref:l,sideOffset:n,className:_e("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a}));Se.displayName=Rt.displayName;const xr={Available:"bg-[hsl(var(--success)/0.14)] text-[hsl(var(--success))] border-[hsl(var(--success)/0.25)]",Assigned:"bg-[hsl(var(--info)/0.14)] text-[hsl(var(--info))] border-[hsl(var(--info)/0.25)]","In Repair":"bg-[hsl(var(--warning)/0.14)] text-[hsl(var(--warning))] border-[hsl(var(--warning)/0.25)]",Retired:"bg-[hsl(var(--muted)/0.5)] text-muted-foreground border-[hsl(var(--border))]",Lost:"bg-[hsl(var(--destructive)/0.14)] text-[hsl(var(--destructive))] border-[hsl(var(--destructive)/0.25)]","In Use":"bg-[hsl(var(--primary)/0.14)] text-[hsl(var(--primary))] border-[hsl(var(--primary)/0.25)]"},is=({value:s,className:n,maxWidthClass:a})=>e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx("span",{className:`${a??""} truncate ${n??""}`,title:s,children:s})}),e.jsx(Se,{children:s})]})});function Ze({label:s,onClick:n}){return e.jsxs(g,{variant:"ghost",onClick:n,children:[s,e.jsx(Pt,{className:"ml-2 h-4 w-4"})]})}function Nt(s){return[{accessorKey:"name",header:({column:n})=>e.jsx(Ze,{label:"Name",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc")}),size:190,meta:{headerClassName:"sticky left-0 z-20 bg-background border-r",cellClassName:"sticky left-0 z-10 bg-background border-r"},cell:({row:n})=>e.jsx(is,{value:String(n.getValue("name")??""),className:"capitalize font-medium",maxWidthClass:"max-w-[190px] inline-block"})},{accessorKey:"asset_code",header:({column:n})=>e.jsx(Ze,{label:"Asset Code",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc")}),size:120,meta:{headerClassName:"hidden sm:table-cell",cellClassName:"hidden sm:table-cell"},cell:({row:n})=>e.jsx(is,{value:String(n.getValue("asset_code")??""),className:"text-muted-foreground",maxWidthClass:"max-w-[120px] inline-block"})},{id:"asset_type",accessorFn:n=>{var a;return((a=n.asset_type)==null?void 0:a.name)??""},header:({column:n})=>e.jsx(Ze,{label:"Type",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc")}),size:140,meta:{headerClassName:"hidden md:table-cell",cellClassName:"hidden md:table-cell"},cell:({row:n})=>{var a;return e.jsx(is,{value:((a=n.original.asset_type)==null?void 0:a.name)??"—",maxWidthClass:"max-w-[140px] inline-block"})},sortingFn:(n,a)=>{var l,o;return(((l=n.original.asset_type)==null?void 0:l.name)??"").localeCompare(((o=a.original.asset_type)==null?void 0:o.name)??"")}},{id:"category",accessorFn:n=>{var a;return((a=n.category)==null?void 0:a.name)??""},header:({column:n})=>e.jsx(Ze,{label:"Category",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc")}),size:150,meta:{headerClassName:"hidden lg:table-cell",cellClassName:"hidden lg:table-cell"},cell:({row:n})=>{var a;return e.jsx(is,{value:((a=n.original.category)==null?void 0:a.name)??"—",maxWidthClass:"max-w-[150px] inline-block"})},sortingFn:(n,a)=>{var l,o;return(((l=n.original.category)==null?void 0:l.name)??"").localeCompare(((o=a.original.category)==null?void 0:o.name)??"")}},{accessorKey:"location",header:({column:n})=>e.jsx(Ze,{label:"Location",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc")}),size:120,meta:{headerClassName:"hidden xl:table-cell",cellClassName:"hidden xl:table-cell"},cell:({row:n})=>e.jsx(is,{value:String(n.getValue("location")||"—"),maxWidthClass:"max-w-[120px] inline-block"})},{id:"assigned_to_display",accessorFn:n=>n.assigned_to?(s==null?void 0:s[n.assigned_to])??n.assigned_to:"Unassigned",header:({column:n})=>e.jsx("div",{className:"flex justify-center",children:e.jsx(Ze,{label:"Assigned To",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc")})}),size:130,cell:({row:n})=>{const a=n.original.assigned_to?(s==null?void 0:s[n.original.assigned_to])??n.original.assigned_to:"Unassigned";return e.jsx("div",{className:"w-full text-center text-muted-foreground",children:e.jsx(is,{value:a,maxWidthClass:"max-w-[130px] inline-block"})})},sortingFn:(n,a)=>{const l=n.original.assigned_to?(s==null?void 0:s[n.original.assigned_to])??n.original.assigned_to:"Unassigned",o=a.original.assigned_to?(s==null?void 0:s[a.original.assigned_to])??a.original.assigned_to:"Unassigned";return l.localeCompare(o)}},{accessorKey:"updated_at",header:({column:n})=>e.jsx(Ze,{label:"Updated",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc")}),size:150,meta:{headerClassName:"hidden 2xl:table-cell",cellClassName:"hidden 2xl:table-cell"},cell:({row:n})=>{const a=n.getValue("updated_at");if(!a)return e.jsx("div",{className:"text-muted-foreground",children:"—"});const l=new Date(String(a));return e.jsx("div",{className:"text-muted-foreground",children:Number.isNaN(l.getTime())?"—":l.toLocaleString()})}},{accessorKey:"status",header:()=>e.jsx("div",{className:"text-center",children:"Status"}),size:120,cell:({row:n})=>e.jsx("div",{className:"flex justify-center",children:e.jsx($,{variant:"secondary",className:xr[n.getValue("status")]??"",children:n.getValue("status")})})},{id:"actions",enableHiding:!1,size:60,meta:{headerClassName:"hidden md:table-cell",cellClassName:"hidden md:table-cell"},header:()=>e.jsx("div",{className:"text-center",children:"Actions"}),cell:({row:n})=>{const a=n.original;return e.jsx("div",{className:"flex justify-center",children:e.jsxs(Ca,{children:[e.jsx(ka,{asChild:!0,children:e.jsx(g,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(Fn,{className:"h-4 w-4"})})}),e.jsxs(Aa,{align:"end",children:[e.jsx(Da,{children:"Actions"}),e.jsx(Ta,{onClick:()=>navigator.clipboard.writeText(a.id),children:"Copy Asset ID"})]})]})})}}]}const fr=tn,Ss=d.forwardRef(({className:s,...n},a)=>e.jsx(an,{ref:a,className:_e("border-b",s),...n}));Ss.displayName="AccordionItem";const Cs=d.forwardRef(({className:s,children:n,...a},l)=>e.jsx(nn,{className:"flex",children:e.jsxs(It,{ref:l,className:_e("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",s),...a,children:[n,e.jsx(rn,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}));Cs.displayName=It.displayName;const ks=d.forwardRef(({className:s,children:n,...a},l)=>e.jsx(Mt,{ref:l,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...a,children:e.jsx("div",{className:_e("pb-4 pt-0",s),children:n})}));ks.displayName=Mt.displayName;const pr=ln,gr=on,$t=d.forwardRef(({className:s,...n},a)=>e.jsx(Vt,{className:_e("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...n,ref:a}));$t.displayName=Vt.displayName;const yr=Ea("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Kt=d.forwardRef(({side:s="right",className:n,children:a,...l},o)=>e.jsxs(gr,{children:[e.jsx($t,{}),e.jsxs(Ot,{ref:o,className:_e(yr({side:s}),n),...l,children:[e.jsxs(dn,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(cn,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),a]})]}));Kt.displayName=Ot.displayName;const Bt=({className:s,...n})=>e.jsx("div",{className:_e("flex flex-col space-y-2 text-center sm:text-left",s),...n});Bt.displayName="SheetHeader";const Qt=d.forwardRef(({className:s,...n},a)=>e.jsx(Lt,{ref:a,className:_e("text-lg font-semibold text-foreground",s),...n}));Qt.displayName=Lt.displayName;const jr=d.forwardRef(({className:s,...n},a)=>e.jsx(Ft,{ref:a,className:_e("text-sm text-muted-foreground",s),...n}));jr.displayName=Ft.displayName;function br({fields:s,values:n}){return e.jsx("div",{className:"space-y-4",children:s.map(a=>e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:a.label}),e.jsx("div",{className:"text-sm",children:n[a.key]||"—"})]},a.id))})}async function vr(s){const{data:n,error:a}=await P.from("asset_logs").select("*").eq("asset_id",s).order("created_at",{ascending:!1});if(a)throw a;return n}function Yt(s){return Qe({queryKey:["asset-logs",s],queryFn:()=>vr(s),enabled:!!s})}const wr={create:{icon:bn,color:"text-green-600"},assign:{icon:jn,color:"text-purple-600"},unassign:{icon:yn,color:"text-gray-500"},status_change:{icon:Pn,color:"text-blue-600"},update:{icon:Un,color:"text-muted-foreground"},custom_field_update:{icon:qn,color:"text-orange-600"}};function _r({log:s}){const n=wr[s.action],a=n.icon,l=new Date(s.createdAt),o=isNaN(l.getTime())?"just now":Xn(l,{addSuffix:!0});return e.jsxs("div",{className:"relative pl-8 pb-6",children:[e.jsx("div",{className:"absolute left-3 top-3 bottom-0 w-px bg-border"}),e.jsx("div",{className:`absolute left-0 top-0 flex h-6 w-6 items-center justify-center rounded-full bg-background ${n.color}`,children:e.jsx(a,{size:14})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium",children:s.title}),s.description&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.description}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.actor," · ",o]})]})]})}function Nr(s,n){const a=(n==null?void 0:n(s.performed_by))??(s.performed_by?"User":"System"),l={id:s.id,createdAt:s.created_at,actor:a};switch(s.action){case"create":return{...l,action:"create",title:`${a} created the asset`};case"status_change":return{...l,action:"status_change",title:`${a} changed status`,description:`${s.old_value??"—"} → ${s.new_value??"—"}`};case"assign":case"unassign":return{...l,action:s.action,title:`${a} changed assignment`,description:`${s.old_value??"Unassigned"} → ${s.new_value??"Unassigned"}`};default:return s.action==="update"&&s.field==="assigned_to"?{...l,action:"update",title:`${a} changed assignment`,description:`${s.old_value??"Unassigned"} → ${s.new_value??"Unassigned"}`}:s.action==="update"&&s.field==="status"?{...l,action:"update",title:`${a} changed status`,description:`${s.old_value??"—"} → ${s.new_value??"—"}`}:{...l,action:s.action,title:s.action==="custom_field_update"?`${a} updated a custom field`:`${a} updated the asset`,description:s.action==="update"?`${s.field}: "${s.old_value??"—"}" → "${s.new_value??"—"}"`:null}}}function Ht(s){const n=d.useMemo(()=>Array.from(new Set(s.filter(o=>!!o))).sort(),[s]),a=Qe({queryKey:["user-names",n],enabled:n.length>0,queryFn:async()=>{const{data:o,error:u}=await P.from("profiles").select("id, name").in("id",n);if(u)throw u;return o??[]}}),l=d.useMemo(()=>{var u;const o={};return(u=a.data)==null||u.forEach(y=>{y!=null&&y.id&&(y!=null&&y.name)&&(o[y.id]=y.name)}),o},[a.data]);return{...a,nameMap:l}}function Sr({assetId:s}){const{data:n=[],isLoading:a}=Yt(s),{nameMap:l}=Ht(n.map(u=>u.performed_by)),o=n.map(u=>Nr(u,y=>y?l[y]??null:null));return a?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading history…"}):o.length?e.jsx("div",{children:e.jsx("div",{className:"space-y-1",children:o.map(u=>e.jsx(_r,{log:u},u.id))})}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No history yet"})}const St="neturai_asset_drawer_sections_v1";function Cr({asset:s,open:n,onClose:a,onEdit:l,users:o,hasPrev:u=!1,hasNext:y=!1,onPrev:x,onNext:W,positionLabel:te}){var Ee,T,Pe,Ds,ts;const{can:h}=$s(),{session:R}=At(),C=Ks(),K=Ma(),_=d.useCallback(()=>{Dt(()=>import("./Tickets-zmRuU3ZB.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]))},[]),O=s==null?void 0:s.id,Ye=(Ee=s==null?void 0:s.asset_type)==null?void 0:Ee.id,{data:me=[]}=zt(Ye),{data:os={}}=qt(O),{data:m=[]}=Yt(O??""),w=m[0],{nameMap:he}=Ht([(w==null?void 0:w.performed_by)??null]),Ce=h("asset.history.view"),ae=h("ticket.view"),B=me.length>0,ke=d.useMemo(()=>{const f=["info"];return B&&f.push("specs"),ae&&f.push("related"),Ce&&f.push("history"),f},[B,ae,Ce]),X=d.useMemo(()=>["info",...B?["specs"]:[]],[B]),[Ae,pe]=d.useState(X),[J,De]=d.useState(null),[ge,Te]=d.useState(null),[ds,He]=d.useState((s==null?void 0:s.status)??null),[cs,z]=d.useState((s==null?void 0:s.assigned_to)??null),G=d.useMemo(()=>{const f=[(s==null?void 0:s.asset_code)??"",(s==null?void 0:s.name)??""].map(p=>p.trim()).filter(p=>p.length>=2).map(p=>p.replace(/,/g," "));return Array.from(new Set(f))},[s==null?void 0:s.asset_code,s==null?void 0:s.name]),{data:Q=[],isLoading:ye}=Qe({queryKey:["asset-related-tickets",s==null?void 0:s.id,G.join("|")],enabled:!!(s!=null&&s.id)&&G.length>0&&ae,queryFn:async()=>{const f=G.flatMap(ee=>[`title.ilike.%${ee}%`,`description.ilike.%${ee}%`]),{data:p,error:Ne}=await P.from("tickets").select("id, title, status, priority, created_at").or(f.join(",")).order("created_at",{ascending:!1}).limit(3);if(Ne)throw Ne;return p??[]}}),Z=Object.fromEntries(Object.entries(os).map(([f,p])=>[f,p??""]));if(d.useEffect(()=>{if(!n)return;const f=p=>{p.key==="ArrowLeft"&&u&&x&&(p.preventDefault(),x()),p.key==="ArrowRight"&&y&&W&&(p.preventDefault(),W())};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[n,u,y,x,W]),d.useEffect(()=>{if(!(typeof window>"u"))try{const f=window.localStorage.getItem(St);if(!f){pe(X);return}const p=JSON.parse(f);if(!Array.isArray(p)){pe(X);return}const Ne=p.filter(ee=>typeof ee=="string").filter(ee=>ke.includes(ee));pe(Ne.length>0?Ne:X)}catch{pe(X)}},[ke,X]),d.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(St,JSON.stringify(Ae))},[Ae]),d.useEffect(()=>{He((s==null?void 0:s.status)??null),z((s==null?void 0:s.assigned_to)??null),Te(null)},[s==null?void 0:s.id,s==null?void 0:s.status,s==null?void 0:s.assigned_to]),!s)return null;const L=ds??s.status,k=cs,ne=((T=o.find(f=>f.id===k))==null?void 0:T.name)??"—",q=h("asset.edit"),xe=h("asset.status.change"),Y=(Pe=R==null?void 0:R.user)!=null&&Pe.id?h("asset.assign")?k===R.user.id?"This asset is already assigned to you":J!==null?"Action in progress":null:"You do not have permission to assign assets":"Please sign in first",re=xe?L==="In Repair"?"Asset is already in repair":J!==null?"Action in progress":null:"You do not have permission to change status",je=xe?L==="Available"?"Asset is already available":J!==null?"Action in progress":null:"You do not have permission to change status",fe=async(f,p)=>{if(f)try{await navigator.clipboard.writeText(f),U("Copied",`${p} copied to clipboard`)}catch{M("Copy failed","Unable to copy text")}},Ue=L==="Available"?"default":L==="Assigned"?"secondary":L==="In Repair"?"outline":"destructive",be=(w==null?void 0:w.created_at)??s.updated_at,us=w!=null&&w.performed_by?he[w.performed_by]??"Unknown user":"System",ve=async(f,p,Ne)=>{var as;Te(null),De(f);const ee=L,ms=k;p.status&&He(p.status),Object.prototype.hasOwnProperty.call(p,"assigned_to")&&z(p.assigned_to??null);const{error:We}=await P.from("assets").update(p).eq("id",s.id);if(We){He(ee),z(ms),Te({message:We.message,pending:{actionKey:f,updates:p,successMessage:Ne}}),M("Action failed",We.message),De(null);return}const Ts=((as=R==null?void 0:R.user)==null?void 0:as.id)??null;p.status&&p.status!==ee&&await As({action:"asset.status_changed",details:{asset_id:s.id,asset_code:s.asset_code,from:ee,to:p.status},userId:Ts}),Object.prototype.hasOwnProperty.call(p,"assigned_to")&&p.assigned_to!==ms&&await As({action:"asset.assigned_changed",details:{asset_id:s.id,asset_code:s.asset_code,from:ms,to:p.assigned_to??null},userId:Ts}),await Promise.all([C.invalidateQueries({queryKey:["assets"]}),C.invalidateQueries({queryKey:["asset-logs",s.id]}),C.invalidateQueries({queryKey:["logs"]})]),U("Updated",Ne),Te(null),De(null)},V=f=>{const p=`/tickets?open_ticket=${encodeURIComponent(f)}`;K(p),window.setTimeout(()=>{window.location.pathname!=="/tickets"&&window.location.assign(p)},120)};return e.jsx(pr,{open:n,onOpenChange:a,children:e.jsxs(Kt,{side:"right",className:"w-[420px] p-0 flex flex-col",children:[e.jsx(Bt,{className:"border-b px-6 py-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(Qt,{className:"text-lg leading-tight",children:s.name}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"truncate",children:s.asset_code}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>fe(s.asset_code,"Asset code"),children:e.jsx(vt,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Last update:"," ",be?_s(new Date(be),"PPP p"):"—"," by"," ",us]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx($,{variant:Ue,children:L}),te&&e.jsx("span",{className:"text-xs text-muted-foreground",children:te})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsxs(fr,{type:"multiple",value:Ae,onValueChange:pe,className:"space-y-3",children:[e.jsxs(Ss,{value:"info",className:"rounded-md border px-4",children:[e.jsx(Cs,{className:"py-3 text-sm font-semibold",children:"Asset Information"}),e.jsxs(ks,{children:[e.jsxs("div",{className:"mb-4 flex flex-wrap gap-2",children:[e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx("span",{className:"inline-flex",children:e.jsxs(g,{size:"sm",variant:"outline",disabled:!!Y,onClick:()=>{var f;return ve("assign_me",{assigned_to:((f=R==null?void 0:R.user)==null?void 0:f.id)??null},"Assigned to you")},children:[J==="assign_me"&&e.jsx(Ns,{className:"mr-1.5 h-3.5 w-3.5 animate-spin"}),"Assign to me"]})})}),Y&&e.jsx(Se,{children:Y})]})}),e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx("span",{className:"inline-flex",children:e.jsxs(g,{size:"sm",variant:"outline",disabled:!!re,onClick:()=>ve("status_repair",{status:"In Repair"},"Status updated to In Repair"),children:[J==="status_repair"&&e.jsx(Ns,{className:"mr-1.5 h-3.5 w-3.5 animate-spin"}),"Mark In Repair"]})})}),re&&e.jsx(Se,{children:re})]})}),e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx("span",{className:"inline-flex",children:e.jsxs(g,{size:"sm",variant:"outline",disabled:!!je,onClick:()=>ve("status_available",{status:"Available"},"Status updated to Available"),children:[J==="status_available"&&e.jsx(Ns,{className:"mr-1.5 h-3.5 w-3.5 animate-spin"}),"Mark Available"]})})}),je&&e.jsx(Se,{children:je})]})})]}),ge&&e.jsxs("div",{className:"mb-4 rounded-md border border-destructive/40 bg-destructive/5 p-3",children:[e.jsxs("p",{className:"text-sm text-destructive",children:["Quick action failed: ",ge.message]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(g,{size:"sm",variant:"outline",disabled:J!==null,onClick:()=>ve(ge.pending.actionKey,ge.pending.updates,ge.pending.successMessage),children:"Retry"}),e.jsx(g,{size:"sm",variant:"ghost",disabled:J!==null,onClick:()=>Te(null),children:"Dismiss"})]})]}),e.jsxs("section",{className:"grid grid-cols-2 gap-x-6 gap-y-4 pb-1",children:[e.jsx($e,{label:"Category",children:((Ds=s.category)==null?void 0:Ds.name)??"—"}),e.jsx($e,{label:"Asset Type",children:((ts=s.asset_type)==null?void 0:ts.name)??"—"}),e.jsx($e,{label:"Status",children:e.jsx($,{variant:Ue,children:L})}),e.jsx($e,{label:"Assigned To",children:ne}),e.jsx($e,{label:"Location",children:s.location??"—"}),e.jsx($e,{label:"Serial Number",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"truncate",children:s.serial_number??"—"}),s.serial_number&&e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>fe(s.serial_number??"","Serial number"),children:e.jsx(vt,{className:"h-3.5 w-3.5"})})]})}),e.jsx($e,{label:"Last Service",children:s.last_service_date?_s(new Date(s.last_service_date),"PPP"):"—"}),e.jsx($e,{label:"Updated At",children:s.updated_at?_s(new Date(s.updated_at),"PPP p"):"—"})]})]})]}),me.length>0&&e.jsxs(Ss,{value:"specs",className:"rounded-md border px-4",children:[e.jsx(Cs,{className:"py-3 text-sm font-semibold",children:"Specifications"}),e.jsx(ks,{children:e.jsx(br,{assetId:s.id,fields:me,values:Z})})]}),ae&&e.jsxs(Ss,{value:"related",className:"rounded-md border px-4",children:[e.jsx(Cs,{className:"py-3 text-sm font-semibold",children:"Related Tickets"}),e.jsxs(ks,{children:[ye?e.jsxs("div",{className:"flex items-center gap-2 py-2 text-sm text-muted-foreground",children:[e.jsx(Ns,{className:"h-4 w-4 animate-spin"}),"Loading related tickets..."]}):Q.length===0?e.jsx("p",{className:"py-1 text-sm text-muted-foreground",children:"No related tickets found for this asset."}):e.jsx("div",{className:"space-y-2",children:Q.map(f=>e.jsxs("button",{type:"button",className:"w-full rounded-md border p-3 text-left transition-colors hover:bg-muted/50",onClick:()=>V(f.id),onMouseEnter:_,onFocus:_,children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("p",{className:"line-clamp-1 text-sm font-medium",children:f.title}),e.jsx($,{variant:"outline",className:"shrink-0",children:f.status})]}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Priority: ",f.priority||"—"," •"," ",f.created_at?_s(new Date(f.created_at),"PPP"):"—"]})]},f.id))}),e.jsx("div",{className:"mt-3",children:e.jsx(g,{size:"sm",variant:"outline",onMouseEnter:_,onFocus:_,onClick:()=>{const f=s.asset_code||s.name;K(`/tickets?q=${encodeURIComponent(f)}`)},children:"Open in Tickets"})})]})]}),Ce&&e.jsxs(Ss,{value:"history",className:"rounded-md border px-4",children:[e.jsx(Cs,{className:"py-3 text-sm font-semibold",children:"History"}),e.jsx(ks,{children:e.jsx("div",{className:"max-h-[260px] overflow-y-auto pr-2",children:e.jsx(Sr,{assetId:s.id})})})]})]})}),e.jsxs("div",{className:"border-t px-6 py-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx("span",{className:"inline-flex",children:e.jsxs(g,{size:"sm",variant:"outline",disabled:!u,onClick:x,children:[e.jsx(vn,{className:"mr-1 h-4 w-4"}),"Prev"]})})}),!u&&e.jsx(Se,{children:"This is the first asset"})]})}),e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx("span",{className:"inline-flex",children:e.jsxs(g,{size:"sm",variant:"outline",disabled:!y,onClick:W,children:["Next",e.jsx(wn,{className:"ml-1 h-4 w-4"})]})})}),!y&&e.jsx(Se,{children:"This is the last asset"})]})})]}),q&&e.jsx(g,{size:"sm",variant:"default",onClick:()=>{a(),l(s)},children:"Edit"})]})]})})}function $e({label:s,children:n}){return e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:s}),e.jsx("div",{className:"text-sm",children:n})]})}const qs=d.forwardRef(({className:s,...n},a)=>e.jsx(Ut,{ref:a,className:_e("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...n,children:e.jsx(un,{className:_e("flex items-center justify-center text-current"),children:e.jsx(mn,{className:"h-4 w-4"})})}));qs.displayName=Ut.displayName;const es="updated_at",ss="desc",se="all",Ke="me",Oe="unassigned",Ct="neturai_asset_view_preset",kt="neturai_asset_saved_views";function Br(){var dt,ct,ut,mt,ht;const{session:s}=At(),{can:n}=$s(),a=n("asset.assign"),l=n("asset.status.change"),o=n("asset.delete"),u=((dt=s==null?void 0:s.user)==null?void 0:dt.id)??null,y=Ks(),{data:x=[],isLoading:W,isError:te,error:h}=hr(),{data:R=[],isLoading:C,isError:K}=Ja(),_=R.filter(t=>t.name).map(t=>({id:t.id,name:t.name})),O=d.useMemo(()=>_.reduce((t,r)=>(t[r.id]=r.name,t),{}),[_]),[Ye,me]=d.useState(!1),[os,m]=d.useState(null),[w,he]=d.useState(!1),[Ce,ae]=d.useState(null),[B,ke]=Oa(),X=B.get("q")??"",Ae=B.get("status")??"all",pe=B.get("category")??"all",J=B.get("type")??"all",De=B.get("owner")??se,ge=B.get("sortBy"),Te=B.get("sortDir"),ds=De&&De!==""?De:se,He=ge==="name"||ge==="asset_code"||ge==="status"||ge==="updated_at"?ge:es,cs=Te==="asc"||Te==="desc"?Te:ss,[z,G]=d.useState(Ae),[Q,ye]=d.useState(pe),[Z,L]=d.useState(J),[k,ne]=d.useState(ds),[q,xe]=d.useState(He),[Y,re]=d.useState(cs),[je,fe]=d.useState(X),[Ue,be]=d.useState(X),[us,ve]=d.useState("default"),[V,Ee]=d.useState([]),[T,Pe]=d.useState("none"),[Ds,ts]=d.useState(!1),[f,p]=d.useState(!1),[Ne,ee]=d.useState(!1),[ms,We]=d.useState(!1),[Ts,as]=d.useState(!1),Bs=d.useRef(null),[Wt,Qs]=d.useState(!1),[Re,Es]=d.useState([]),[Xe,Ys]=d.useState(!1),[H,Hs]=d.useState("__none__"),[ns,Ws]=d.useState("__none__"),[E,ie]=d.useState(!1),[Je,le]=d.useState(null),[Ge,Rs]=d.useState(null),Xs=S.useCallback(()=>{Dt(()=>import("./Tickets-zmRuU3ZB.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]))},[]),Ls=S.useCallback(t=>{if(t==="default"){fe(""),be(""),G("all"),ye("all"),L("all"),ne(se),xe(es),re(ss),ve("default");return}if(t==="my_assigned"){fe(""),be(""),G("Assigned"),ye("all"),L("all"),ne("me"),xe("updated_at"),re("desc"),ve("my_assigned");return}if(t==="in_repair"){fe(""),be(""),G("In Repair"),ye("all"),L("all"),ne(se),xe("updated_at"),re("desc"),ve("in_repair");return}fe(""),be(""),G("all"),ye("all"),L("all"),ne("unassigned"),xe("updated_at"),re("desc"),ve("unassigned")},[]),Xt=()=>{he(!1),ae(null),B.get("assetId")&&ke(t=>{const r=new URLSearchParams(t);return r.delete("assetId"),r})},Jt=t=>{he(!1),ae(null),m(t),me(!0)},hs=S.useCallback(t=>{ae(t),he(!0),ke(r=>{const i=new URLSearchParams(r);return i.set("assetId",t.id),i})},[ke]),Vs=d.useMemo(()=>x.reduce((r,i)=>{const c=i.status??"Unknown";return r[c]=(r[c]??0)+1,r},{}),[x]),Js=d.useMemo(()=>{const t=["Available","Assigned","In Repair","In Use","Retired","Lost","Unknown"],r=Object.keys(Vs);return[...t.filter(c=>r.includes(c)),...r.filter(c=>!t.includes(c)).sort((c,b)=>c.localeCompare(b))].map(c=>({status:c,count:Vs[c]??0}))},[Vs]),Gs=d.useMemo(()=>{const t=new Map;return x.forEach(r=>{var i;(i=r.category)!=null&&i.id&&t.set(r.category.id,r.category.name??r.category.id)}),Array.from(t.entries()).map(([r,i])=>({id:r,label:i}))},[x]),Zs=d.useMemo(()=>{const t=new Map;return x.forEach(r=>{var i;(i=r.asset_type)!=null&&i.id&&t.set(r.asset_type.id,r.asset_type.name??r.asset_type.id)}),Array.from(t.entries()).map(([r,i])=>({id:r,label:i}))},[x]),et=d.useMemo(()=>x.filter(t=>{var c,b,N,j,I,F,xt,ft,pt,gt,yt;const r=Ue.trim().toLowerCase();return!(!(r.length===0||((c=t.name)==null?void 0:c.toLowerCase().includes(r))||((b=t.asset_code)==null?void 0:b.toLowerCase().includes(r))||((j=(N=t.asset_type)==null?void 0:N.name)==null?void 0:j.toLowerCase().includes(r))||((F=(I=t.category)==null?void 0:I.name)==null?void 0:F.toLowerCase().includes(r))||((xt=t.location)==null?void 0:xt.toLowerCase().includes(r))||((ft=t.serial_number)==null?void 0:ft.toLowerCase().includes(r))||((pt=t.status)==null?void 0:pt.toLowerCase().includes(r))||(t.assigned_to?(O[t.assigned_to]??"").toLowerCase().includes(r):!1))||z!=="all"&&t.status!==z||Q!=="all"&&((gt=t.category)==null?void 0:gt.id)!==Q||Z!=="all"&&((yt=t.asset_type)==null?void 0:yt.id)!==Z||k==="me"&&(!u||t.assigned_to!==u)||k===Oe&&t.assigned_to||k!==se&&k!==Ke&&k!==Oe&&t.assigned_to!==k)}),[x,z,Q,Z,Ue,O,k,u]),A=d.useMemo(()=>{const t=[...et],r=(i,c)=>c==="name"?i.name??"":c==="asset_code"?i.asset_code??"":c==="status"?i.status??"":i.updated_at??"";return t.sort((i,c)=>{if(q==="updated_at"){const I=i.updated_at?new Date(i.updated_at).getTime():0,F=c.updated_at?new Date(c.updated_at).getTime():0;return Y==="asc"?I-F:F-I}const b=r(i,q).toLowerCase(),N=r(c,q).toLowerCase();if(b===N)return 0;const j=b.localeCompare(N);return Y==="asc"?j:-j}),t},[et,q,Y]),Ie=d.useMemo(()=>Ce?A.findIndex(t=>t.id===Ce.id):-1,[A,Ce]),Fs=Ie>0,Us=Ie>=0&&Ie<A.length-1,Gt=S.useCallback(()=>{if(!Fs)return;const t=A[Ie-1];t&&hs(t)},[Fs,A,Ie,hs]),Zt=S.useCallback(()=>{if(!Us)return;const t=A[Ie+1];t&&hs(t)},[Us,A,Ie,hs]),D=d.useMemo(()=>Re.map(t=>t.id),[Re]),Is=A.length>0&&D.length===A.length,Ps=S.useCallback(t=>{Es(r=>r.some(c=>c.id===t.id)?r.filter(c=>c.id!==t.id):[...r,t])},[]),st=S.useCallback(()=>{if(Is){Es([]);return}Es(A)},[Is,A]),ea=d.useMemo(()=>Xe?[{id:"select",enableSorting:!1,enableHiding:!1,size:40,header:()=>e.jsx("div",{className:"flex items-center justify-center",onClick:t=>t.stopPropagation(),children:e.jsx(qs,{checked:Is,onCheckedChange:st,onClick:t=>t.stopPropagation(),"aria-label":"Select all rows"})}),cell:({row:t})=>e.jsx("div",{className:"flex items-center justify-center",onClick:r=>r.stopPropagation(),children:e.jsx(qs,{checked:D.includes(t.original.id),onCheckedChange:()=>Ps(t.original),onClick:r=>r.stopPropagation(),"aria-label":"Select row"})})},...Nt(O)]:[...Nt(O)],[Is,O,D,Xe,Ps,st]);S.useEffect(()=>{const t=window.setTimeout(()=>{be(je)},250);return()=>window.clearTimeout(t)},[je]),S.useEffect(()=>{if(typeof window>"u")return;const t=()=>{Xs()};if("requestIdleCallback"in window){const i=window.requestIdleCallback(t,{timeout:1500});return()=>window.cancelIdleCallback(i)}const r=window.setTimeout(t,500);return()=>window.clearTimeout(r)},[Xs]),S.useEffect(()=>{fe(X),be(X),G(Ae),ye(pe),L(J),ne(ds),xe(He),re(cs)},[X,Ae,pe,J,ds,He,cs]),S.useEffect(()=>{ke(t=>{const r=new URLSearchParams(t),i=(c,b,N)=>{b.trim()===""||b===N?r.delete(c):r.set(c,b)};return i("q",Ue,""),i("status",z,"all"),i("category",Q,"all"),i("type",Z,"all"),i("owner",k,se),i("sortBy",q,es),i("sortDir",Y,ss),r.toString()===t.toString()?t:r})},[Ue,z,Q,Z,k,q,Y,ke]),S.useEffect(()=>{if(typeof window>"u"||X||Ae!=="all"||pe!=="all"||J!=="all"||De!==se)return;const t=window.localStorage.getItem(Ct);(t==="default"||t==="my_assigned"||t==="in_repair"||t==="unassigned")&&Ls(t)},[Ls,X,Ae,pe,J,De]),S.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Ct,us)},[us]),S.useEffect(()=>{const t=B.get("assetId");if(!t)return;const r=x.find(i=>i.id===t);r&&(ae(r),he(!0))},[x,B]);const sa=Ue.trim().length>0||z!=="all"||Q!=="all"||Z!=="all"||k!==se||q!==es||Y!==ss,tt=Q==="all"?null:((ct=Gs.find(t=>t.id===Q))==null?void 0:ct.label)??Q,at=Z==="all"?null:((ut=Zs.find(t=>t.id===Z))==null?void 0:ut.label)??Z,ta=q==="updated_at"?"Updated date":q==="asset_code"?"Asset code":q==="status"?"Status":"Name",aa=Y==="desc"?"Desc":"Asc",nt=()=>{fe(""),be(""),G("all"),ye("all"),L("all"),ne(se),xe(es),re(ss),ve("default"),Pe("none"),ke(t=>{const r=new URLSearchParams(t);return r.delete("q"),r.delete("status"),r.delete("category"),r.delete("type"),r.delete("owner"),r.delete("sortBy"),r.delete("sortDir"),r})},rs=()=>{Es([]),Hs("__none__"),Ws("__none__")},na=()=>{Ys(!0)},ra=()=>{rs(),Ys(!1)};S.useEffect(()=>{Xe||Re.length!==0&&rs()},[Xe,Re.length]);const ia=async()=>{var b;if(D.length===0)return!1;if(!a)return M("You do not have permission to assign assets"),!1;if(H==="__none__")return M("Select an owner first"),!1;let t=null;if(H===Ke){if(!u)return M("You must be logged in to assign to yourself"),!1;t=u}else H===Oe?t=null:t=H;const r=Re.map(N=>({id:N.id,previousAssignedTo:N.assigned_to})),i=H===Ke?"Assign to me":H===Oe?"Set unassigned":((b=_.find(N=>N.id===H))==null?void 0:b.name)??H;ie(!0),le("owner");const{error:c}=await P.from("assets").update({assigned_to:t}).in("id",D);return c?(M("Failed to assign owner",c.message),ie(!1),le(null),!1):(U("Owner updated",`${D.length} asset(s)`),Rs({kind:"owner",label:`Owner -> ${i}`,items:r}),rs(),y.invalidateQueries({queryKey:["assets"]}),ie(!1),le(null),!0)},la=async()=>{if(D.length===0)return!1;if(!l)return M("You do not have permission to change asset status"),!1;if(ns==="__none__")return M("Select a status first"),!1;const t=Re.map(i=>({id:i.id,previousStatus:i.status}));ie(!0),le("status");const{error:r}=await P.from("assets").update({status:ns}).in("id",D);return r?(M("Failed to update status",r.message),ie(!1),le(null),!1):(U("Status updated",`${D.length} asset(s)`),Rs({kind:"status",label:`Status -> ${ns}`,items:t}),rs(),y.invalidateQueries({queryKey:["assets"]}),ie(!1),le(null),!0)},oa=()=>{if(Re.length===0)return;const t=[["Name","Asset Code","Type","Category","Status","Location","Assigned To"],...Re.map(j=>{var I,F;return[j.name??"",j.asset_code??"",((I=j.asset_type)==null?void 0:I.name)??"",((F=j.category)==null?void 0:F.name)??"",j.status??"",j.location??"",j.assigned_to?O[j.assigned_to]??j.assigned_to:"Unassigned"]})],r=j=>`"${String(j).replace(/"/g,'""')}"`,i=t.map(j=>j.map(r).join(",")).join(`
`),c=new Blob([i],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(c),N=document.createElement("a");N.href=b,N.download="selected-assets.csv",document.body.appendChild(N),N.click(),N.remove(),URL.revokeObjectURL(b),U("Export complete",`${Re.length} asset(s)`)},rt=t=>t.map(r=>{var i,c;return{Name:r.name??"","Asset Code":r.asset_code??"",Type:((i=r.asset_type)==null?void 0:i.name)??"",Category:((c=r.category)==null?void 0:c.name)??"",Status:r.status??"",Location:r.location??"","Assigned To":r.assigned_to?O[r.assigned_to]??r.assigned_to:"Unassigned","Updated At":r.updated_at?new Date(r.updated_at).toLocaleString():""}}),da=async()=>{if(A.length===0){M("No assets to export");return}await Mn(rt(A),"assets-export"),U("Excel exported",`${A.length} asset(s)`)},ca=()=>{if(A.length===0){M("No assets to export");return}On(rt(A),"Assets Export","assets-export"),U("PDF exported",`${A.length} asset(s)`)},ua=async()=>{if(D.length===0)return!1;if(!o)return M("You do not have permission to delete assets"),!1;ie(!0),le("delete");const{error:t}=await P.from("assets").delete().in("id",D);return t?(M("Failed to delete assets",t.message),ie(!1),le(null),!1):(U("Assets deleted",`${D.length} asset(s)`),rs(),Rs(null),y.invalidateQueries({queryKey:["assets"]}),ie(!1),le(null),!0)},ma=async()=>{if(Ge){if(ie(!0),le("undo"),Ge.kind==="owner"){const r=(await Promise.all(Ge.items.map(i=>P.from("assets").update({assigned_to:i.previousAssignedTo}).eq("id",i.id)))).find(i=>i.error);if(r!=null&&r.error){M("Undo failed",r.error.message),ie(!1),le(null);return}}else{const r=(await Promise.all(Ge.items.map(i=>P.from("assets").update({status:i.previousStatus}).eq("id",i.id)))).find(i=>i.error);if(r!=null&&r.error){M("Undo failed",r.error.message),ie(!1),le(null);return}}U("Undo complete",Ge.label),Rs(null),y.invalidateQueries({queryKey:["assets"]}),ie(!1),le(null)}},ha=H==="__none__"?"":H===Ke?"Assign to me":H===Oe?"Set unassigned":((mt=_.find(t=>t.id===H))==null?void 0:mt.name)??H,it=S.useCallback(()=>({q:je,status:z,category:Q,type:Z,owner:k,sortBy:q,sortDir:Y}),[je,z,Q,Z,k,q,Y]),lt=S.useCallback(t=>{fe(t.q),be(t.q),G(t.status),ye(t.category),L(t.type),ne(t.owner),xe(t.sortBy),re(t.sortDir),ve("default")},[]),xa=S.useCallback(()=>{const t=window.prompt("Saved view name");if(!t)return;const r=t.trim();if(!r)return;const i=it(),c=typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`view-${Date.now()}`;Ee(b=>{const N=b.find(I=>I.name.toLowerCase()===r.toLowerCase());if(N){const I=b.map(F=>F.id===N.id?{...F,snapshot:i,name:r}:F);return Pe(N.id),U("Saved view updated",r),I}const j={id:c,name:r,snapshot:i};return Pe(j.id),U("Saved view created",r),[...b,j]})},[it]),fa=S.useCallback(t=>{if(Pe(t),t==="none")return;const r=V.find(i=>i.id===t);r&&lt(r.snapshot)},[V,lt]),pa=S.useCallback(()=>{if(T==="none")return;const t=V.find(r=>r.id===T);Ee(r=>r.filter(i=>i.id!==T)),Pe("none"),U("Saved view deleted",t==null?void 0:t.name)},[V,T]),ga=S.useCallback(()=>{if(T==="none")return;const t=V.find(c=>c.id===T);if(!t)return;const r=window.prompt("Rename saved view",t.name);if(!r)return;const i=r.trim();i&&(Ee(c=>c.map(b=>b.id===T?{...b,name:i}:b)),U("Saved view renamed",i))},[V,T]),ya=S.useCallback(()=>{if(T==="none")return;const t=V.find(r=>r.id===T);t&&(Ee(r=>r.map(i=>i.id===T?{...i,pinned:!i.pinned}:i)),U(t.pinned?"Removed pin from saved view":"Pinned saved view",t.name))},[V,T]),ja=t=>{if(!t||typeof t!="object")return!1;const r=t;return typeof r.q=="string"&&typeof r.status=="string"&&typeof r.category=="string"&&typeof r.type=="string"&&typeof r.owner=="string"&&(r.sortBy==="updated_at"||r.sortBy==="name"||r.sortBy==="asset_code"||r.sortBy==="status")&&(r.sortDir==="asc"||r.sortDir==="desc")},ba=S.useCallback(()=>{const t=JSON.stringify(V,null,2),r=new Blob([t],{type:"application/json"}),i=window.URL.createObjectURL(r),c=document.createElement("a");c.href=i,c.download="neturai-asset-saved-views.json",document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(i),U("Saved views exported")},[V]),va=S.useCallback(async t=>{var i;const r=(i=t.target.files)==null?void 0:i[0];if(t.target.value="",!!r)try{const c=await r.text(),b=JSON.parse(c);if(!Array.isArray(b)){M("Import failed","Invalid file format");return}const N=b.filter(j=>{if(!j||typeof j!="object")return!1;const I=j;return typeof I.id=="string"&&typeof I.name=="string"&&ja(I.snapshot)}).map(j=>({id:j.id,name:j.name,pinned:!!j.pinned,snapshot:j.snapshot}));if(N.length===0){M("Import failed","No valid saved views found");return}Ee(j=>{const I=new Map(j.map(F=>[F.id,F]));return N.forEach(F=>I.set(F.id,F)),Array.from(I.values())}),U("Saved views imported",`${N.length} view(s)`)}catch{M("Import failed","Cannot read JSON file")}},[]);S.useEffect(()=>{if(typeof window>"u")return;const t=window.localStorage.getItem(kt);if(t)try{const r=JSON.parse(t);if(!Array.isArray(r))return;const i=r.filter(c=>typeof(c==null?void 0:c.id)=="string"&&typeof(c==null?void 0:c.name)=="string"&&typeof(c==null?void 0:c.snapshot)=="object"&&c.snapshot!==null);Ee(i.sort((c,b)=>!!c.pinned==!!b.pinned?c.name.localeCompare(b.name):c.pinned?-1:1))}catch{}},[]),S.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(kt,JSON.stringify(V))},[V]);const xs=T==="none"?null:V.find(t=>t.id===T)??null,wa=d.useMemo(()=>[...V].sort((t,r)=>!!t.pinned==!!r.pinned?t.name.localeCompare(r.name):t.pinned?-1:1),[V]),ot=()=>e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"rounded-lg border border-border/70 bg-card/70 p-3",children:[e.jsx("h3",{className:"mb-2 text-sm font-semibold",children:"Presets"}),e.jsxs(oe,{value:us,onValueChange:t=>Ls(t),children:[e.jsx(de,{className:"h-8 text-sm",children:e.jsx(ce,{placeholder:"Select preset"})}),e.jsxs(ue,{children:[e.jsx(v,{value:"default",children:"Default"}),e.jsx(v,{value:"my_assigned",children:"My assigned"}),e.jsx(v,{value:"in_repair",children:"In repair"}),e.jsx(v,{value:"unassigned",children:"Unassigned"})]})]})]}),e.jsxs("div",{className:"rounded-lg border border-border/70 bg-card/70 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Saved views"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(g,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:xa,children:[e.jsx(zn,{className:"mr-1 h-3.5 w-3.5"}),"Save"]}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:ba,disabled:V.length===0,"aria-label":"Export saved views",children:e.jsx(An,{className:"h-3.5 w-3.5"})}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>{var t;return(t=Bs.current)==null?void 0:t.click()},"aria-label":"Import saved views",children:e.jsx(Dn,{className:"h-3.5 w-3.5"})}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:ga,disabled:T==="none","aria-label":"Rename saved view",children:e.jsx(Ga,{className:"h-3.5 w-3.5"})}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:ya,disabled:T==="none","aria-label":"Pin saved view",children:e.jsx($n,{className:`h-3.5 w-3.5 ${xs!=null&&xs.pinned?"fill-current":""}`})}),e.jsx(g,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>ts(!0),disabled:T==="none","aria-label":"Delete saved view",children:e.jsx(Ln,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs(oe,{value:T,onValueChange:fa,children:[e.jsx(de,{className:"h-8 text-sm",children:e.jsx(ce,{placeholder:"Select saved view"})}),e.jsxs(ue,{children:[e.jsx(v,{value:"none",children:"No saved view"}),wa.map(t=>e.jsx(v,{value:t.id,children:t.pinned?`★ ${t.name}`:t.name},t.id))]})]}),e.jsx("input",{ref:Bs,type:"file",accept:"application/json",className:"hidden",onChange:va})]}),e.jsxs("div",{className:"rounded-lg border border-border/70 bg-card/70 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Status"}),e.jsxs(g,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:nt,children:[e.jsx(Tn,{className:"mr-1 h-3.5 w-3.5"}),"Reset"]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("button",{type:"button",onClick:()=>G("all"),className:`flex items-center justify-between rounded-md px-2 py-1.5 text-left text-sm transition-colors ${z==="all"?"bg-primary/10 text-primary":"hover:bg-muted"}`,children:[e.jsx("span",{children:"All"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:x.length})]}),Js.map(({status:t,count:r})=>e.jsxs("button",{type:"button",onClick:()=>G(t),className:`flex items-center justify-between rounded-md px-2 py-1.5 text-left text-sm transition-colors ${z===t?"bg-primary/10 text-primary":"hover:bg-muted"}`,children:[e.jsx("span",{children:t}),e.jsx("span",{className:"text-xs text-muted-foreground",children:r})]},t))]})]}),e.jsxs("div",{className:"rounded-lg border border-border/70 bg-card/70 p-3",children:[e.jsx("h3",{className:"mb-2 text-sm font-semibold",children:"Category"}),e.jsxs(oe,{value:Q,onValueChange:ye,children:[e.jsx(de,{className:"h-8 text-sm",children:e.jsx(ce,{placeholder:"All categories"})}),e.jsxs(ue,{children:[e.jsx(v,{value:"all",children:"All categories"}),Gs.map(t=>e.jsx(v,{value:t.id,children:t.label},t.id))]})]})]}),e.jsxs("div",{className:"rounded-lg border border-border/70 bg-card/70 p-3",children:[e.jsx("h3",{className:"mb-2 text-sm font-semibold",children:"Type"}),e.jsxs(oe,{value:Z,onValueChange:L,children:[e.jsx(de,{className:"h-8 text-sm",children:e.jsx(ce,{placeholder:"All types"})}),e.jsxs(ue,{children:[e.jsx(v,{value:"all",children:"All types"}),Zs.map(t=>e.jsx(v,{value:t.id,children:t.label},t.id))]})]})]}),e.jsxs("div",{className:"rounded-lg border border-border/70 bg-card/70 p-3",children:[e.jsx("h3",{className:"mb-2 text-sm font-semibold",children:"Owner"}),e.jsxs(oe,{value:k,onValueChange:ne,children:[e.jsx(de,{className:"h-8 text-sm",children:e.jsx(ce,{placeholder:"All owners"})}),e.jsxs(ue,{children:[e.jsx(v,{value:se,children:"All owners"}),e.jsx(v,{value:Ke,children:"Assigned to me"}),e.jsx(v,{value:Oe,children:"Unassigned"}),_.map(t=>e.jsx(v,{value:t.id,children:t.name},t.id))]})]})]})]});return W||C?e.jsxs("div",{className:"flex flex-col gap-6 p-4 md:p-6",children:[e.jsx("div",{className:"h-8 w-1/3 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-5 w-1/2 rounded bg-muted animate-pulse"}),e.jsx(En,{count:6,className:"md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3"})]}):te?e.jsxs("div",{className:"flex flex-col gap-6 p-4 md:p-6",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Asset Management"}),e.jsxs("p",{className:"text-red-500",children:["Error loading assets: ",h==null?void 0:h.message]})]}):K?e.jsxs("div",{className:"flex flex-col gap-6 p-4 md:p-6",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Asset Management"}),e.jsx("p",{className:"text-red-500",children:"Error loading users for assignment."})]}):e.jsxs("div",{className:"flex flex-col gap-6 p-4 md:p-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:"Neturai IT Manager"}),e.jsx("h1",{className:"text-3xl font-semibold tracking-tight",children:"Asset Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Track asset health, ownership, and lifecycle in one place."})]}),e.jsx(g,{className:"md:hidden self-start",onClick:()=>{m(null),me(!0)},children:"Add Asset"}),e.jsxs("div",{className:"mt-2 flex items-center justify-between rounded-md border bg-background/80 px-3 py-2 shadow-sm backdrop-blur supports-[backdrop-filter]:bg-background/60 md:sticky md:top-[68px] md:z-20 md:mt-0 lg:top-[64px]",children:[e.jsx("h2",{className:"text-lg font-semibold tracking-tight",children:"Filters & Actions"}),e.jsx(g,{className:"hidden md:inline-flex",onClick:()=>{m(null),me(!0)},children:"Add Asset"})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[280px_minmax(0,1fr)]",children:[e.jsx("aside",{className:"hidden lg:block",children:ot()}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("div",{className:"rounded-lg border border-border/70 bg-card/60 p-2",children:e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-1",children:[e.jsxs(g,{type:"button",variant:"outline",className:"h-8 lg:hidden",onClick:()=>Qs(!0),children:[e.jsx(hn,{className:"mr-1.5 h-3.5 w-3.5"}),"Filters"]}),e.jsxs("div",{className:"relative min-w-[240px] flex-1",children:[e.jsx(Ra,{className:"pointer-events-none absolute left-2.5 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(ls,{"aria-label":"Search assets",value:je,onChange:t=>fe(t.target.value),placeholder:"Search assets...",className:"h-8 pl-8 text-sm"})]}),e.jsxs(oe,{value:q,onValueChange:t=>xe(t),children:[e.jsxs(de,{"aria-label":"Sort field",className:"h-8 min-w-[150px] text-sm",children:[e.jsx(Pt,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground"}),e.jsx(ce,{placeholder:"Sort"})]}),e.jsxs(ue,{position:"popper",sideOffset:6,children:[e.jsx(v,{value:"updated_at",children:"Updated date"}),e.jsx(v,{value:"name",children:"Name"}),e.jsx(v,{value:"asset_code",children:"Asset code"}),e.jsx(v,{value:"status",children:"Status"})]})]}),e.jsxs(oe,{value:Y,onValueChange:t=>re(t),children:[e.jsxs(de,{"aria-label":"Sort direction",className:"h-8 min-w-[130px] text-sm",children:[e.jsx(Vn,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground"}),e.jsx(ce,{placeholder:"Direction"})]}),e.jsxs(ue,{position:"popper",sideOffset:6,children:[e.jsx(v,{value:"desc",children:"Descending"}),e.jsx(v,{value:"asc",children:"Ascending"})]})]}),Xe?e.jsx(g,{type:"button",variant:"secondary",className:"h-8",onClick:ra,children:"Done"}):e.jsx(g,{type:"button",variant:"outline",className:"h-8",onClick:na,children:"Select"}),e.jsxs(g,{type:"button",variant:"outline",className:"h-8",onClick:()=>void da(),disabled:A.length===0,children:[e.jsx(Rn,{className:"mr-1.5 h-3.5 w-3.5"}),"Excel"]}),e.jsxs(g,{type:"button",variant:"outline",className:"h-8",onClick:ca,disabled:A.length===0,children:[e.jsx(In,{className:"mr-1.5 h-3.5 w-3.5"}),"PDF"]}),e.jsxs($,{variant:"secondary",className:"ml-auto whitespace-nowrap",children:["Showing: ",A.length]})]})}),sa&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[je.trim().length>0&&e.jsxs($,{variant:"outline",className:"gap-1 px-2 py-1 text-xs",children:["Search: ",je.trim(),e.jsx("button",{type:"button",onClick:()=>fe(""),"aria-label":"Remove search filter",className:"text-muted-foreground hover:text-foreground",children:e.jsx(ze,{className:"h-3 w-3"})})]}),z!=="all"&&e.jsxs($,{variant:"outline",className:"gap-1 px-2 py-1 text-xs",children:["Status: ",z,e.jsx("button",{type:"button",onClick:()=>G("all"),"aria-label":"Remove status filter",className:"text-muted-foreground hover:text-foreground",children:e.jsx(ze,{className:"h-3 w-3"})})]}),tt&&e.jsxs($,{variant:"outline",className:"gap-1 px-2 py-1 text-xs",children:["Category: ",tt,e.jsx("button",{type:"button",onClick:()=>ye("all"),"aria-label":"Remove category filter",className:"text-muted-foreground hover:text-foreground",children:e.jsx(ze,{className:"h-3 w-3"})})]}),at&&e.jsxs($,{variant:"outline",className:"gap-1 px-2 py-1 text-xs",children:["Type: ",at,e.jsx("button",{type:"button",onClick:()=>L("all"),"aria-label":"Remove type filter",className:"text-muted-foreground hover:text-foreground",children:e.jsx(ze,{className:"h-3 w-3"})})]}),k===Ke&&e.jsxs($,{variant:"outline",className:"gap-1 px-2 py-1 text-xs",children:["Owner: assigned to me",e.jsx("button",{type:"button",onClick:()=>ne(se),"aria-label":"Remove owner filter",className:"text-muted-foreground hover:text-foreground",children:e.jsx(ze,{className:"h-3 w-3"})})]}),k===Oe&&e.jsxs($,{variant:"outline",className:"gap-1 px-2 py-1 text-xs",children:["Owner: unassigned",e.jsx("button",{type:"button",onClick:()=>ne(se),"aria-label":"Remove owner filter",className:"text-muted-foreground hover:text-foreground",children:e.jsx(ze,{className:"h-3 w-3"})})]}),k!==se&&k!==Ke&&k!==Oe&&e.jsxs($,{variant:"outline",className:"gap-1 px-2 py-1 text-xs",children:["Owner:"," ",((ht=_.find(t=>t.id===k))==null?void 0:ht.name)||k,e.jsx("button",{type:"button",onClick:()=>ne(se),"aria-label":"Remove owner filter",className:"text-muted-foreground hover:text-foreground",children:e.jsx(ze,{className:"h-3 w-3"})})]}),(q!==es||Y!==ss)&&e.jsxs($,{variant:"outline",className:"gap-1 px-2 py-1 text-xs",children:["Sort: ",ta," (",aa,")",e.jsx("button",{type:"button",onClick:()=>{xe(es),re(ss)},"aria-label":"Reset sorting",className:"text-muted-foreground hover:text-foreground",children:e.jsx(ze,{className:"h-3 w-3"})})]}),e.jsx(g,{variant:"ghost",size:"sm",onClick:nt,children:"Clear all"})]}),Xe&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-lg border border-primary/30 bg-primary/5 p-2",children:[e.jsxs($,{variant:"secondary",className:"whitespace-nowrap",children:["Selected: ",D.length]}),E&&e.jsx($,{variant:"outline",className:"whitespace-nowrap",children:Je==="owner"?"Updating owner...":Je==="status"?"Updating status...":Je==="delete"?"Deleting...":"Processing..."}),e.jsxs(oe,{value:H,onValueChange:Hs,disabled:E||!a,children:[e.jsx(de,{className:"h-8 min-w-[180px] text-sm",children:e.jsx(ce,{placeholder:"Assign owner..."})}),e.jsxs(ue,{children:[e.jsx(v,{value:"__none__",children:"Assign owner..."}),e.jsx(v,{value:Ke,children:"Assign to me"}),e.jsx(v,{value:Oe,children:"Set unassigned"}),_.map(t=>e.jsx(v,{value:t.id,children:t.name},t.id))]})]}),e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx("span",{className:"inline-flex",children:e.jsx(g,{variant:"outline",size:"sm",onClick:()=>p(!0),disabled:E||D.length===0||H==="__none__"||!a,children:"Assign Owner"})})}),!a&&e.jsx(Se,{children:"Admin/IT only: you do not have permission to assign assets"})]})}),e.jsxs(oe,{value:ns,onValueChange:Ws,disabled:E||!l,children:[e.jsx(de,{className:"h-8 min-w-[170px] text-sm",children:e.jsx(ce,{placeholder:"Set status..."})}),e.jsxs(ue,{children:[e.jsx(v,{value:"__none__",children:"Set status..."}),Js.map(({status:t})=>e.jsx(v,{value:t,children:t},t))]})]}),e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx("span",{className:"inline-flex",children:e.jsx(g,{variant:"outline",size:"sm",onClick:()=>ee(!0),disabled:E||D.length===0||ns==="__none__"||!l,children:"Update Status"})})}),!l&&e.jsx(Se,{children:"Admin/IT only: you do not have permission to change asset status"})]})}),e.jsx(g,{variant:"outline",size:"sm",onClick:oa,disabled:E||D.length===0,children:"Export Selected"}),e.jsx(g,{variant:"ghost",size:"sm",onClick:rs,disabled:E,children:"Clear selection"}),e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx("span",{className:"inline-flex",children:e.jsx(g,{variant:"destructive",size:"sm",onClick:()=>We(!0),disabled:E||D.length===0||!o,children:"Delete Selected"})})}),!o&&e.jsx(Se,{children:"Admin/IT only: you do not have permission to delete assets"})]})})]}),Ge&&D.length===0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-lg border border-border/70 bg-muted/30 p-2",children:[e.jsxs($,{variant:"secondary",className:"whitespace-nowrap",children:["Last: ",Ge.label]}),e.jsx(g,{variant:"outline",size:"sm",onClick:ma,disabled:E,children:E&&Je==="undo"?"Undoing...":"Undo last bulk change"})]}),e.jsx("div",{className:"rounded-md border",children:A.length===0?e.jsx(Ia,{title:"No assets found",message:"Try adjusting your filters or add a new asset."}):e.jsx(La,{columns:ea,data:A,showGlobalFilter:!1,getRowId:t=>t.id,globalFilterPlaceholder:"Search assets by name, code, type, category, location, status...",onRowClick:Xe?t=>{Ps(t)}:t=>{hs(t)}})})]})]}),e.jsx(_n,{open:Wt,onOpenChange:Qs,children:e.jsxs(Nn,{className:"max-h-[85vh]",children:[e.jsxs(Sn,{children:[e.jsx(Cn,{children:"Filters"}),e.jsx(kn,{children:"Refine assets by status, category, type, and owner."})]}),e.jsx("div",{className:"overflow-auto px-4 pb-6",children:ot()})]})}),e.jsx(fs,{open:Ds,onOpenChange:ts,children:e.jsxs(ps,{children:[e.jsxs(gs,{children:[e.jsx(ys,{children:"Delete saved view?"}),e.jsxs(js,{children:["This action cannot be undone."," ",xs?`"${xs.name}"`:"Selected view"," will be removed."]})]}),e.jsxs(bs,{children:[e.jsx(vs,{children:"Cancel"}),e.jsx(ws,{onClick:()=>{pa(),ts(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(fs,{open:f,onOpenChange:p,children:e.jsxs(ps,{children:[e.jsxs(gs,{children:[e.jsx(ys,{children:"Confirm owner update"}),e.jsxs(js,{children:["Update owner for ",D.length," selected asset(s) to"," ",e.jsx("span",{className:"font-medium text-foreground",children:ha||"selected owner"}),"?"]})]}),e.jsxs(bs,{children:[e.jsx(vs,{disabled:E,children:"Cancel"}),e.jsx(ws,{disabled:E,onClick:async()=>{await ia()&&p(!1)},children:E&&Je==="owner"?"Updating...":"Confirm"})]})]})}),e.jsx(fs,{open:Ne,onOpenChange:ee,children:e.jsxs(ps,{children:[e.jsxs(gs,{children:[e.jsx(ys,{children:"Confirm status update"}),e.jsxs(js,{children:["Update status for ",D.length," selected asset(s) to"," ",e.jsx("span",{className:"font-medium text-foreground",children:ns}),"?"]})]}),e.jsxs(bs,{children:[e.jsx(vs,{disabled:E,children:"Cancel"}),e.jsx(ws,{disabled:E,onClick:async()=>{await la()&&ee(!1)},children:E&&Je==="status"?"Updating...":"Confirm"})]})]})}),o&&e.jsx(fs,{open:ms,onOpenChange:We,children:e.jsxs(ps,{children:[e.jsxs(gs,{children:[e.jsx(ys,{children:"Delete selected assets?"}),e.jsxs(js,{children:["You are about to delete ",D.length," selected asset(s). This cannot be undone."]})]}),e.jsxs(bs,{children:[e.jsx(vs,{disabled:E,children:"Cancel"}),e.jsx(ws,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:E,onClick:()=>{We(!1),as(!0)},children:"Continue"})]})]})}),o&&e.jsx(fs,{open:Ts,onOpenChange:as,children:e.jsxs(ps,{children:[e.jsxs(gs,{children:[e.jsx(ys,{children:"Final confirmation"}),e.jsxs(js,{children:["Confirm permanent deletion for ",D.length," selected asset(s)."]})]}),e.jsxs(bs,{children:[e.jsx(vs,{disabled:E,children:"Back"}),e.jsx(ws,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:E,onClick:async()=>{await ua()&&as(!1)},children:E&&Je==="delete"?"Deleting...":"Delete permanently"})]})]})}),e.jsx(ur,{isOpen:Ye,asset:os,users:R??[],onClose:()=>{me(!1),m(null)}}),e.jsx(Cr,{asset:Ce,open:w,onClose:Xt,onEdit:Jt,users:_,hasPrev:Fs,hasNext:Us,onPrev:Gt,onNext:Zt,positionLabel:Ie>=0?`${Ie+1} / ${A.length}`:""})]})}export{Br as AssetManagement};
