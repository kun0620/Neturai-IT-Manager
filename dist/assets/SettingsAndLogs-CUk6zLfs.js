import{j as e,r,h as nt}from"./vendor-react-BzKcyMZF.js";import{u as le,b as oe,c as Qe}from"./vendor-tanstack-CEPwOq2U.js";import{u as rt,d as lt,T as ot,a as dt,b as G,c as H}from"./useSLAPolicies-tuZDm1WS.js";import{d as ct,b as O,H as ut,s as L,B as N,I as k,X as mt,m as Pe,c as De,n as c,R as Ee,S as ht,f as xt,a as C}from"./index-W22mHG5Q.js";import{L as ne}from"./label-BkL0J5XE.js";import{S as Ie}from"./switch-DfIyLQmc.js";import{S as T,a as P,b as D,c as E,d as u}from"./select-D46hviyT.js";import{u as gt,T as Me,a as ze,b as U,c as v,d as Fe,e as b}from"./useCurrentProfile-moe49XOh.js";import{o as ft,C as pt}from"./vendor-radix-I-8VOjah.js";import{u as jt,a as yt,m as vt}from"./mapLogToText-D4Ol0ras.js";import{P as bt,u as Nt}from"./useUsers-DJ4ZI8fQ.js";import{L as Es}from"./LoadingSkeleton-DDZlmnIo.js";import{A as qe,a as Re,b as Ue,c as Oe,d as Be,e as Ge,f as He,g as Ve}from"./alert-dialog-dA3_PNYJ.js";import{UserManagementPanel as _t}from"./Users-D_O-Aftn.js";import{T as St}from"./trash-2-61j_WWpg.js";import"./vendor-supabase-Dc5vJ71z.js";/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=ct("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),Is=({className:i,...n})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:O("mx-auto flex w-full justify-center",i),...n});Is.displayName="Pagination";const Ms=r.forwardRef(({className:i,...n},m)=>e.jsx("ul",{ref:m,className:O("flex flex-row items-center gap-1",i),...n}));Ms.displayName="PaginationContent";const re=r.forwardRef(({className:i,...n},m)=>e.jsx("li",{ref:m,className:O("",i),...n}));re.displayName="PaginationItem";const de=({className:i,isActive:n,size:m="icon",...p})=>e.jsx("a",{"aria-current":n?"page":void 0,className:O(ut({variant:n?"outline":"ghost",size:m}),i),...p});de.displayName="PaginationLink";const zs=({className:i,...n})=>e.jsxs(de,{"aria-label":"Go to previous page",size:"default",className:O("gap-1 pl-2.5",i),...n,children:[e.jsx(ft,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});zs.displayName="PaginationPrevious";const Fs=({className:i,...n})=>e.jsxs(de,{"aria-label":"Go to next page",size:"default",className:O("gap-1 pr-2.5",i),...n,children:[e.jsx("span",{children:"Next"}),e.jsx(pt,{className:"h-4 w-4"})]});Fs.displayName="PaginationNext";async function Ct(){const{data:i,error:n}=await L.from("ticket_categories").select("*").order("name",{ascending:!0});if(n)throw new Error(n.message);return i}async function kt(i){const{data:n,error:m}=await L.from("ticket_categories").insert(i).select().single();if(m)throw new Error(m.message);return n}async function Lt(i){const{id:n,name:m}=i,{data:p,error:g}=await L.from("ticket_categories").update({name:m,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(g)throw new Error(g.message);return p}async function At(i){const{error:n}=await L.from("ticket_categories").delete().eq("id",i);if(n)throw new Error(n.message)}function Tt(){return le({queryKey:["ticket_categories"],queryFn:Ct})}async function Pt(){const{data:i,error:n}=await L.rpc("get_issue_categories_distribution");if(n)throw new Error(n.message);return i??[]}function Dt(){return le({queryKey:["ticket_categories","stats"],queryFn:Pt})}function Et(){const i=oe();return Qe({mutationFn:kt,onSuccess:()=>{i.invalidateQueries({queryKey:["ticket_categories"]})}})}function It(){const i=oe();return Qe({mutationFn:Lt,onSuccess:()=>{i.invalidateQueries({queryKey:["ticket_categories"]})}})}function Mt(){const i=oe();return Qe({mutationFn:At,onSuccess:()=>{i.invalidateQueries({queryKey:["ticket_categories"]})}})}async function zt(i,n,m){const p=(i-1)*n;let g=L.from("logs").select(`
        *,
        profiles (
          name,
          email
        )
      `,{count:"exact"}).order("created_at",{ascending:!1}).range(p,p+n-1);m&&(g=g.or(`action.ilike.%${m}%,details::text.ilike.%${m}%`));const{data:I,error:_,count:l}=await g;if(_)throw _;return{data:I??[],count:l??0}}function Ft(i,n,m,p=!0){return le({queryKey:["logs",i,n,m],queryFn:()=>zt(i,n,m),enabled:p,placeholderData:g=>g})}function Ke({value:i,placeholder:n="—",onSave:m}){const[p,g]=r.useState(!1),[I,_]=r.useState(i??""),[l,K]=r.useState(!1);async function M(){K(!0),await m(I||null),K(!1),g(!1)}return p?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{value:I,onChange:f=>_(f.target.value),className:"h-8"}),e.jsx(N,{size:"icon",onClick:M,disabled:l,children:e.jsx(wt,{className:"h-4 w-4"})}),e.jsx(N,{size:"icon",variant:"ghost",onClick:()=>{_(i??""),g(!1)},children:e.jsx(mt,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:i||n}),e.jsx(N,{size:"icon",variant:"ghost",onClick:()=>g(!0),children:e.jsx(bt,{className:"h-4 w-4"})})]})}const ea=()=>{const i=oe(),[n,m]=nt(),p=n.get("tab"),g=["general","users","categories","sla","logs"],I=g.includes(p)?p:"general",_=I==="logs",{data:l,isLoading:K}=jt(),M=yt(),{data:f,isLoading:qs}=Tt(),{data:ce,isLoading:Rs}=Dt(),$e=Et(),Us=It(),ue=Mt(),{data:A,isLoading:Os}=rt(),me=lt(),{data:Q,isLoading:Bs}=Nt(),{isAdmin:he,isIT:xe}=gt(),[Ye,ge]=r.useState(!1),[Je,fe]=r.useState(null),[Xe,pe]=r.useState("system"),[z,$]=r.useState(null),[We,Ze]=r.useState(""),[F,je]=r.useState(null),[Gs,Y]=r.useState(!1),[Hs,ye]=r.useState(!1),[ve,es]=r.useState(!1),[J,be]=r.useState("90"),[ss,ts]=r.useState("UTC"),[X,as]=r.useState("09:00"),[W,is]=r.useState("18:00"),[ns,Ne]=r.useState("1,2,3,4,5"),[rs,_e]=r.useState("Low"),[ls,Se]=r.useState("open"),[os,we]=r.useState(""),[ds,Ce]=r.useState("120"),[cs,Z]=r.useState("10"),[us,ee]=r.useState("image/*"),[ms,ke]=r.useState(!1),[hs,Le]=r.useState("new_critical,sla_breach,reopened"),[xs,Ae]=r.useState("high"),[gs,fs]=r.useState(!1),[Vs,Ks]=r.useState(""),[ps,Qs]=r.useState(""),[S,se]=r.useState(1),js=10,B=r.useRef(null),te=r.useRef(null),{data:y,isLoading:Te}=Ft(S,js,Vs,_),{data:$s=[]}=le({queryKey:["ticket_priorities"],queryFn:async()=>{const{data:s,error:t}=await L.from("ticket_priorities").select("id, name");if(t)throw t;return s??[]}}),w=s=>s instanceof Error?s.message:"Unknown error";r.useEffect(()=>{var t,a,h,d,x,ie,Ns,_s,Ss,ws,Cs,ks,Ls,As,Ts,Ps,Ds;if(!l)return;ge(((t=l.find(o=>o.key==="email_notifications_enabled"))==null?void 0:t.value)==="true");const s=(a=l.find(o=>o.key==="default_assignee_id"))==null?void 0:a.value;fe(s??null),pe(((h=l.find(o=>o.key==="theme_default"))==null?void 0:h.value)||"system"),be(((d=l.find(o=>o.key==="logs_retention_days"))==null?void 0:d.value)||"90"),ts(((x=l.find(o=>o.key==="business_timezone"))==null?void 0:x.value)||"UTC"),as(((ie=l.find(o=>o.key==="business_hours_start"))==null?void 0:ie.value)||"09:00"),is(((Ns=l.find(o=>o.key==="business_hours_end"))==null?void 0:Ns.value)||"18:00"),Ne(((_s=l.find(o=>o.key==="business_days"))==null?void 0:_s.value)||"1,2,3,4,5"),_e(((Ss=l.find(o=>o.key==="default_ticket_priority"))==null?void 0:Ss.value)||"Low"),Se(((ws=l.find(o=>o.key==="default_ticket_status"))==null?void 0:ws.value)||"open"),we(((Cs=l.find(o=>o.key==="default_ticket_category_id"))==null?void 0:Cs.value)||""),Ce(((ks=l.find(o=>o.key==="session_idle_timeout_minutes"))==null?void 0:ks.value)||"120"),Z(((Ls=l.find(o=>o.key==="attachment_max_size_mb"))==null?void 0:Ls.value)||"10"),ee(((As=l.find(o=>o.key==="attachment_allowed_types"))==null?void 0:As.value)||"image/*"),ke(((Ts=l.find(o=>o.key==="line_group_notify_enabled"))==null?void 0:Ts.value)==="true"),Le(((Ps=l.find(o=>o.key==="line_group_notify_events"))==null?void 0:Ps.value)||"new_critical,sla_breach,reopened"),Ae(((Ds=l.find(o=>o.key==="line_group_notify_min_priority"))==null?void 0:Ds.value)||"high")},[l,Q]);const ys=[{key:"new_critical",label:"New critical ticket",description:"Alert when a critical ticket is created."},{key:"sla_breach",label:"SLA breach",description:"Alert when a ticket enters SLA breach."},{key:"reopened",label:"Ticket reopened",description:"Alert when a closed ticket gets reopened."},{key:"new_high",label:"New high ticket",description:"Alert when a high-priority ticket is created."},{key:"assigned",label:"Ticket assigned",description:"Alert when assignee changes on a ticket."}],vs=s=>new Set(s.split(",").map(t=>t.trim().toLowerCase()).filter(Boolean)),Ys=s=>ys.map(t=>t.key).filter(t=>s.has(t)).join(","),Js=async()=>{fs(!0);try{const{data:s,error:t}=await L.rpc("enqueue_line_group_test_notification",{p_message:"Test alert from Settings page"});if(t)throw t;C("LINE test queued",`Job id: ${s}`)}catch(s){c("Failed to queue LINE test",w(s))}finally{fs(!1)}},j=async(s,t,a,h)=>{$(s);try{await M.mutateAsync({key:s,value:t}),C(h??"Setting updated")}catch(d){c("Failed to update setting",w(d)),a==null||a()}finally{$(null)}},Xs=s=>{s.preventDefault(),B.current&&(te.current=B.current.scrollTop),se(1),Ks(ps.trim())};r.useEffect(()=>{!_||Te||te.current!==null&&B.current&&(B.current.scrollTop=te.current,te.current=null)},[_,Te,y==null?void 0:y.data]);const q=he||xe,ae=he||xe,Ws=he||xe,Zs=async()=>{if(!q){c("Permission denied","You cannot edit categories");return}const s=We.trim();if(!s){c("Category name required");return}if(f==null?void 0:f.some(a=>a.name.trim().toLowerCase()===s.toLowerCase())){c("Category already exists");return}try{await $e.mutateAsync({name:s}),C("Category added"),Ze("")}catch(a){c("Failed to add category",w(a))}},et=async(s,t,a)=>{if(!q){c("Permission denied","You cannot edit categories");return}const h=(a??"").trim();if(!h){c("Category name required");return}if(h===t)return;if(f==null?void 0:f.some(x=>x.id!==s&&x.name.trim().toLowerCase()===h.toLowerCase())){c("Category already exists");return}try{await Us.mutateAsync({id:s,name:h}),C("Category updated")}catch(x){c("Failed to update category",w(x))}},st=async()=>{if(F)try{await ue.mutateAsync(F.id),C("Category deleted")}catch(s){c("Failed to delete category",w(s))}finally{je(null)}},bs=async(s,t,a,h)=>{if(!ae){c("Permission denied","You cannot edit SLA policies");return}const d=(a??"").trim();if(!d){c("Value required");return}const x=Number(d);if(!Number.isFinite(x)||x<0){c("Invalid number","Please enter a non-negative number");return}if(x!==h)try{await me.mutateAsync({id:s,[t]:x}),C("SLA policy updated")}catch(ie){c("Failed to update SLA policy",w(ie))}},tt=async()=>{if(!(A!=null&&A.length)){Y(!1);return}const s={Low:{response:48,resolution:168},Medium:{response:24,resolution:72},High:{response:8,resolution:24},Critical:{response:1,resolution:4}};try{await Promise.all(A.map(t=>{const a=s[t.priority??""];return a?me.mutateAsync({id:t.id,response_time_hours:a.response,resolution_time_hours:a.resolution}):Promise.resolve()})),C("SLA policies reset to defaults")}catch(t){c("Failed to reset SLA policies",w(t))}finally{Y(!1)}},at=async()=>{const s=Number(J);if(!Number.isFinite(s)||s<1){c("Invalid retention","Retention must be at least 1 day");return}es(!0);try{const{data:t,error:a}=await L.rpc("purge_old_logs",{p_retention_days:s});if(a)throw a;C("Logs purged",`${typeof t=="number"?t:0} old logs were removed`),await i.invalidateQueries({queryKey:["logs"]})}catch(t){c("Failed to purge logs",w(t))}finally{es(!1),ye(!1)}},it=async()=>{const s=/^([01]\d|2[0-3]):([0-5]\d)$/;if(!s.test(X)||!s.test(W)){c("Invalid time","Use 24-hour format HH:MM");return}if(X>=W){c("Invalid window","Start time must be earlier than end time");return}const t=ns.split(",").map(d=>Number(d.trim())).filter(d=>Number.isInteger(d)&&d>=1&&d<=7);if(!t.length){c("Invalid business days","Use comma-separated values from 1 to 7");return}const a=Array.from(new Set(t)).sort((d,x)=>d-x).join(","),h=ss.trim()||"UTC";$("business_calendar");try{await Promise.all([M.mutateAsync({key:"business_timezone",value:h}),M.mutateAsync({key:"business_hours_start",value:X}),M.mutateAsync({key:"business_hours_end",value:W}),M.mutateAsync({key:"business_days",value:a})]),Ne(a),C("Business calendar updated")}catch(d){c("Failed to save business calendar",w(d))}finally{$(null)}},R=y?Math.ceil(y.count/js):0;return K||qs||Rs||Os||Bs?e.jsxs("div",{className:"flex flex-col gap-6 p-4 md:p-6",children:[e.jsx("div",{className:"h-8 w-1/3 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-5 w-1/2 rounded bg-muted animate-pulse"}),e.jsx(Es,{count:6,className:"md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3"})]}):e.jsxs(Pe.div,{className:"flex flex-col gap-6 p-4 md:p-6",...De(0),children:[e.jsxs(Pe.div,{className:"space-y-2",...De(.04),children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:"Neturai IT Manager"}),e.jsx("h1",{className:"text-3xl font-semibold",children:"Settings & Logs"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage system configuration and audit activity."})]}),e.jsx(Pe.div,{...De(.08),children:e.jsxs(ot,{value:I,onValueChange:s=>{g.includes(s)&&m({tab:s})},children:[e.jsxs(dt,{className:"bg-muted/40 p-1 rounded-lg w-fit",children:[e.jsx(G,{value:"general",children:"General"}),e.jsx(G,{value:"users",children:"Users & Roles"}),e.jsx(G,{value:"categories",children:"Categories"}),e.jsx(G,{value:"sla",children:"SLA Policies"}),e.jsx(G,{value:"logs",children:"System Logs"})]}),e.jsx(H,{value:"general",className:"mt-6",children:e.jsx(V,{title:"General Settings",description:"Basic system configuration",children:e.jsxs("div",{className:"space-y-6 max-w-xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Email Notifications"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Receive ticket updates by email"})]}),e.jsx(Ie,{checked:Ye,disabled:z==="email_notifications_enabled",onCheckedChange:s=>{const t=Ye;ge(s),j("email_notifications_enabled",s?"true":"false",()=>ge(t),"Email notifications updated")}})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Default Assignee"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Automatically assigned user"}),e.jsx("div",{className:"mt-2 max-w-sm",children:e.jsxs(T,{value:Je??"",onValueChange:s=>{const t=Je;fe(s||null),j("default_assignee_id",s||"",()=>fe(t),"Default assignee updated")},disabled:z==="default_assignee_id",children:[e.jsx(P,{children:e.jsx(D,{placeholder:"Select assignee"})}),e.jsxs(E,{position:"popper",sideOffset:6,children:[e.jsx(u,{value:"",children:"Unassigned"}),Q==null?void 0:Q.map(s=>e.jsx(u,{value:s.id,children:s.name||s.email||s.id},s.id))]})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Default Theme"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Application appearance"}),e.jsx("div",{className:"mt-2 max-w-xs",children:e.jsxs(T,{value:Xe,onValueChange:s=>{const t=Xe;pe(s),j("theme_default",s,()=>pe(t),"Default theme updated")},disabled:z==="theme_default",children:[e.jsx(P,{children:e.jsx(D,{placeholder:"Select theme"})}),e.jsxs(E,{position:"popper",sideOffset:6,children:[e.jsx(u,{value:"system",children:"System"}),e.jsx(u,{value:"light",children:"Light"}),e.jsx(u,{value:"dark",children:"Dark"})]})]})})]}),e.jsxs("div",{className:"rounded-md border border-border/70 bg-muted/20 p-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium",children:"Default ticket workflow"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Applied when creating new tickets."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-muted-foreground",children:"Category"}),e.jsxs(T,{value:os||"__none__",onValueChange:s=>{const t=os,a=s==="__none__"?"":s;we(a),j("default_ticket_category_id",a,()=>we(t),"Default category updated")},children:[e.jsx(P,{children:e.jsx(D,{placeholder:"Default category"})}),e.jsxs(E,{position:"popper",sideOffset:6,children:[e.jsx(u,{value:"__none__",children:"None"}),f==null?void 0:f.map(s=>e.jsx(u,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-muted-foreground",children:"Priority"}),e.jsxs(T,{value:rs,onValueChange:s=>{const t=rs;_e(s),j("default_ticket_priority",s,()=>_e(t),"Default priority updated")},children:[e.jsx(P,{children:e.jsx(D,{placeholder:"Default priority"})}),e.jsx(E,{position:"popper",sideOffset:6,children:$s.map(s=>e.jsx(u,{value:s.name,children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-muted-foreground",children:"Status"}),e.jsxs(T,{value:ls,onValueChange:s=>{const t=ls;Se(s),j("default_ticket_status",s,()=>Se(t),"Default status updated")},children:[e.jsx(P,{children:e.jsx(D,{placeholder:"Default status"})}),e.jsxs(E,{position:"popper",sideOffset:6,children:[e.jsx(u,{value:"open",children:"Open"}),e.jsx(u,{value:"in_progress",children:"In progress"}),e.jsx(u,{value:"closed",children:"Closed"})]})]})]})]})]}),e.jsxs("div",{className:"rounded-md border border-border/70 bg-muted/20 p-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium",children:"Security"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Automatically sign out users after inactivity."})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:max-w-xs",children:[e.jsx(ne,{children:"Idle session timeout"}),e.jsxs(T,{value:ds,onValueChange:s=>{const t=ds;Ce(s),j("session_idle_timeout_minutes",s,()=>Ce(t),"Security setting updated")},children:[e.jsx(P,{children:e.jsx(D,{placeholder:"Select timeout"})}),e.jsxs(E,{position:"popper",sideOffset:6,children:[e.jsx(u,{value:"0",children:"Disabled"}),e.jsx(u,{value:"15",children:"15 minutes"}),e.jsx(u,{value:"30",children:"30 minutes"}),e.jsx(u,{value:"60",children:"1 hour"}),e.jsx(u,{value:"120",children:"2 hours"}),e.jsx(u,{value:"240",children:"4 hours"})]})]})]})]}),e.jsxs("div",{className:"rounded-md border border-border/70 bg-muted/20 p-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium",children:"Attachment policy"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Enforce allowed file types and maximum upload size."})]}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-[220px_minmax(0,1fr)]",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(ne,{htmlFor:"attachment-max-size-mb",className:"flex min-h-[40px] items-end",children:"Max file size (MB)"}),e.jsx(k,{id:"attachment-max-size-mb",inputMode:"numeric",className:"h-9",value:cs,onChange:s=>Z(s.target.value),onBlur:()=>{var t;const s=Number(cs);if(!Number.isFinite(s)||s<1||s>100){c("Invalid attachment size","Use a number between 1 and 100 MB"),Z(((t=l==null?void 0:l.find(a=>a.key==="attachment_max_size_mb"))==null?void 0:t.value)||"10");return}j("attachment_max_size_mb",String(Math.floor(s)),()=>{var a;return Z(((a=l==null?void 0:l.find(h=>h.key==="attachment_max_size_mb"))==null?void 0:a.value)||"10")},"Attachment max size updated")}})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(ne,{htmlFor:"attachment-allowed-types",className:"flex min-h-[40px] items-end",children:"Allowed types"}),e.jsx(k,{id:"attachment-allowed-types",className:"h-9",value:us,onChange:s=>ee(s.target.value),onBlur:()=>{var t;const s=us.split(",").map(a=>a.trim()).filter(Boolean).join(",");if(!s){c("Invalid allowed types","At least one type is required"),ee(((t=l==null?void 0:l.find(a=>a.key==="attachment_allowed_types"))==null?void 0:t.value)||"image/*");return}j("attachment_allowed_types",s,()=>{var a;return ee(((a=l==null?void 0:l.find(h=>h.key==="attachment_allowed_types"))==null?void 0:a.value)||"image/*")},"Attachment allowed types updated")}}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Comma-separated MIME or extension, e.g. image/*,.png,.jpg"})]})]})]}),e.jsxs("div",{className:"rounded-md border border-border/70 bg-muted/20 p-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium",children:"LINE group alert policy"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Configure high-signal alerts only for shared group channel."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 rounded-md border border-border/60 bg-background/60 px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Send test notification"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Queue a test message to verify LINE delivery flow."})]}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>void Js(),disabled:gs,children:gs?"Queueing...":"Send test"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-md border border-border/60 bg-background/60 px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Enable LINE group alerts"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Keep disabled until sender integration is ready."})]}),e.jsx(Ie,{checked:ms,disabled:z==="line_group_notify_enabled",onCheckedChange:s=>{const t=ms;ke(s),j("line_group_notify_enabled",s?"true":"false",()=>ke(t),"LINE group alert setting updated")}})]}),e.jsx("div",{className:"grid gap-2",children:ys.map(s=>{const t=vs(hs).has(s.key);return e.jsxs("div",{className:"flex items-center justify-between rounded-md border border-border/60 bg-background/60 px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:s.label}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.description})]}),e.jsx(Ie,{checked:t,disabled:z==="line_group_notify_events",onCheckedChange:a=>{const h=hs,d=vs(h);a?d.add(s.key):d.delete(s.key);const x=Ys(d);Le(x),j("line_group_notify_events",x,()=>Le(h),"LINE group events updated")}})]},s.key)})}),e.jsxs("div",{className:"flex max-w-xs flex-col gap-2",children:[e.jsx(ne,{children:"Minimum priority"}),e.jsxs(T,{value:xs,onValueChange:s=>{const t=xs;Ae(s),j("line_group_notify_min_priority",s,()=>Ae(t),"LINE group min priority updated")},children:[e.jsx(P,{children:e.jsx(D,{placeholder:"Select minimum priority"})}),e.jsxs(E,{position:"popper",sideOffset:6,children:[e.jsx(u,{value:"medium",children:"Medium"}),e.jsx(u,{value:"high",children:"High"}),e.jsx(u,{value:"critical",children:"Critical"})]})]})]})]})]})]})})}),e.jsx(H,{value:"users",className:"mt-6",children:e.jsx(V,{title:"Users & Roles",description:"Manage access control and profile administration",children:e.jsx(_t,{embedded:!0})})}),e.jsx(H,{value:"categories",className:"mt-6",children:e.jsx(V,{title:"Issue Categories",description:"Ticket classification",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Manage categories"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Add, rename, or remove ticket categories"})]}),q&&e.jsxs("div",{className:"flex w-full gap-2 sm:w-auto",children:[e.jsx(k,{placeholder:"New category name",value:We,onChange:s=>Ze(s.target.value),className:"h-9"}),e.jsx(N,{onClick:Zs,disabled:$e.isPending,children:"Add"})]})]}),f!=null&&f.length?e.jsxs(Me,{children:[e.jsx(ze,{children:e.jsxs(U,{children:[e.jsx(v,{children:"Name"}),e.jsx(v,{className:"w-[140px] text-right",children:"Tickets"}),q&&e.jsx(v,{className:"w-[120px] text-right",children:"Actions"})]})}),e.jsx(Fe,{children:f.map(s=>{var t;return e.jsxs(U,{children:[e.jsx(b,{className:"font-medium",children:q?e.jsx(Ke,{value:s.name,onSave:a=>et(s.id,s.name,a)}):s.name}),e.jsx(b,{className:"text-right tabular-nums",children:((t=ce==null?void 0:ce.find(a=>a.category===s.name))==null?void 0:t.count)??0}),q&&e.jsx(b,{className:"text-right",children:e.jsx(N,{size:"icon",variant:"ghost",onClick:()=>je({id:s.id,name:s.name}),children:e.jsx(St,{className:"h-4 w-4"})})})]},s.id)})})]}):e.jsx(Ee,{title:"No Categories",message:"No issue categories defined"})]})})}),e.jsx(H,{value:"sla",className:"mt-6",children:e.jsx(V,{title:"SLA Policies",description:"Response & resolution targets",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-md border border-border/70 bg-muted/20 p-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"font-medium",children:"Business hours & calendar"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"SLA due dates are calculated using timezone, workday window, and business days."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-muted-foreground",children:"Timezone"}),e.jsx(k,{value:ss,onChange:s=>ts(s.target.value),placeholder:"UTC"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-muted-foreground",children:"Start time"}),e.jsx(k,{type:"time",value:X,onChange:s=>as(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-muted-foreground",children:"End time"}),e.jsx(k,{type:"time",value:W,onChange:s=>is(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-xs text-muted-foreground",children:"Business days (1-7)"}),e.jsx(k,{value:ns,onChange:s=>Ne(s.target.value),placeholder:"1,2,3,4,5"})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Example: Mon-Fri = 1,2,3,4,5 (ISO weekday; 7 = Sunday)"}),e.jsx(N,{onClick:()=>void it(),disabled:z==="business_calendar",children:"Save calendar"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Edit response and resolution targets per priority"}),ae&&e.jsx(N,{variant:"secondary",onClick:()=>Y(!0),children:"Reset to defaults"})]}),A!=null&&A.length?e.jsxs(Me,{children:[e.jsx(ze,{children:e.jsxs(U,{children:[e.jsx(v,{children:"Priority"}),e.jsx(v,{children:"Response (hrs)"}),e.jsx(v,{children:"Resolution (hrs)"})]})}),e.jsx(Fe,{children:A.map(s=>e.jsxs(U,{children:[e.jsx(b,{className:"font-medium",children:s.priority}),e.jsx(b,{children:ae?e.jsx(Ke,{value:String(s.response_time_hours??0),onSave:t=>bs(s.id,"response_time_hours",t,s.response_time_hours??0)}):s.response_time_hours}),e.jsx(b,{children:ae?e.jsx(Ke,{value:String(s.resolution_time_hours??0),onSave:t=>bs(s.id,"resolution_time_hours",t,s.resolution_time_hours??0)}):s.resolution_time_hours})]},s.id))})]}):e.jsx(Ee,{title:"No SLA Policies",message:"Define SLA rules per priority"})]})})}),e.jsx(H,{value:"logs",className:"mt-6 space-y-4",children:e.jsxs(V,{title:"System Logs",description:"Audit trail of system activity",children:[Ws&&e.jsx("div",{className:"mb-4 rounded-md border border-border/70 bg-muted/20 p-3",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Log retention policy"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Logs older than this threshold are eligible for purge."})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsx("div",{className:"w-full sm:w-[170px]",children:e.jsxs(T,{value:J,onValueChange:s=>{const t=J;be(s),j("logs_retention_days",s,()=>be(t),"Log retention updated")},disabled:z==="logs_retention_days",children:[e.jsx(P,{className:"h-9",children:e.jsx(D,{placeholder:"Retention"})}),e.jsxs(E,{position:"popper",sideOffset:6,children:[e.jsx(u,{value:"30",children:"30 days"}),e.jsx(u,{value:"90",children:"90 days"}),e.jsx(u,{value:"180",children:"180 days"}),e.jsx(u,{value:"365",children:"365 days"})]})]})}),e.jsx(N,{type:"button",variant:"outline",className:"h-9",onClick:()=>ye(!0),disabled:ve,children:"Purge old logs"})]})]})}),e.jsxs("form",{onSubmit:Xs,className:"flex gap-2 mb-4",children:[e.jsx(k,{placeholder:"Search logs...",value:ps,onChange:s=>Qs(s.target.value)}),e.jsxs(N,{type:"submit",variant:"secondary",children:[e.jsx(ht,{className:"h-4 w-4 mr-1"}),"Search"]})]}),Te?e.jsx(Es,{count:6,className:"md:grid-cols-1"}):y!=null&&y.data.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:B,className:"rounded-md border max-h-[420px] overflow-y-auto",children:e.jsxs(Me,{children:[e.jsx(ze,{children:e.jsxs(U,{children:[e.jsx(v,{children:"Time"}),e.jsx(v,{children:"User"}),e.jsx(v,{children:"Action"}),e.jsx(v,{children:"Details"})]})}),e.jsx(Fe,{children:y.data.map(s=>{var t,a;return e.jsxs(U,{children:[e.jsx(b,{children:s.created_at?xt(new Date(s.created_at),"yyyy-MM-dd HH:mm:ss"):"—"}),e.jsx(b,{children:((t=s.profiles)==null?void 0:t.name)||((a=s.profiles)==null?void 0:a.email)||"—"}),e.jsx(b,{children:s.action}),e.jsx(b,{className:"space-y-1",children:(()=>{const h=s.details??null,{title:d,description:x}=vt(s.action,h);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium",children:d}),x&&e.jsx("div",{className:"text-sm text-muted-foreground whitespace-pre-line",children:x})]})})()})]},s.id)})})]})}),R>1&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Page ",S," of ",R," • Total ",(y==null?void 0:y.count)??0," logs"]}),e.jsx(Is,{children:e.jsxs(Ms,{children:[e.jsx(re,{children:e.jsx(zs,{"aria-disabled":S<=1,className:S<=1?"pointer-events-none opacity-50":"",onClick:()=>{S<=1||se(s=>s-1)}})}),Array.from({length:R},(s,t)=>e.jsx(re,{children:e.jsx(de,{isActive:S===t+1,onClick:()=>se(t+1),children:t+1})},t)),e.jsx(re,{children:e.jsx(Fs,{"aria-disabled":S>=R,className:S>=R?"pointer-events-none opacity-50":"",onClick:()=>{S>=R||se(s=>s+1)}})})]})})]})]}):e.jsx(Ee,{title:"No Logs",message:"No system activity recorded"})]})})]})}),e.jsx(qe,{open:!!F,onOpenChange:s=>{s||je(null)},children:e.jsxs(Re,{children:[e.jsxs(Ue,{children:[e.jsx(Oe,{children:"Delete category"}),e.jsxs(Be,{children:['This will permanently remove "',F==null?void 0:F.name,'". Existing tickets may lose their category.']})]}),e.jsxs(Ge,{children:[e.jsx(He,{disabled:ue.isPending,children:"Cancel"}),e.jsx(Ve,{onClick:st,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:ue.isPending,children:"Delete"})]})]})}),e.jsx(qe,{open:Gs,onOpenChange:Y,children:e.jsxs(Re,{children:[e.jsxs(Ue,{children:[e.jsx(Oe,{children:"Reset SLA policies"}),e.jsx(Be,{children:"This will restore default response and resolution times for all priorities."})]}),e.jsxs(Ge,{children:[e.jsx(He,{children:"Cancel"}),e.jsx(Ve,{onClick:tt,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:me.isPending,children:"Reset"})]})]})}),e.jsx(qe,{open:Hs,onOpenChange:ye,children:e.jsxs(Re,{children:[e.jsxs(Ue,{children:[e.jsx(Oe,{children:"Purge old logs"}),e.jsxs(Be,{children:["This will permanently remove system logs older than ",J," days. This action cannot be undone."]})]}),e.jsxs(Ge,{children:[e.jsx(He,{disabled:ve,children:"Cancel"}),e.jsx(Ve,{onClick:at,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:ve,children:"Purge"})]})]})})]})};function V({title:i,description:n,children:m}){return e.jsxs("section",{className:"rounded-lg border bg-card",children:[e.jsxs("div",{className:"border-b px-6 py-4",children:[e.jsx("h2",{className:"font-semibold",children:i}),n&&e.jsx("p",{className:"text-sm text-muted-foreground",children:n})]}),e.jsx("div",{className:"px-6 py-4",children:m})]})}export{ea as SettingsAndLogs};
