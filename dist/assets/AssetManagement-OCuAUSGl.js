const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Tickets-xgl4QFFP.js","assets/index-C_wQioo6.js","assets/vendor-react-CQhyLJhi.js","assets/vendor-charts-yMFR7OPP.js","assets/vendor-radix-GaIC7jQ4.js","assets/vendor-supabase-ERkXFu1W.js","assets/vendor-tanstack-CEdBqcEP.js","assets/index-BsSDTWCA.css","assets/tabs-u7_umfqf.js","assets/useCurrentProfile-Bk_xV3Os.js","assets/TicketDetailsDrawer-BgcFYyZP.js","assets/label-jewdQlVz.js","assets/drawer-CSXHei8r.js","assets/subDays-CxkVo8Mp.js","assets/badge-07SJJ_S6.js","assets/mapLogToText-BvzNOTVA.js","assets/card-CkIEAavX.js","assets/rotate-ccw-7FFnarTx.js"])))=>i.map(i=>d[i]);
import{d as Fe,t as me,i as ba,l as yt,p as va,q as wa,D as jt,E as Es,s as U,I as ls,F as _a,B as y,L as _s,a as H,f as Ns,n as V,b as _e,G as Na,H as Sa,J as Ca,K as ka,M as Aa,N as Da,e as kt,_ as At,S as Ta,X as qe,O as Ma}from"./index-C_wQioo6.js";import{j as e,r as d,u as Ia,g as Ra,R as S}from"./vendor-react-CQhyLJhi.js";import{i as Dt,D as Ea,A as fs,a as ps,b as gs,c as ys,d as js,e as bs,f as vs,g as ws}from"./alert-dialog-jimNj9Mg.js";import{c as Oa,u as La,a as Va,o as Ua,r as Fa,d as za,s as Ee,n as Pa}from"./schemas-BeLAdFg6.js";import{u as $s,D as qa,k as $a,l as Ka,m as Ba,n as Qa,S as oe,f as de,g as ce,i as ue,j as v,o as Ya}from"./useCurrentProfile-Bk_xV3Os.js";import{L as Tt}from"./label-jewdQlVz.js";import{u as Qe,b as Ks,c as Ha}from"./vendor-tanstack-CEdBqcEP.js";import{l as As}from"./logSystemAction-D1GDDIHv.js";import{u as Wa,P as Xa,T as Ja}from"./useUsers-9LiriRzz.js";import{B as P}from"./badge-07SJJ_S6.js";import{w as Ga,x as Za,y as en,z as Mt,A as sn,I as tn,H as an,B as It,E as nn,F as Rt,G as rn,J as ln,K as Et,L as on,M as dn,N as Ot,O as Lt,Q as Vt,U as Ut,W as cn,h as un}from"./vendor-radix-GaIC7jQ4.js";import{A as Ft,L as mn,R as hn}from"./rotate-ccw-7FFnarTx.js";import{f as xn,g as fn,U as pn,h as gn,P as yn,C as jn,a as bn,D as vn,b as wn,c as _n,d as Nn,e as Sn}from"./drawer-CSXHei8r.js";import{L as Cn}from"./LoadingSkeleton-igMf2rTD.js";import{D as kn}from"./download-CPP82sS_.js";import"./vendor-charts-yMFR7OPP.js";import"./vendor-supabase-ERkXFu1W.js";/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const An=Fe("ArrowDownUp",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"m21 8-4-4-4 4",key:"1c9v7m"}],["path",{d:"M17 4v16",key:"7dpous"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=Fe("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dn=Fe("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tn=Fe("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=Fe("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const In=Fe("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rn=Fe("Sliders",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const En=Fe("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.321.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const On=Fe("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function Os(s,n){const a=me(s),l=me(n),o=a.getTime()-l.getTime();return o<0?-1:o>0?1:o}function Ln(s){return ba(s,Date.now())}function Vn(s){return n=>{const l=(s?Math[s]:Math.trunc)(n);return l===0?0:l}}function Un(s,n){return+me(s)-+me(n)}function Fn(s){const n=me(s);return n.setHours(23,59,59,999),n}function zn(s){const n=me(s);return+Fn(n)==+xn(n)}function Pn(s,n){const a=me(s),l=me(n),o=Os(a,l),u=Math.abs(fn(a,l));let g;if(u<1)g=0;else{a.getMonth()===1&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-o*u);let x=Os(a,l)===-o;zn(me(s))&&u===1&&Os(s,l)===1&&(x=!1),g=o*(u-Number(x))}return g===0?0:g}function qn(s,n,a){const l=Un(s,n)/1e3;return Vn(a==null?void 0:a.roundingMethod)(l)}function $n(s,n,a){const l=va(),o=(a==null?void 0:a.locale)??l.locale??wa,u=2520,g=Os(s,n);if(isNaN(g))throw new RangeError("Invalid time value");const x=Object.assign({},a,{addSuffix:a==null?void 0:a.addSuffix,comparison:g});let W,te;g>0?(W=me(n),te=me(s)):(W=me(s),te=me(n));const h=qn(te,W),M=(yt(te)-yt(W))/1e3,C=Math.round((h-M)/60);let q;if(C<2)return a!=null&&a.includeSeconds?h<5?o.formatDistance("lessThanXSeconds",5,x):h<10?o.formatDistance("lessThanXSeconds",10,x):h<20?o.formatDistance("lessThanXSeconds",20,x):h<40?o.formatDistance("halfAMinute",0,x):h<60?o.formatDistance("lessThanXMinutes",1,x):o.formatDistance("xMinutes",1,x):C===0?o.formatDistance("lessThanXMinutes",1,x):o.formatDistance("xMinutes",C,x);if(C<45)return o.formatDistance("xMinutes",C,x);if(C<90)return o.formatDistance("aboutXHours",1,x);if(C<jt){const _=Math.round(C/60);return o.formatDistance("aboutXHours",_,x)}else{if(C<u)return o.formatDistance("xDays",1,x);if(C<Es){const _=Math.round(C/jt);return o.formatDistance("xDays",_,x)}else if(C<Es*2)return q=Math.round(C/Es),o.formatDistance("aboutXMonths",q,x)}if(q=Pn(te,W),q<12){const _=Math.round(C/Es);return o.formatDistance("xMonths",_,x)}else{const _=q%12,L=Math.trunc(q/12);return _<3?o.formatDistance("aboutXYears",L,x):_<9?o.formatDistance("overXYears",L,x):o.formatDistance("almostXYears",L+1,x)}}function Kn(s,n){return $n(s,Ln(s),n)}async function Bn(){const{data:s,error:n}=await U.from("asset_types").select("id, key, name, icon").order("name");if(n)throw n;return s??[]}function Qn(){return Qe({queryKey:["asset-types"],queryFn:Bn})}async function Yn(s){const{data:n,error:a}=await U.from("asset_fields").select("*").eq("asset_type_id",s).order("created_at");if(a)throw a;return(n??[]).map(l=>({id:l.id,key:l.field_key,label:l.field_label,type:l.field_type,required:l.is_required??!1,options:l.options}))}function zt(s){return Qe({queryKey:["asset-fields",s],queryFn:()=>Yn(s),enabled:!!s})}async function Hn(s){const{data:n,error:a}=await U.from("asset_field_values").select(`
      value_text,
      asset_fields!inner (
        field_key
      )
    `).eq("asset_id",s);if(a)throw a;const l={};return(n??[]).forEach(o=>{l[o.asset_fields.field_key]=o.value_text??""}),l}function Pt(s){return Qe({queryKey:["asset-field-values",s],queryFn:()=>Hn(s),enabled:!!s})}async function vt({assetId:s,values:n,fields:a}){const l=a.filter(u=>n[u.key]!==void 0).map(u=>({asset_id:s,field_id:u.id,value_text:n[u.key]}));if(l.length===0)return;const{error:o}=await U.from("asset_field_values").upsert(l,{onConflict:"asset_id,field_id"});if(o)throw o}function Wn({field:s,control:n}){const{field:a}=Oa({name:`custom.${s.key}`,control:n,defaultValue:""});return e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Tt,{className:"text-right",children:s.label}),e.jsx("div",{className:"col-span-3",children:e.jsx(ls,{...a})})]})}function Xn({fields:s,control:n}){return e.jsx(e.Fragment,{children:s.map(a=>e.jsx(Wn,{field:a,control:n},a.id))})}const wt=s=>s==null?null:String(s);function Jn(s,n,a){return a.map(l=>{const o=wt(s[l]),u=wt(n[l]);return o===u?null:{field:l,oldValue:o,newValue:u}}).filter(Boolean)}const Gn=["name","asset_code","status","location","assigned_to","category_id","asset_type_id"];async function Zn(s,n,a,l){const{error:o}=await U.from("assets").update(a).eq("id",s);if(o)throw o;const u={...n,...a},g=Jn(n,u,Gn);g.length!==0&&await Dt(g.map(x=>({assetId:s,action:x.field==="status"?"status_change":"update",field:x.field,oldValue:x.oldValue,newValue:x.newValue,performedBy:l})))}async function er(){const{data:s,error:n}=await U.from("asset_categories").select("id, name").order("name",{ascending:!0});if(n)throw n;return s??[]}function sr(){return Qe({queryKey:["asset-categories"],queryFn:er})}const tr={};async function ar(s,n){const{data:a,error:l}=await U.from("assets").insert(s).select("id").single();if(l)throw l;return await Dt([{assetId:a.id,action:"create",field:"*",oldValue:null,newValue:"created",performedBy:n}]),a}const Ps={Available:"Available",Assigned:"Assigned",InRepair:"In Repair",Retired:"Retired",Lost:"Lost"},nr=Ua({name:Ee().min(1),asset_code:Ee().min(1),asset_type_id:Ee().uuid(),category_id:Ee().uuid().nullable().optional(),status:Pa(Ps),assigned_to:Ee().uuid().nullable().optional(),serial_number:Ee().nullable().optional(),location:Ee().nullable().optional(),last_service_date:za().nullable().optional(),custom:Fa(Ee(),Ee()).optional()});function rr({isOpen:s,onClose:n,asset:a,users:l}){const o=Ks(),{user:u}=_a(),{can:g}=$s(),{data:x=[]}=Qn(),{data:W=[]}=sr(),te=g("asset.edit"),h=La({resolver:Va(nr),defaultValues:{name:"",asset_code:"",asset_type_id:"",category_id:null,status:Ps.Available,assigned_to:null,serial_number:"",location:"",last_service_date:null,custom:{}}}),M=h.watch("asset_type_id"),C=h.watch("assigned_to"),q=h.watch("status"),_=h.watch("category_id"),{data:L=[]}=zt(M),{data:Ye}=Pt(a==null?void 0:a.id);d.useEffect(()=>{C&&q!=="Assigned"&&h.setValue("status","Assigned"),!C&&q==="Assigned"&&h.setValue("status","Available")},[C,q,h]),d.useEffect(()=>{if(!_)return;const m=tr[_];if(!m)return;h.getValues("asset_type_id")||h.setValue("asset_type_id",m)},[_,h]),d.useEffect(()=>{var m,w;s&&(a?h.reset({name:a.name,asset_code:a.asset_code,asset_type_id:((m=a.asset_type)==null?void 0:m.id)??"",category_id:((w=a.category)==null?void 0:w.id)??null,status:a.status,assigned_to:a.assigned_to??null,serial_number:a.serial_number??"",location:a.location??"",last_service_date:typeof a.last_service_date=="string"?new Date(a.last_service_date):null,custom:{}}):h.reset())},[a,s,h]),d.useEffect(()=>{Ye&&Object.entries(Ye).forEach(([m,w])=>{h.setValue(`custom.${m}`,w??"")})},[Ye,h]);const he=Ha({mutationFn:async m=>{const w={name:m.name,asset_code:m.asset_code,asset_type_id:m.asset_type_id,category_id:m.category_id??null,status:m.status,assigned_to:m.assigned_to??null,serial_number:m.serial_number??null,location:m.location??null,last_service_date:m.last_service_date?Ns(m.last_service_date,"yyyy-MM-dd"):null},xe=a?{status:a.status,assigned_to:a.assigned_to,location:a.location,serial_number:a.serial_number}:null;if(a&&xe)return await Zn(a.id,a,w,(u==null?void 0:u.id)??null),xe.status!==w.status&&await As({action:"asset.status_changed",details:{asset_id:a.id,asset_code:a.asset_code,from:xe.status,to:w.status},userId:(u==null?void 0:u.id)??null}),xe.assigned_to!==w.assigned_to&&await As({action:"asset.assigned_changed",details:{asset_id:a.id,asset_code:a.asset_code,from:xe.assigned_to,to:w.assigned_to},userId:(u==null?void 0:u.id)??null}),await vt({assetId:a.id,values:m.custom??{},fields:L}),a.id;const ae=(await ar(w,(u==null?void 0:u.id)??null)).id;return await As({action:"asset.created",details:{asset_id:ae,asset_code:w.asset_code,name:w.name},userId:(u==null?void 0:u.id)??null}),await vt({assetId:ae,values:m.custom??{},fields:L}),ae},onSuccess:()=>{o.invalidateQueries({queryKey:["assets"]}),o.invalidateQueries({queryKey:["asset-logs",a==null?void 0:a.id]}),o.invalidateQueries({queryKey:["logs"]}),H(a?"Asset updated successfully":"Asset created successfully"),h.reset(),n()}}),os=m=>{if(!te){V("You do not have permission to edit assets.");return}he.mutate(m)};return e.jsx(qa,{open:s,onOpenChange:n,children:e.jsx($a,{className:"sm:max-w-[600px]",children:te?e.jsxs(e.Fragment,{children:[e.jsxs(Ka,{children:[e.jsx(Ba,{children:a?"Edit Asset":"Add New Asset"}),e.jsx(Qa,{children:"Manage asset information"})]}),e.jsxs("form",{onSubmit:h.handleSubmit(os),className:"grid gap-4 py-4",children:[e.jsx($e,{label:"Name",children:e.jsx(ls,{...h.register("name")})}),e.jsx($e,{label:"Asset Code",children:e.jsx(ls,{...h.register("asset_code")})}),e.jsx($e,{label:"Category",children:e.jsxs(oe,{value:h.watch("category_id")??"",onValueChange:m=>h.setValue("category_id",m||null),children:[e.jsx(de,{children:e.jsx(ce,{placeholder:"Select category"})}),e.jsx(ue,{children:W.map(m=>e.jsx(v,{value:m.id,children:m.name},m.id))})]})}),e.jsx($e,{label:"Asset Type",children:e.jsxs(oe,{value:M,onValueChange:m=>h.setValue("asset_type_id",m),children:[e.jsx(de,{children:e.jsx(ce,{placeholder:"Select asset type"})}),e.jsx(ue,{children:x.map(m=>e.jsx(v,{value:m.id,children:m.name},m.id))})]})}),e.jsx($e,{label:"Status",children:e.jsxs(oe,{value:h.watch("status"),onValueChange:m=>h.setValue("status",m),children:[e.jsx(de,{children:e.jsx(ce,{})}),e.jsx(ue,{children:Object.values(Ps).map(m=>e.jsx(v,{value:m,children:m},m))})]})}),e.jsx($e,{label:"Assigned To",children:e.jsxs(oe,{value:h.watch("assigned_to")??"",onValueChange:m=>h.setValue("assigned_to",m||null),children:[e.jsx(de,{children:e.jsx(ce,{placeholder:"Unassigned"})}),e.jsxs(ue,{children:[e.jsx(v,{value:"",children:"Unassigned"}),l.filter(m=>m.name).map(m=>e.jsx(v,{value:m.id,children:m.name},m.id))]})]})}),e.jsx($e,{label:"Location",children:e.jsx(ls,{...h.register("location")})}),e.jsx($e,{label:"Serial Number",children:e.jsx(ls,{...h.register("serial_number")})}),M&&e.jsx(Xn,{fields:L,control:h.control},M),e.jsxs(Ya,{className:"flex justify-between",children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>{h.reset(),n()},children:"Cancel"}),e.jsxs(y,{type:"submit",disabled:he.isPending,children:[he.isPending&&e.jsx(_s,{className:"mr-2 h-4 w-4 animate-spin"}),a?"Save Changes":"Add Asset"]})]})]})]}):e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"You do not have permission to edit assets."})})})}function $e({label:s,children:n}){return e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(Tt,{className:"text-right",children:s}),e.jsx("div",{className:"col-span-3",children:n})]})}async function ir(){const{data:s,error:n}=await U.from("assets").select(`
      id,
      name,
      asset_code,
      status,
      location,
      assigned_to,
      created_at,
      updated_at,
      asset_type:asset_types(id, key, name, icon),
      category:asset_categories(id, name)
    `);if(n)throw n;return(s??[]).map(a=>({id:a.id,name:a.name,asset_code:a.asset_code,category:a.category,status:a.status,serial_number:null,location:a.location,assigned_to:a.assigned_to,last_service_date:null,created_at:a.created_at,updated_at:a.updated_at,asset_type:a.asset_type}))}function lr(){return Qe({queryKey:["assets"],queryFn:ir})}const Le=Ga,Ve=Za,Ue=en,Se=d.forwardRef(({className:s,sideOffset:n=4,...a},l)=>e.jsx(Mt,{ref:l,sideOffset:n,className:_e("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a}));Se.displayName=Mt.displayName;const or={Available:"bg-[hsl(var(--success)/0.14)] text-[hsl(var(--success))] border-[hsl(var(--success)/0.25)]",Assigned:"bg-[hsl(var(--info)/0.14)] text-[hsl(var(--info))] border-[hsl(var(--info)/0.25)]","In Repair":"bg-[hsl(var(--warning)/0.14)] text-[hsl(var(--warning))] border-[hsl(var(--warning)/0.25)]",Retired:"bg-[hsl(var(--muted)/0.5)] text-muted-foreground border-[hsl(var(--border))]",Lost:"bg-[hsl(var(--destructive)/0.14)] text-[hsl(var(--destructive))] border-[hsl(var(--destructive)/0.25)]","In Use":"bg-[hsl(var(--primary)/0.14)] text-[hsl(var(--primary))] border-[hsl(var(--primary)/0.25)]"},is=({value:s,className:n,maxWidthClass:a})=>e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx("span",{className:`${a??""} truncate ${n??""}`,title:s,children:s})}),e.jsx(Se,{children:s})]})});function Ze({label:s,onClick:n}){return e.jsxs(y,{variant:"ghost",onClick:n,children:[s,e.jsx(Ft,{className:"ml-2 h-4 w-4"})]})}function _t(s){return[{accessorKey:"name",header:({column:n})=>e.jsx(Ze,{label:"Name",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc")}),size:190,meta:{headerClassName:"sticky left-0 z-20 bg-background border-r",cellClassName:"sticky left-0 z-10 bg-background border-r"},cell:({row:n})=>e.jsx(is,{value:String(n.getValue("name")??""),className:"capitalize font-medium",maxWidthClass:"max-w-[190px] inline-block"})},{accessorKey:"asset_code",header:({column:n})=>e.jsx(Ze,{label:"Asset Code",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc")}),size:120,meta:{headerClassName:"hidden sm:table-cell",cellClassName:"hidden sm:table-cell"},cell:({row:n})=>e.jsx(is,{value:String(n.getValue("asset_code")??""),className:"text-muted-foreground",maxWidthClass:"max-w-[120px] inline-block"})},{id:"asset_type",accessorFn:n=>{var a;return((a=n.asset_type)==null?void 0:a.name)??""},header:({column:n})=>e.jsx(Ze,{label:"Type",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc")}),size:140,meta:{headerClassName:"hidden md:table-cell",cellClassName:"hidden md:table-cell"},cell:({row:n})=>{var a;return e.jsx(is,{value:((a=n.original.asset_type)==null?void 0:a.name)??"—",maxWidthClass:"max-w-[140px] inline-block"})},sortingFn:(n,a)=>{var l,o;return(((l=n.original.asset_type)==null?void 0:l.name)??"").localeCompare(((o=a.original.asset_type)==null?void 0:o.name)??"")}},{id:"category",accessorFn:n=>{var a;return((a=n.category)==null?void 0:a.name)??""},header:({column:n})=>e.jsx(Ze,{label:"Category",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc")}),size:150,meta:{headerClassName:"hidden lg:table-cell",cellClassName:"hidden lg:table-cell"},cell:({row:n})=>{var a;return e.jsx(is,{value:((a=n.original.category)==null?void 0:a.name)??"—",maxWidthClass:"max-w-[150px] inline-block"})},sortingFn:(n,a)=>{var l,o;return(((l=n.original.category)==null?void 0:l.name)??"").localeCompare(((o=a.original.category)==null?void 0:o.name)??"")}},{accessorKey:"location",header:({column:n})=>e.jsx(Ze,{label:"Location",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc")}),size:120,meta:{headerClassName:"hidden xl:table-cell",cellClassName:"hidden xl:table-cell"},cell:({row:n})=>e.jsx(is,{value:String(n.getValue("location")||"—"),maxWidthClass:"max-w-[120px] inline-block"})},{id:"assigned_to_display",accessorFn:n=>n.assigned_to?(s==null?void 0:s[n.assigned_to])??n.assigned_to:"Unassigned",header:({column:n})=>e.jsx("div",{className:"flex justify-center",children:e.jsx(Ze,{label:"Assigned To",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc")})}),size:130,cell:({row:n})=>{const a=n.original.assigned_to?(s==null?void 0:s[n.original.assigned_to])??n.original.assigned_to:"Unassigned";return e.jsx("div",{className:"w-full text-center text-muted-foreground",children:e.jsx(is,{value:a,maxWidthClass:"max-w-[130px] inline-block"})})},sortingFn:(n,a)=>{const l=n.original.assigned_to?(s==null?void 0:s[n.original.assigned_to])??n.original.assigned_to:"Unassigned",o=a.original.assigned_to?(s==null?void 0:s[a.original.assigned_to])??a.original.assigned_to:"Unassigned";return l.localeCompare(o)}},{accessorKey:"updated_at",header:({column:n})=>e.jsx(Ze,{label:"Updated",onClick:()=>n.toggleSorting(n.getIsSorted()==="asc")}),size:150,meta:{headerClassName:"hidden 2xl:table-cell",cellClassName:"hidden 2xl:table-cell"},cell:({row:n})=>{const a=n.getValue("updated_at");if(!a)return e.jsx("div",{className:"text-muted-foreground",children:"—"});const l=new Date(String(a));return e.jsx("div",{className:"text-muted-foreground",children:Number.isNaN(l.getTime())?"—":l.toLocaleString()})}},{accessorKey:"status",header:()=>e.jsx("div",{className:"text-center",children:"Status"}),size:120,cell:({row:n})=>e.jsx("div",{className:"flex justify-center",children:e.jsx(P,{variant:"secondary",className:or[n.getValue("status")]??"",children:n.getValue("status")})})},{id:"actions",enableHiding:!1,size:60,meta:{headerClassName:"hidden md:table-cell",cellClassName:"hidden md:table-cell"},header:()=>e.jsx("div",{className:"text-center",children:"Actions"}),cell:({row:n})=>{const a=n.original;return e.jsx("div",{className:"flex justify-center",children:e.jsxs(Na,{children:[e.jsx(Sa,{asChild:!0,children:e.jsx(y,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(Dn,{className:"h-4 w-4"})})}),e.jsxs(Ca,{align:"end",children:[e.jsx(ka,{children:"Actions"}),e.jsx(Aa,{onClick:()=>navigator.clipboard.writeText(a.id),children:"Copy Asset ID"})]})]})})}}]}const dr=sn,Ss=d.forwardRef(({className:s,...n},a)=>e.jsx(tn,{ref:a,className:_e("border-b",s),...n}));Ss.displayName="AccordionItem";const Cs=d.forwardRef(({className:s,children:n,...a},l)=>e.jsx(an,{className:"flex",children:e.jsxs(It,{ref:l,className:_e("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",s),...a,children:[n,e.jsx(nn,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}));Cs.displayName=It.displayName;const ks=d.forwardRef(({className:s,children:n,...a},l)=>e.jsx(Rt,{ref:l,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...a,children:e.jsx("div",{className:_e("pb-4 pt-0",s),children:n})}));ks.displayName=Rt.displayName;const cr=rn,ur=ln,qt=d.forwardRef(({className:s,...n},a)=>e.jsx(Lt,{className:_e("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...n,ref:a}));qt.displayName=Lt.displayName;const mr=Da("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),$t=d.forwardRef(({side:s="right",className:n,children:a,...l},o)=>e.jsxs(ur,{children:[e.jsx(qt,{}),e.jsxs(Et,{ref:o,className:_e(mr({side:s}),n),...l,children:[e.jsxs(on,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(dn,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),a]})]}));$t.displayName=Et.displayName;const Kt=({className:s,...n})=>e.jsx("div",{className:_e("flex flex-col space-y-2 text-center sm:text-left",s),...n});Kt.displayName="SheetHeader";const Bt=d.forwardRef(({className:s,...n},a)=>e.jsx(Ot,{ref:a,className:_e("text-lg font-semibold text-foreground",s),...n}));Bt.displayName=Ot.displayName;const hr=d.forwardRef(({className:s,...n},a)=>e.jsx(Vt,{ref:a,className:_e("text-sm text-muted-foreground",s),...n}));hr.displayName=Vt.displayName;function xr({fields:s,values:n}){return e.jsx("div",{className:"space-y-4",children:s.map(a=>e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:a.label}),e.jsx("div",{className:"text-sm",children:n[a.key]||"—"})]},a.id))})}async function fr(s){const{data:n,error:a}=await U.from("asset_logs").select("*").eq("asset_id",s).order("created_at",{ascending:!1});if(a)throw a;return n}function Qt(s){return Qe({queryKey:["asset-logs",s],queryFn:()=>fr(s),enabled:!!s})}const pr={create:{icon:yn,color:"text-green-600"},assign:{icon:gn,color:"text-purple-600"},unassign:{icon:pn,color:"text-gray-500"},status_change:{icon:Mn,color:"text-blue-600"},update:{icon:Tn,color:"text-muted-foreground"},custom_field_update:{icon:Rn,color:"text-orange-600"}};function gr({log:s}){const n=pr[s.action],a=n.icon,l=new Date(s.createdAt),o=isNaN(l.getTime())?"just now":Kn(l,{addSuffix:!0});return e.jsxs("div",{className:"relative pl-8 pb-6",children:[e.jsx("div",{className:"absolute left-3 top-3 bottom-0 w-px bg-border"}),e.jsx("div",{className:`absolute left-0 top-0 flex h-6 w-6 items-center justify-center rounded-full bg-background ${n.color}`,children:e.jsx(a,{size:14})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-medium",children:s.title}),s.description&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.description}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.actor," · ",o]})]})]})}function yr(s,n){const a=(n==null?void 0:n(s.performed_by))??(s.performed_by?"User":"System"),l={id:s.id,createdAt:s.created_at,actor:a};switch(s.action){case"create":return{...l,action:"create",title:`${a} created the asset`};case"status_change":return{...l,action:"status_change",title:`${a} changed status`,description:`${s.old_value??"—"} → ${s.new_value??"—"}`};case"assign":case"unassign":return{...l,action:s.action,title:`${a} changed assignment`,description:`${s.old_value??"Unassigned"} → ${s.new_value??"Unassigned"}`};default:return s.action==="update"&&s.field==="assigned_to"?{...l,action:"update",title:`${a} changed assignment`,description:`${s.old_value??"Unassigned"} → ${s.new_value??"Unassigned"}`}:s.action==="update"&&s.field==="status"?{...l,action:"update",title:`${a} changed status`,description:`${s.old_value??"—"} → ${s.new_value??"—"}`}:{...l,action:s.action,title:s.action==="custom_field_update"?`${a} updated a custom field`:`${a} updated the asset`,description:s.action==="update"?`${s.field}: "${s.old_value??"—"}" → "${s.new_value??"—"}"`:null}}}function Yt(s){const n=d.useMemo(()=>Array.from(new Set(s.filter(o=>!!o))).sort(),[s]),a=Qe({queryKey:["user-names",n],enabled:n.length>0,queryFn:async()=>{const{data:o,error:u}=await U.from("profiles").select("id, name").in("id",n);if(u)throw u;return o??[]}}),l=d.useMemo(()=>{var u;const o={};return(u=a.data)==null||u.forEach(g=>{g!=null&&g.id&&(g!=null&&g.name)&&(o[g.id]=g.name)}),o},[a.data]);return{...a,nameMap:l}}function jr({assetId:s}){const{data:n=[],isLoading:a}=Qt(s),{nameMap:l}=Yt(n.map(u=>u.performed_by)),o=n.map(u=>yr(u,g=>g?l[g]??null:null));return a?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading history…"}):o.length?e.jsx("div",{children:e.jsx("div",{className:"space-y-1",children:o.map(u=>e.jsx(gr,{log:u},u.id))})}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No history yet"})}const Nt="neturai_asset_drawer_sections_v1";function br({asset:s,open:n,onClose:a,onEdit:l,users:o,hasPrev:u=!1,hasNext:g=!1,onPrev:x,onNext:W,positionLabel:te}){var Me,D,Pe,Ds,ts;const{can:h}=$s(),{session:M}=kt(),C=Ks(),q=Ia(),_=d.useCallback(()=>{At(()=>import("./Tickets-xgl4QFFP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]))},[]),L=s==null?void 0:s.id,Ye=(Me=s==null?void 0:s.asset_type)==null?void 0:Me.id,{data:he=[]}=zt(Ye),{data:os={}}=Pt(L),{data:m=[]}=Qt(L??""),w=m[0],{nameMap:xe}=Yt([(w==null?void 0:w.performed_by)??null]),Ce=h("asset.history.view"),ae=h("ticket.view"),$=he.length>0,ke=d.useMemo(()=>{const f=["info"];return $&&f.push("specs"),ae&&f.push("related"),Ce&&f.push("history"),f},[$,ae,Ce]),X=d.useMemo(()=>["info",...$?["specs"]:[]],[$]),[Ae,ge]=d.useState(X),[J,De]=d.useState(null),[ye,Te]=d.useState(null),[ds,He]=d.useState((s==null?void 0:s.status)??null),[cs,F]=d.useState((s==null?void 0:s.assigned_to)??null),G=d.useMemo(()=>{const f=[(s==null?void 0:s.asset_code)??"",(s==null?void 0:s.name)??""].map(p=>p.trim()).filter(p=>p.length>=2).map(p=>p.replace(/,/g," "));return Array.from(new Set(f))},[s==null?void 0:s.asset_code,s==null?void 0:s.name]),{data:K=[],isLoading:je}=Qe({queryKey:["asset-related-tickets",s==null?void 0:s.id,G.join("|")],enabled:!!(s!=null&&s.id)&&G.length>0&&ae,queryFn:async()=>{const f=G.flatMap(ee=>[`title.ilike.%${ee}%`,`description.ilike.%${ee}%`]),{data:p,error:Ne}=await U.from("tickets").select("id, title, status, priority, created_at").or(f.join(",")).order("created_at",{ascending:!1}).limit(3);if(Ne)throw Ne;return p??[]}}),Z=Object.fromEntries(Object.entries(os).map(([f,p])=>[f,p??""]));if(d.useEffect(()=>{if(!n)return;const f=p=>{p.key==="ArrowLeft"&&u&&x&&(p.preventDefault(),x()),p.key==="ArrowRight"&&g&&W&&(p.preventDefault(),W())};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[n,u,g,x,W]),d.useEffect(()=>{if(!(typeof window>"u"))try{const f=window.localStorage.getItem(Nt);if(!f){ge(X);return}const p=JSON.parse(f);if(!Array.isArray(p)){ge(X);return}const Ne=p.filter(ee=>typeof ee=="string").filter(ee=>ke.includes(ee));ge(Ne.length>0?Ne:X)}catch{ge(X)}},[ke,X]),d.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Nt,JSON.stringify(Ae))},[Ae]),d.useEffect(()=>{He((s==null?void 0:s.status)??null),F((s==null?void 0:s.assigned_to)??null),Te(null)},[s==null?void 0:s.id,s==null?void 0:s.status,s==null?void 0:s.assigned_to]),!s)return null;const R=ds??s.status,k=cs,ne=((D=o.find(f=>f.id===k))==null?void 0:D.name)??"—",z=h("asset.edit"),fe=h("asset.status.change"),B=(Pe=M==null?void 0:M.user)!=null&&Pe.id?h("asset.assign")?k===M.user.id?"This asset is already assigned to you":J!==null?"Action in progress":null:"You do not have permission to assign assets":"Please sign in first",re=fe?R==="In Repair"?"Asset is already in repair":J!==null?"Action in progress":null:"You do not have permission to change status",be=fe?R==="Available"?"Asset is already available":J!==null?"Action in progress":null:"You do not have permission to change status",pe=async(f,p)=>{if(f)try{await navigator.clipboard.writeText(f),H("Copied",`${p} copied to clipboard`)}catch{V("Copy failed","Unable to copy text")}},ze=R==="Available"?"default":R==="Assigned"?"secondary":R==="In Repair"?"outline":"destructive",ve=(w==null?void 0:w.created_at)??s.updated_at,us=w!=null&&w.performed_by?xe[w.performed_by]??"Unknown user":"System",we=async(f,p,Ne)=>{var as;Te(null),De(f);const ee=R,ms=k;p.status&&He(p.status),Object.prototype.hasOwnProperty.call(p,"assigned_to")&&F(p.assigned_to??null);const{error:We}=await U.from("assets").update(p).eq("id",s.id);if(We){He(ee),F(ms),Te({message:We.message,pending:{actionKey:f,updates:p,successMessage:Ne}}),V("Action failed",We.message),De(null);return}const Ts=((as=M==null?void 0:M.user)==null?void 0:as.id)??null;p.status&&p.status!==ee&&await As({action:"asset.status_changed",details:{asset_id:s.id,asset_code:s.asset_code,from:ee,to:p.status},userId:Ts}),Object.prototype.hasOwnProperty.call(p,"assigned_to")&&p.assigned_to!==ms&&await As({action:"asset.assigned_changed",details:{asset_id:s.id,asset_code:s.asset_code,from:ms,to:p.assigned_to??null},userId:Ts}),await Promise.all([C.invalidateQueries({queryKey:["assets"]}),C.invalidateQueries({queryKey:["asset-logs",s.id]}),C.invalidateQueries({queryKey:["logs"]})]),H("Updated",Ne),Te(null),De(null)},E=f=>{const p=`/tickets?open_ticket=${encodeURIComponent(f)}`;q(p),window.setTimeout(()=>{window.location.pathname!=="/tickets"&&window.location.assign(p)},120)};return e.jsx(cr,{open:n,onOpenChange:a,children:e.jsxs($t,{side:"right",className:"w-[420px] p-0 flex flex-col",children:[e.jsx(Kt,{className:"border-b px-6 py-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(Bt,{className:"text-lg leading-tight",children:s.name}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"truncate",children:s.asset_code}),e.jsx(y,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>pe(s.asset_code,"Asset code"),children:e.jsx(bt,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["Last update:"," ",ve?Ns(new Date(ve),"PPP p"):"—"," by"," ",us]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(P,{variant:ze,children:R}),te&&e.jsx("span",{className:"text-xs text-muted-foreground",children:te})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsxs(dr,{type:"multiple",value:Ae,onValueChange:ge,className:"space-y-3",children:[e.jsxs(Ss,{value:"info",className:"rounded-md border px-4",children:[e.jsx(Cs,{className:"py-3 text-sm font-semibold",children:"Asset Information"}),e.jsxs(ks,{children:[e.jsxs("div",{className:"mb-4 flex flex-wrap gap-2",children:[e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx("span",{className:"inline-flex",children:e.jsxs(y,{size:"sm",variant:"outline",disabled:!!B,onClick:()=>{var f;return we("assign_me",{assigned_to:((f=M==null?void 0:M.user)==null?void 0:f.id)??null},"Assigned to you")},children:[J==="assign_me"&&e.jsx(_s,{className:"mr-1.5 h-3.5 w-3.5 animate-spin"}),"Assign to me"]})})}),B&&e.jsx(Se,{children:B})]})}),e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx("span",{className:"inline-flex",children:e.jsxs(y,{size:"sm",variant:"outline",disabled:!!re,onClick:()=>we("status_repair",{status:"In Repair"},"Status updated to In Repair"),children:[J==="status_repair"&&e.jsx(_s,{className:"mr-1.5 h-3.5 w-3.5 animate-spin"}),"Mark In Repair"]})})}),re&&e.jsx(Se,{children:re})]})}),e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx("span",{className:"inline-flex",children:e.jsxs(y,{size:"sm",variant:"outline",disabled:!!be,onClick:()=>we("status_available",{status:"Available"},"Status updated to Available"),children:[J==="status_available"&&e.jsx(_s,{className:"mr-1.5 h-3.5 w-3.5 animate-spin"}),"Mark Available"]})})}),be&&e.jsx(Se,{children:be})]})})]}),ye&&e.jsxs("div",{className:"mb-4 rounded-md border border-destructive/40 bg-destructive/5 p-3",children:[e.jsxs("p",{className:"text-sm text-destructive",children:["Quick action failed: ",ye.message]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(y,{size:"sm",variant:"outline",disabled:J!==null,onClick:()=>we(ye.pending.actionKey,ye.pending.updates,ye.pending.successMessage),children:"Retry"}),e.jsx(y,{size:"sm",variant:"ghost",disabled:J!==null,onClick:()=>Te(null),children:"Dismiss"})]})]}),e.jsxs("section",{className:"grid grid-cols-2 gap-x-6 gap-y-4 pb-1",children:[e.jsx(Ke,{label:"Category",children:((Ds=s.category)==null?void 0:Ds.name)??"—"}),e.jsx(Ke,{label:"Asset Type",children:((ts=s.asset_type)==null?void 0:ts.name)??"—"}),e.jsx(Ke,{label:"Status",children:e.jsx(P,{variant:ze,children:R})}),e.jsx(Ke,{label:"Assigned To",children:ne}),e.jsx(Ke,{label:"Location",children:s.location??"—"}),e.jsx(Ke,{label:"Serial Number",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"truncate",children:s.serial_number??"—"}),s.serial_number&&e.jsx(y,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>pe(s.serial_number??"","Serial number"),children:e.jsx(bt,{className:"h-3.5 w-3.5"})})]})}),e.jsx(Ke,{label:"Last Service",children:s.last_service_date?Ns(new Date(s.last_service_date),"PPP"):"—"}),e.jsx(Ke,{label:"Updated At",children:s.updated_at?Ns(new Date(s.updated_at),"PPP p"):"—"})]})]})]}),he.length>0&&e.jsxs(Ss,{value:"specs",className:"rounded-md border px-4",children:[e.jsx(Cs,{className:"py-3 text-sm font-semibold",children:"Specifications"}),e.jsx(ks,{children:e.jsx(xr,{assetId:s.id,fields:he,values:Z})})]}),ae&&e.jsxs(Ss,{value:"related",className:"rounded-md border px-4",children:[e.jsx(Cs,{className:"py-3 text-sm font-semibold",children:"Related Tickets"}),e.jsxs(ks,{children:[je?e.jsxs("div",{className:"flex items-center gap-2 py-2 text-sm text-muted-foreground",children:[e.jsx(_s,{className:"h-4 w-4 animate-spin"}),"Loading related tickets..."]}):K.length===0?e.jsx("p",{className:"py-1 text-sm text-muted-foreground",children:"No related tickets found for this asset."}):e.jsx("div",{className:"space-y-2",children:K.map(f=>e.jsxs("button",{type:"button",className:"w-full rounded-md border p-3 text-left transition-colors hover:bg-muted/50",onClick:()=>E(f.id),onMouseEnter:_,onFocus:_,children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("p",{className:"line-clamp-1 text-sm font-medium",children:f.title}),e.jsx(P,{variant:"outline",className:"shrink-0",children:f.status})]}),e.jsxs("p",{className:"mt-1 text-xs text-muted-foreground",children:["Priority: ",f.priority||"—"," •"," ",f.created_at?Ns(new Date(f.created_at),"PPP"):"—"]})]},f.id))}),e.jsx("div",{className:"mt-3",children:e.jsx(y,{size:"sm",variant:"outline",onMouseEnter:_,onFocus:_,onClick:()=>{const f=s.asset_code||s.name;q(`/tickets?q=${encodeURIComponent(f)}`)},children:"Open in Tickets"})})]})]}),Ce&&e.jsxs(Ss,{value:"history",className:"rounded-md border px-4",children:[e.jsx(Cs,{className:"py-3 text-sm font-semibold",children:"History"}),e.jsx(ks,{children:e.jsx("div",{className:"max-h-[260px] overflow-y-auto pr-2",children:e.jsx(jr,{assetId:s.id})})})]})]})}),e.jsxs("div",{className:"border-t px-6 py-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx("span",{className:"inline-flex",children:e.jsxs(y,{size:"sm",variant:"outline",disabled:!u,onClick:x,children:[e.jsx(jn,{className:"mr-1 h-4 w-4"}),"Prev"]})})}),!u&&e.jsx(Se,{children:"This is the first asset"})]})}),e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx("span",{className:"inline-flex",children:e.jsxs(y,{size:"sm",variant:"outline",disabled:!g,onClick:W,children:["Next",e.jsx(bn,{className:"ml-1 h-4 w-4"})]})})}),!g&&e.jsx(Se,{children:"This is the last asset"})]})})]}),z&&e.jsx(y,{size:"sm",variant:"default",onClick:()=>{a(),l(s)},children:"Edit"})]})]})})}function Ke({label:s,children:n}){return e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:s}),e.jsx("div",{className:"text-sm",children:n})]})}const qs=d.forwardRef(({className:s,...n},a)=>e.jsx(Ut,{ref:a,className:_e("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...n,children:e.jsx(cn,{className:_e("flex items-center justify-center text-current"),children:e.jsx(un,{className:"h-4 w-4"})})}));qs.displayName=Ut.displayName;const es="updated_at",ss="desc",se="all",Be="me",Oe="unassigned",St="neturai_asset_view_preset",Ct="neturai_asset_saved_views";function Ur(){var ot,dt,ct,ut,mt;const{session:s}=kt(),{can:n}=$s(),a=n("asset.assign"),l=n("asset.status.change"),o=n("asset.delete"),u=((ot=s==null?void 0:s.user)==null?void 0:ot.id)??null,g=Ks(),{data:x=[],isLoading:W,isError:te,error:h}=lr(),{data:M=[],isLoading:C,isError:q}=Wa(),_=M.filter(t=>t.name).map(t=>({id:t.id,name:t.name})),L=d.useMemo(()=>_.reduce((t,r)=>(t[r.id]=r.name,t),{}),[_]),[Ye,he]=d.useState(!1),[os,m]=d.useState(null),[w,xe]=d.useState(!1),[Ce,ae]=d.useState(null),[$,ke]=Ra(),X=$.get("q")??"",Ae=$.get("status")??"all",ge=$.get("category")??"all",J=$.get("type")??"all",De=$.get("owner")??se,ye=$.get("sortBy"),Te=$.get("sortDir"),ds=De&&De!==""?De:se,He=ye==="name"||ye==="asset_code"||ye==="status"||ye==="updated_at"?ye:es,cs=Te==="asc"||Te==="desc"?Te:ss,[F,G]=d.useState(Ae),[K,je]=d.useState(ge),[Z,R]=d.useState(J),[k,ne]=d.useState(ds),[z,fe]=d.useState(He),[B,re]=d.useState(cs),[be,pe]=d.useState(X),[ze,ve]=d.useState(X),[us,we]=d.useState("default"),[E,Me]=d.useState([]),[D,Pe]=d.useState("none"),[Ds,ts]=d.useState(!1),[f,p]=d.useState(!1),[Ne,ee]=d.useState(!1),[ms,We]=d.useState(!1),[Ts,as]=d.useState(!1),Bs=d.useRef(null),[Ht,Qs]=d.useState(!1),[Ie,Ms]=d.useState([]),[Xe,Ys]=d.useState(!1),[Q,Hs]=d.useState("__none__"),[ns,Ws]=d.useState("__none__"),[T,ie]=d.useState(!1),[Je,le]=d.useState(null),[Ge,Is]=d.useState(null),Xs=S.useCallback(()=>{At(()=>import("./Tickets-xgl4QFFP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]))},[]),Ls=S.useCallback(t=>{if(t==="default"){pe(""),ve(""),G("all"),je("all"),R("all"),ne(se),fe(es),re(ss),we("default");return}if(t==="my_assigned"){pe(""),ve(""),G("Assigned"),je("all"),R("all"),ne("me"),fe("updated_at"),re("desc"),we("my_assigned");return}if(t==="in_repair"){pe(""),ve(""),G("In Repair"),je("all"),R("all"),ne(se),fe("updated_at"),re("desc"),we("in_repair");return}pe(""),ve(""),G("all"),je("all"),R("all"),ne("unassigned"),fe("updated_at"),re("desc"),we("unassigned")},[]),Wt=()=>{xe(!1),ae(null),$.get("assetId")&&ke(t=>{const r=new URLSearchParams(t);return r.delete("assetId"),r})},Xt=t=>{xe(!1),ae(null),m(t),he(!0)},hs=S.useCallback(t=>{ae(t),xe(!0),ke(r=>{const i=new URLSearchParams(r);return i.set("assetId",t.id),i})},[ke]),Vs=d.useMemo(()=>x.reduce((r,i)=>{const c=i.status??"Unknown";return r[c]=(r[c]??0)+1,r},{}),[x]),Js=d.useMemo(()=>{const t=["Available","Assigned","In Repair","In Use","Retired","Lost","Unknown"],r=Object.keys(Vs);return[...t.filter(c=>r.includes(c)),...r.filter(c=>!t.includes(c)).sort((c,b)=>c.localeCompare(b))].map(c=>({status:c,count:Vs[c]??0}))},[Vs]),Gs=d.useMemo(()=>{const t=new Map;return x.forEach(r=>{var i;(i=r.category)!=null&&i.id&&t.set(r.category.id,r.category.name??r.category.id)}),Array.from(t.entries()).map(([r,i])=>({id:r,label:i}))},[x]),Zs=d.useMemo(()=>{const t=new Map;return x.forEach(r=>{var i;(i=r.asset_type)!=null&&i.id&&t.set(r.asset_type.id,r.asset_type.name??r.asset_type.id)}),Array.from(t.entries()).map(([r,i])=>({id:r,label:i}))},[x]),et=d.useMemo(()=>x.filter(t=>{var c,b,N,j,I,O,ht,xt,ft,pt,gt;const r=ze.trim().toLowerCase();return!(!(r.length===0||((c=t.name)==null?void 0:c.toLowerCase().includes(r))||((b=t.asset_code)==null?void 0:b.toLowerCase().includes(r))||((j=(N=t.asset_type)==null?void 0:N.name)==null?void 0:j.toLowerCase().includes(r))||((O=(I=t.category)==null?void 0:I.name)==null?void 0:O.toLowerCase().includes(r))||((ht=t.location)==null?void 0:ht.toLowerCase().includes(r))||((xt=t.serial_number)==null?void 0:xt.toLowerCase().includes(r))||((ft=t.status)==null?void 0:ft.toLowerCase().includes(r))||(t.assigned_to?(L[t.assigned_to]??"").toLowerCase().includes(r):!1))||F!=="all"&&t.status!==F||K!=="all"&&((pt=t.category)==null?void 0:pt.id)!==K||Z!=="all"&&((gt=t.asset_type)==null?void 0:gt.id)!==Z||k==="me"&&(!u||t.assigned_to!==u)||k===Oe&&t.assigned_to||k!==se&&k!==Be&&k!==Oe&&t.assigned_to!==k)}),[x,F,K,Z,ze,L,k,u]),Y=d.useMemo(()=>{const t=[...et],r=(i,c)=>c==="name"?i.name??"":c==="asset_code"?i.asset_code??"":c==="status"?i.status??"":i.updated_at??"";return t.sort((i,c)=>{if(z==="updated_at"){const I=i.updated_at?new Date(i.updated_at).getTime():0,O=c.updated_at?new Date(c.updated_at).getTime():0;return B==="asc"?I-O:O-I}const b=r(i,z).toLowerCase(),N=r(c,z).toLowerCase();if(b===N)return 0;const j=b.localeCompare(N);return B==="asc"?j:-j}),t},[et,z,B]),Re=d.useMemo(()=>Ce?Y.findIndex(t=>t.id===Ce.id):-1,[Y,Ce]),Us=Re>0,Fs=Re>=0&&Re<Y.length-1,Jt=S.useCallback(()=>{if(!Us)return;const t=Y[Re-1];t&&hs(t)},[Us,Y,Re,hs]),Gt=S.useCallback(()=>{if(!Fs)return;const t=Y[Re+1];t&&hs(t)},[Fs,Y,Re,hs]),A=d.useMemo(()=>Ie.map(t=>t.id),[Ie]),Rs=Y.length>0&&A.length===Y.length,zs=S.useCallback(t=>{Ms(r=>r.some(c=>c.id===t.id)?r.filter(c=>c.id!==t.id):[...r,t])},[]),st=S.useCallback(()=>{if(Rs){Ms([]);return}Ms(Y)},[Rs,Y]),Zt=d.useMemo(()=>Xe?[{id:"select",enableSorting:!1,enableHiding:!1,size:40,header:()=>e.jsx("div",{className:"flex items-center justify-center",onClick:t=>t.stopPropagation(),children:e.jsx(qs,{checked:Rs,onCheckedChange:st,onClick:t=>t.stopPropagation(),"aria-label":"Select all rows"})}),cell:({row:t})=>e.jsx("div",{className:"flex items-center justify-center",onClick:r=>r.stopPropagation(),children:e.jsx(qs,{checked:A.includes(t.original.id),onCheckedChange:()=>zs(t.original),onClick:r=>r.stopPropagation(),"aria-label":"Select row"})})},..._t(L)]:[..._t(L)],[Rs,L,A,Xe,zs,st]);S.useEffect(()=>{const t=window.setTimeout(()=>{ve(be)},250);return()=>window.clearTimeout(t)},[be]),S.useEffect(()=>{if(typeof window>"u")return;const t=()=>{Xs()};if("requestIdleCallback"in window){const i=window.requestIdleCallback(t,{timeout:1500});return()=>window.cancelIdleCallback(i)}const r=window.setTimeout(t,500);return()=>window.clearTimeout(r)},[Xs]),S.useEffect(()=>{pe(X),ve(X),G(Ae),je(ge),R(J),ne(ds),fe(He),re(cs)},[X,Ae,ge,J,ds,He,cs]),S.useEffect(()=>{ke(t=>{const r=new URLSearchParams(t),i=(c,b,N)=>{b.trim()===""||b===N?r.delete(c):r.set(c,b)};return i("q",ze,""),i("status",F,"all"),i("category",K,"all"),i("type",Z,"all"),i("owner",k,se),i("sortBy",z,es),i("sortDir",B,ss),r.toString()===t.toString()?t:r})},[ze,F,K,Z,k,z,B,ke]),S.useEffect(()=>{if(typeof window>"u"||X||Ae!=="all"||ge!=="all"||J!=="all"||De!==se)return;const t=window.localStorage.getItem(St);(t==="default"||t==="my_assigned"||t==="in_repair"||t==="unassigned")&&Ls(t)},[Ls,X,Ae,ge,J,De]),S.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(St,us)},[us]),S.useEffect(()=>{const t=$.get("assetId");if(!t)return;const r=x.find(i=>i.id===t);r&&(ae(r),xe(!0))},[x,$]);const ea=ze.trim().length>0||F!=="all"||K!=="all"||Z!=="all"||k!==se||z!==es||B!==ss,tt=K==="all"?null:((dt=Gs.find(t=>t.id===K))==null?void 0:dt.label)??K,at=Z==="all"?null:((ct=Zs.find(t=>t.id===Z))==null?void 0:ct.label)??Z,sa=z==="updated_at"?"Updated date":z==="asset_code"?"Asset code":z==="status"?"Status":"Name",ta=B==="desc"?"Desc":"Asc",nt=()=>{pe(""),ve(""),G("all"),je("all"),R("all"),ne(se),fe(es),re(ss),we("default"),Pe("none"),ke(t=>{const r=new URLSearchParams(t);return r.delete("q"),r.delete("status"),r.delete("category"),r.delete("type"),r.delete("owner"),r.delete("sortBy"),r.delete("sortDir"),r})},rs=()=>{Ms([]),Hs("__none__"),Ws("__none__")},aa=()=>{Ys(!0)},na=()=>{rs(),Ys(!1)};S.useEffect(()=>{Xe||Ie.length!==0&&rs()},[Xe,Ie.length]);const ra=async()=>{var b;if(A.length===0)return!1;if(!a)return V("You do not have permission to assign assets"),!1;if(Q==="__none__")return V("Select an owner first"),!1;let t=null;if(Q===Be){if(!u)return V("You must be logged in to assign to yourself"),!1;t=u}else Q===Oe?t=null:t=Q;const r=Ie.map(N=>({id:N.id,previousAssignedTo:N.assigned_to})),i=Q===Be?"Assign to me":Q===Oe?"Set unassigned":((b=_.find(N=>N.id===Q))==null?void 0:b.name)??Q;ie(!0),le("owner");const{error:c}=await U.from("assets").update({assigned_to:t}).in("id",A);return c?(V("Failed to assign owner",c.message),ie(!1),le(null),!1):(H("Owner updated",`${A.length} asset(s)`),Is({kind:"owner",label:`Owner -> ${i}`,items:r}),rs(),g.invalidateQueries({queryKey:["assets"]}),ie(!1),le(null),!0)},ia=async()=>{if(A.length===0)return!1;if(!l)return V("You do not have permission to change asset status"),!1;if(ns==="__none__")return V("Select a status first"),!1;const t=Ie.map(i=>({id:i.id,previousStatus:i.status}));ie(!0),le("status");const{error:r}=await U.from("assets").update({status:ns}).in("id",A);return r?(V("Failed to update status",r.message),ie(!1),le(null),!1):(H("Status updated",`${A.length} asset(s)`),Is({kind:"status",label:`Status -> ${ns}`,items:t}),rs(),g.invalidateQueries({queryKey:["assets"]}),ie(!1),le(null),!0)},la=()=>{if(Ie.length===0)return;const t=[["Name","Asset Code","Type","Category","Status","Location","Assigned To"],...Ie.map(j=>{var I,O;return[j.name??"",j.asset_code??"",((I=j.asset_type)==null?void 0:I.name)??"",((O=j.category)==null?void 0:O.name)??"",j.status??"",j.location??"",j.assigned_to?L[j.assigned_to]??j.assigned_to:"Unassigned"]})],r=j=>`"${String(j).replace(/"/g,'""')}"`,i=t.map(j=>j.map(r).join(",")).join(`
`),c=new Blob([i],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(c),N=document.createElement("a");N.href=b,N.download="selected-assets.csv",document.body.appendChild(N),N.click(),N.remove(),URL.revokeObjectURL(b),H("Export complete",`${Ie.length} asset(s)`)},oa=async()=>{if(A.length===0)return!1;if(!o)return V("You do not have permission to delete assets"),!1;ie(!0),le("delete");const{error:t}=await U.from("assets").delete().in("id",A);return t?(V("Failed to delete assets",t.message),ie(!1),le(null),!1):(H("Assets deleted",`${A.length} asset(s)`),rs(),Is(null),g.invalidateQueries({queryKey:["assets"]}),ie(!1),le(null),!0)},da=async()=>{if(Ge){if(ie(!0),le("undo"),Ge.kind==="owner"){const r=(await Promise.all(Ge.items.map(i=>U.from("assets").update({assigned_to:i.previousAssignedTo}).eq("id",i.id)))).find(i=>i.error);if(r!=null&&r.error){V("Undo failed",r.error.message),ie(!1),le(null);return}}else{const r=(await Promise.all(Ge.items.map(i=>U.from("assets").update({status:i.previousStatus}).eq("id",i.id)))).find(i=>i.error);if(r!=null&&r.error){V("Undo failed",r.error.message),ie(!1),le(null);return}}H("Undo complete",Ge.label),Is(null),g.invalidateQueries({queryKey:["assets"]}),ie(!1),le(null)}},ca=Q==="__none__"?"":Q===Be?"Assign to me":Q===Oe?"Set unassigned":((ut=_.find(t=>t.id===Q))==null?void 0:ut.name)??Q,rt=S.useCallback(()=>({q:be,status:F,category:K,type:Z,owner:k,sortBy:z,sortDir:B}),[be,F,K,Z,k,z,B]),it=S.useCallback(t=>{pe(t.q),ve(t.q),G(t.status),je(t.category),R(t.type),ne(t.owner),fe(t.sortBy),re(t.sortDir),we("default")},[]),ua=S.useCallback(()=>{const t=window.prompt("Saved view name");if(!t)return;const r=t.trim();if(!r)return;const i=rt(),c=typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`view-${Date.now()}`;Me(b=>{const N=b.find(I=>I.name.toLowerCase()===r.toLowerCase());if(N){const I=b.map(O=>O.id===N.id?{...O,snapshot:i,name:r}:O);return Pe(N.id),H("Saved view updated",r),I}const j={id:c,name:r,snapshot:i};return Pe(j.id),H("Saved view created",r),[...b,j]})},[rt]),ma=S.useCallback(t=>{if(Pe(t),t==="none")return;const r=E.find(i=>i.id===t);r&&it(r.snapshot)},[E,it]),ha=S.useCallback(()=>{if(D==="none")return;const t=E.find(r=>r.id===D);Me(r=>r.filter(i=>i.id!==D)),Pe("none"),H("Saved view deleted",t==null?void 0:t.name)},[E,D]),xa=S.useCallback(()=>{if(D==="none")return;const t=E.find(c=>c.id===D);if(!t)return;const r=window.prompt("Rename saved view",t.name);if(!r)return;const i=r.trim();i&&(Me(c=>c.map(b=>b.id===D?{...b,name:i}:b)),H("Saved view renamed",i))},[E,D]),fa=S.useCallback(()=>{if(D==="none")return;const t=E.find(r=>r.id===D);t&&(Me(r=>r.map(i=>i.id===D?{...i,pinned:!i.pinned}:i)),H(t.pinned?"Removed pin from saved view":"Pinned saved view",t.name))},[E,D]),pa=t=>{if(!t||typeof t!="object")return!1;const r=t;return typeof r.q=="string"&&typeof r.status=="string"&&typeof r.category=="string"&&typeof r.type=="string"&&typeof r.owner=="string"&&(r.sortBy==="updated_at"||r.sortBy==="name"||r.sortBy==="asset_code"||r.sortBy==="status")&&(r.sortDir==="asc"||r.sortDir==="desc")},ga=S.useCallback(()=>{const t=JSON.stringify(E,null,2),r=new Blob([t],{type:"application/json"}),i=window.URL.createObjectURL(r),c=document.createElement("a");c.href=i,c.download="neturai-asset-saved-views.json",document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(i),H("Saved views exported")},[E]),ya=S.useCallback(async t=>{var i;const r=(i=t.target.files)==null?void 0:i[0];if(t.target.value="",!!r)try{const c=await r.text(),b=JSON.parse(c);if(!Array.isArray(b)){V("Import failed","Invalid file format");return}const N=b.filter(j=>{if(!j||typeof j!="object")return!1;const I=j;return typeof I.id=="string"&&typeof I.name=="string"&&pa(I.snapshot)}).map(j=>({id:j.id,name:j.name,pinned:!!j.pinned,snapshot:j.snapshot}));if(N.length===0){V("Import failed","No valid saved views found");return}Me(j=>{const I=new Map(j.map(O=>[O.id,O]));return N.forEach(O=>I.set(O.id,O)),Array.from(I.values())}),H("Saved views imported",`${N.length} view(s)`)}catch{V("Import failed","Cannot read JSON file")}},[]);S.useEffect(()=>{if(typeof window>"u")return;const t=window.localStorage.getItem(Ct);if(t)try{const r=JSON.parse(t);if(!Array.isArray(r))return;const i=r.filter(c=>typeof(c==null?void 0:c.id)=="string"&&typeof(c==null?void 0:c.name)=="string"&&typeof(c==null?void 0:c.snapshot)=="object"&&c.snapshot!==null);Me(i.sort((c,b)=>!!c.pinned==!!b.pinned?c.name.localeCompare(b.name):c.pinned?-1:1))}catch{}},[]),S.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Ct,JSON.stringify(E))},[E]);const xs=D==="none"?null:E.find(t=>t.id===D)??null,ja=d.useMemo(()=>[...E].sort((t,r)=>!!t.pinned==!!r.pinned?t.name.localeCompare(r.name):t.pinned?-1:1),[E]),lt=()=>e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"rounded-lg border border-border/70 bg-card/70 p-3",children:[e.jsx("h3",{className:"mb-2 text-sm font-semibold",children:"Presets"}),e.jsxs(oe,{value:us,onValueChange:t=>Ls(t),children:[e.jsx(de,{className:"h-8 text-sm",children:e.jsx(ce,{placeholder:"Select preset"})}),e.jsxs(ue,{children:[e.jsx(v,{value:"default",children:"Default"}),e.jsx(v,{value:"my_assigned",children:"My assigned"}),e.jsx(v,{value:"in_repair",children:"In repair"}),e.jsx(v,{value:"unassigned",children:"Unassigned"})]})]})]}),e.jsxs("div",{className:"rounded-lg border border-border/70 bg-card/70 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Saved views"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(y,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:ua,children:[e.jsx(In,{className:"mr-1 h-3.5 w-3.5"}),"Save"]}),e.jsx(y,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:ga,disabled:E.length===0,"aria-label":"Export saved views",children:e.jsx(kn,{className:"h-3.5 w-3.5"})}),e.jsx(y,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>{var t;return(t=Bs.current)==null?void 0:t.click()},"aria-label":"Import saved views",children:e.jsx(On,{className:"h-3.5 w-3.5"})}),e.jsx(y,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:xa,disabled:D==="none","aria-label":"Rename saved view",children:e.jsx(Xa,{className:"h-3.5 w-3.5"})}),e.jsx(y,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:fa,disabled:D==="none","aria-label":"Pin saved view",children:e.jsx(En,{className:`h-3.5 w-3.5 ${xs!=null&&xs.pinned?"fill-current":""}`})}),e.jsx(y,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>ts(!0),disabled:D==="none","aria-label":"Delete saved view",children:e.jsx(Ja,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs(oe,{value:D,onValueChange:ma,children:[e.jsx(de,{className:"h-8 text-sm",children:e.jsx(ce,{placeholder:"Select saved view"})}),e.jsxs(ue,{children:[e.jsx(v,{value:"none",children:"No saved view"}),ja.map(t=>e.jsx(v,{value:t.id,children:t.pinned?`★ ${t.name}`:t.name},t.id))]})]}),e.jsx("input",{ref:Bs,type:"file",accept:"application/json",className:"hidden",onChange:ya})]}),e.jsxs("div",{className:"rounded-lg border border-border/70 bg-card/70 p-3",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"Status"}),e.jsxs(y,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:nt,children:[e.jsx(hn,{className:"mr-1 h-3.5 w-3.5"}),"Reset"]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("button",{type:"button",onClick:()=>G("all"),className:`flex items-center justify-between rounded-md px-2 py-1.5 text-left text-sm transition-colors ${F==="all"?"bg-primary/10 text-primary":"hover:bg-muted"}`,children:[e.jsx("span",{children:"All"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:x.length})]}),Js.map(({status:t,count:r})=>e.jsxs("button",{type:"button",onClick:()=>G(t),className:`flex items-center justify-between rounded-md px-2 py-1.5 text-left text-sm transition-colors ${F===t?"bg-primary/10 text-primary":"hover:bg-muted"}`,children:[e.jsx("span",{children:t}),e.jsx("span",{className:"text-xs text-muted-foreground",children:r})]},t))]})]}),e.jsxs("div",{className:"rounded-lg border border-border/70 bg-card/70 p-3",children:[e.jsx("h3",{className:"mb-2 text-sm font-semibold",children:"Category"}),e.jsxs(oe,{value:K,onValueChange:je,children:[e.jsx(de,{className:"h-8 text-sm",children:e.jsx(ce,{placeholder:"All categories"})}),e.jsxs(ue,{children:[e.jsx(v,{value:"all",children:"All categories"}),Gs.map(t=>e.jsx(v,{value:t.id,children:t.label},t.id))]})]})]}),e.jsxs("div",{className:"rounded-lg border border-border/70 bg-card/70 p-3",children:[e.jsx("h3",{className:"mb-2 text-sm font-semibold",children:"Type"}),e.jsxs(oe,{value:Z,onValueChange:R,children:[e.jsx(de,{className:"h-8 text-sm",children:e.jsx(ce,{placeholder:"All types"})}),e.jsxs(ue,{children:[e.jsx(v,{value:"all",children:"All types"}),Zs.map(t=>e.jsx(v,{value:t.id,children:t.label},t.id))]})]})]}),e.jsxs("div",{className:"rounded-lg border border-border/70 bg-card/70 p-3",children:[e.jsx("h3",{className:"mb-2 text-sm font-semibold",children:"Owner"}),e.jsxs(oe,{value:k,onValueChange:ne,children:[e.jsx(de,{className:"h-8 text-sm",children:e.jsx(ce,{placeholder:"All owners"})}),e.jsxs(ue,{children:[e.jsx(v,{value:se,children:"All owners"}),e.jsx(v,{value:Be,children:"Assigned to me"}),e.jsx(v,{value:Oe,children:"Unassigned"}),_.map(t=>e.jsx(v,{value:t.id,children:t.name},t.id))]})]})]})]});return W||C?e.jsxs("div",{className:"flex flex-col gap-6 p-4 md:p-6",children:[e.jsx("div",{className:"h-8 w-1/3 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-5 w-1/2 rounded bg-muted animate-pulse"}),e.jsx(Cn,{count:6,className:"md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3"})]}):te?e.jsxs("div",{className:"flex flex-col gap-6 p-4 md:p-6",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Asset Management"}),e.jsxs("p",{className:"text-red-500",children:["Error loading assets: ",h==null?void 0:h.message]})]}):q?e.jsxs("div",{className:"flex flex-col gap-6 p-4 md:p-6",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Asset Management"}),e.jsx("p",{className:"text-red-500",children:"Error loading users for assignment."})]}):e.jsxs("div",{className:"flex flex-col gap-6 p-4 md:p-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:"Neturai IT Manager"}),e.jsx("h1",{className:"text-3xl font-semibold tracking-tight",children:"Asset Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Track asset health, ownership, and lifecycle in one place."})]}),e.jsx(y,{className:"md:hidden self-start",onClick:()=>{m(null),he(!0)},children:"Add Asset"}),e.jsxs("div",{className:"mt-2 flex items-center justify-between rounded-md border bg-background/80 px-3 py-2 shadow-sm backdrop-blur supports-[backdrop-filter]:bg-background/60 md:sticky md:top-[68px] md:z-20 md:mt-0 lg:top-[64px]",children:[e.jsx("h2",{className:"text-lg font-semibold tracking-tight",children:"Filters & Actions"}),e.jsx(y,{className:"hidden md:inline-flex",onClick:()=>{m(null),he(!0)},children:"Add Asset"})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[280px_minmax(0,1fr)]",children:[e.jsx("aside",{className:"hidden lg:block",children:lt()}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("div",{className:"rounded-lg border border-border/70 bg-card/60 p-2",children:e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-1",children:[e.jsxs(y,{type:"button",variant:"outline",className:"h-8 lg:hidden",onClick:()=>Qs(!0),children:[e.jsx(mn,{className:"mr-1.5 h-3.5 w-3.5"}),"Filters"]}),e.jsxs("div",{className:"relative min-w-[240px] flex-1",children:[e.jsx(Ta,{className:"pointer-events-none absolute left-2.5 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(ls,{"aria-label":"Search assets",value:be,onChange:t=>pe(t.target.value),placeholder:"Search assets...",className:"h-8 pl-8 text-sm"})]}),e.jsxs(oe,{value:z,onValueChange:t=>fe(t),children:[e.jsxs(de,{"aria-label":"Sort field",className:"h-8 min-w-[150px] text-sm",children:[e.jsx(Ft,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground"}),e.jsx(ce,{placeholder:"Sort"})]}),e.jsxs(ue,{position:"popper",sideOffset:6,children:[e.jsx(v,{value:"updated_at",children:"Updated date"}),e.jsx(v,{value:"name",children:"Name"}),e.jsx(v,{value:"asset_code",children:"Asset code"}),e.jsx(v,{value:"status",children:"Status"})]})]}),e.jsxs(oe,{value:B,onValueChange:t=>re(t),children:[e.jsxs(de,{"aria-label":"Sort direction",className:"h-8 min-w-[130px] text-sm",children:[e.jsx(An,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground"}),e.jsx(ce,{placeholder:"Direction"})]}),e.jsxs(ue,{position:"popper",sideOffset:6,children:[e.jsx(v,{value:"desc",children:"Descending"}),e.jsx(v,{value:"asc",children:"Ascending"})]})]}),Xe?e.jsx(y,{type:"button",variant:"secondary",className:"h-8",onClick:na,children:"Done"}):e.jsx(y,{type:"button",variant:"outline",className:"h-8",onClick:aa,children:"Select"}),e.jsxs(P,{variant:"secondary",className:"ml-auto whitespace-nowrap",children:["Showing: ",Y.length]})]})}),ea&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[be.trim().length>0&&e.jsxs(P,{variant:"outline",className:"gap-1 px-2 py-1 text-xs",children:["Search: ",be.trim(),e.jsx("button",{type:"button",onClick:()=>pe(""),"aria-label":"Remove search filter",className:"text-muted-foreground hover:text-foreground",children:e.jsx(qe,{className:"h-3 w-3"})})]}),F!=="all"&&e.jsxs(P,{variant:"outline",className:"gap-1 px-2 py-1 text-xs",children:["Status: ",F,e.jsx("button",{type:"button",onClick:()=>G("all"),"aria-label":"Remove status filter",className:"text-muted-foreground hover:text-foreground",children:e.jsx(qe,{className:"h-3 w-3"})})]}),tt&&e.jsxs(P,{variant:"outline",className:"gap-1 px-2 py-1 text-xs",children:["Category: ",tt,e.jsx("button",{type:"button",onClick:()=>je("all"),"aria-label":"Remove category filter",className:"text-muted-foreground hover:text-foreground",children:e.jsx(qe,{className:"h-3 w-3"})})]}),at&&e.jsxs(P,{variant:"outline",className:"gap-1 px-2 py-1 text-xs",children:["Type: ",at,e.jsx("button",{type:"button",onClick:()=>R("all"),"aria-label":"Remove type filter",className:"text-muted-foreground hover:text-foreground",children:e.jsx(qe,{className:"h-3 w-3"})})]}),k===Be&&e.jsxs(P,{variant:"outline",className:"gap-1 px-2 py-1 text-xs",children:["Owner: assigned to me",e.jsx("button",{type:"button",onClick:()=>ne(se),"aria-label":"Remove owner filter",className:"text-muted-foreground hover:text-foreground",children:e.jsx(qe,{className:"h-3 w-3"})})]}),k===Oe&&e.jsxs(P,{variant:"outline",className:"gap-1 px-2 py-1 text-xs",children:["Owner: unassigned",e.jsx("button",{type:"button",onClick:()=>ne(se),"aria-label":"Remove owner filter",className:"text-muted-foreground hover:text-foreground",children:e.jsx(qe,{className:"h-3 w-3"})})]}),k!==se&&k!==Be&&k!==Oe&&e.jsxs(P,{variant:"outline",className:"gap-1 px-2 py-1 text-xs",children:["Owner:"," ",((mt=_.find(t=>t.id===k))==null?void 0:mt.name)||k,e.jsx("button",{type:"button",onClick:()=>ne(se),"aria-label":"Remove owner filter",className:"text-muted-foreground hover:text-foreground",children:e.jsx(qe,{className:"h-3 w-3"})})]}),(z!==es||B!==ss)&&e.jsxs(P,{variant:"outline",className:"gap-1 px-2 py-1 text-xs",children:["Sort: ",sa," (",ta,")",e.jsx("button",{type:"button",onClick:()=>{fe(es),re(ss)},"aria-label":"Reset sorting",className:"text-muted-foreground hover:text-foreground",children:e.jsx(qe,{className:"h-3 w-3"})})]}),e.jsx(y,{variant:"ghost",size:"sm",onClick:nt,children:"Clear all"})]}),Xe&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-lg border border-primary/30 bg-primary/5 p-2",children:[e.jsxs(P,{variant:"secondary",className:"whitespace-nowrap",children:["Selected: ",A.length]}),T&&e.jsx(P,{variant:"outline",className:"whitespace-nowrap",children:Je==="owner"?"Updating owner...":Je==="status"?"Updating status...":Je==="delete"?"Deleting...":"Processing..."}),e.jsxs(oe,{value:Q,onValueChange:Hs,disabled:T||!a,children:[e.jsx(de,{className:"h-8 min-w-[180px] text-sm",children:e.jsx(ce,{placeholder:"Assign owner..."})}),e.jsxs(ue,{children:[e.jsx(v,{value:"__none__",children:"Assign owner..."}),e.jsx(v,{value:Be,children:"Assign to me"}),e.jsx(v,{value:Oe,children:"Set unassigned"}),_.map(t=>e.jsx(v,{value:t.id,children:t.name},t.id))]})]}),e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx("span",{className:"inline-flex",children:e.jsx(y,{variant:"outline",size:"sm",onClick:()=>p(!0),disabled:T||A.length===0||Q==="__none__"||!a,children:"Assign Owner"})})}),!a&&e.jsx(Se,{children:"Admin/IT only: you do not have permission to assign assets"})]})}),e.jsxs(oe,{value:ns,onValueChange:Ws,disabled:T||!l,children:[e.jsx(de,{className:"h-8 min-w-[170px] text-sm",children:e.jsx(ce,{placeholder:"Set status..."})}),e.jsxs(ue,{children:[e.jsx(v,{value:"__none__",children:"Set status..."}),Js.map(({status:t})=>e.jsx(v,{value:t,children:t},t))]})]}),e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx("span",{className:"inline-flex",children:e.jsx(y,{variant:"outline",size:"sm",onClick:()=>ee(!0),disabled:T||A.length===0||ns==="__none__"||!l,children:"Update Status"})})}),!l&&e.jsx(Se,{children:"Admin/IT only: you do not have permission to change asset status"})]})}),e.jsx(y,{variant:"outline",size:"sm",onClick:la,disabled:T||A.length===0,children:"Export Selected"}),e.jsx(y,{variant:"ghost",size:"sm",onClick:rs,disabled:T,children:"Clear selection"}),e.jsx(Le,{children:e.jsxs(Ve,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx("span",{className:"inline-flex",children:e.jsx(y,{variant:"destructive",size:"sm",onClick:()=>We(!0),disabled:T||A.length===0||!o,children:"Delete Selected"})})}),!o&&e.jsx(Se,{children:"Admin/IT only: you do not have permission to delete assets"})]})})]}),Ge&&A.length===0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-lg border border-border/70 bg-muted/30 p-2",children:[e.jsxs(P,{variant:"secondary",className:"whitespace-nowrap",children:["Last: ",Ge.label]}),e.jsx(y,{variant:"outline",size:"sm",onClick:da,disabled:T,children:T&&Je==="undo"?"Undoing...":"Undo last bulk change"})]}),e.jsx("div",{className:"rounded-md border",children:Y.length===0?e.jsx(Ma,{title:"No assets found",message:"Try adjusting your filters or add a new asset."}):e.jsx(Ea,{columns:Zt,data:Y,showGlobalFilter:!1,getRowId:t=>t.id,globalFilterPlaceholder:"Search assets by name, code, type, category, location, status...",onRowClick:Xe?t=>{zs(t)}:t=>{hs(t)}})})]})]}),e.jsx(vn,{open:Ht,onOpenChange:Qs,children:e.jsxs(wn,{className:"max-h-[85vh]",children:[e.jsxs(_n,{children:[e.jsx(Nn,{children:"Filters"}),e.jsx(Sn,{children:"Refine assets by status, category, type, and owner."})]}),e.jsx("div",{className:"overflow-auto px-4 pb-6",children:lt()})]})}),e.jsx(fs,{open:Ds,onOpenChange:ts,children:e.jsxs(ps,{children:[e.jsxs(gs,{children:[e.jsx(ys,{children:"Delete saved view?"}),e.jsxs(js,{children:["This action cannot be undone."," ",xs?`"${xs.name}"`:"Selected view"," will be removed."]})]}),e.jsxs(bs,{children:[e.jsx(vs,{children:"Cancel"}),e.jsx(ws,{onClick:()=>{ha(),ts(!1)},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(fs,{open:f,onOpenChange:p,children:e.jsxs(ps,{children:[e.jsxs(gs,{children:[e.jsx(ys,{children:"Confirm owner update"}),e.jsxs(js,{children:["Update owner for ",A.length," selected asset(s) to"," ",e.jsx("span",{className:"font-medium text-foreground",children:ca||"selected owner"}),"?"]})]}),e.jsxs(bs,{children:[e.jsx(vs,{disabled:T,children:"Cancel"}),e.jsx(ws,{disabled:T,onClick:async()=>{await ra()&&p(!1)},children:T&&Je==="owner"?"Updating...":"Confirm"})]})]})}),e.jsx(fs,{open:Ne,onOpenChange:ee,children:e.jsxs(ps,{children:[e.jsxs(gs,{children:[e.jsx(ys,{children:"Confirm status update"}),e.jsxs(js,{children:["Update status for ",A.length," selected asset(s) to"," ",e.jsx("span",{className:"font-medium text-foreground",children:ns}),"?"]})]}),e.jsxs(bs,{children:[e.jsx(vs,{disabled:T,children:"Cancel"}),e.jsx(ws,{disabled:T,onClick:async()=>{await ia()&&ee(!1)},children:T&&Je==="status"?"Updating...":"Confirm"})]})]})}),o&&e.jsx(fs,{open:ms,onOpenChange:We,children:e.jsxs(ps,{children:[e.jsxs(gs,{children:[e.jsx(ys,{children:"Delete selected assets?"}),e.jsxs(js,{children:["You are about to delete ",A.length," selected asset(s). This cannot be undone."]})]}),e.jsxs(bs,{children:[e.jsx(vs,{disabled:T,children:"Cancel"}),e.jsx(ws,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:T,onClick:()=>{We(!1),as(!0)},children:"Continue"})]})]})}),o&&e.jsx(fs,{open:Ts,onOpenChange:as,children:e.jsxs(ps,{children:[e.jsxs(gs,{children:[e.jsx(ys,{children:"Final confirmation"}),e.jsxs(js,{children:["Confirm permanent deletion for ",A.length," selected asset(s)."]})]}),e.jsxs(bs,{children:[e.jsx(vs,{disabled:T,children:"Back"}),e.jsx(ws,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:T,onClick:async()=>{await oa()&&as(!1)},children:T&&Je==="delete"?"Deleting...":"Delete permanently"})]})]})}),e.jsx(rr,{isOpen:Ye,asset:os,users:M??[],onClose:()=>{he(!1),m(null)}}),e.jsx(br,{asset:Ce,open:w,onClose:Wt,onEdit:Xt,users:_,hasPrev:Us,hasNext:Fs,onPrev:Jt,onNext:Gt,positionLabel:Re>=0?`${Re+1} / ${Y.length}`:""})]})}export{Ur as AssetManagement};
